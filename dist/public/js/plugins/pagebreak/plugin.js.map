{"version":3,"sources":["../../../../../public/js/plugins/pagebreak/plugin.js"],"names":["global","tinymce","util","Tools","resolve","global$1","getSeparatorHtml","editor","getParam","shouldSplitBlock","Settings","getPageBreakClass","getPlaceholderHtml","transparentSrc","setup","separatorHtml","pageBreakSeparatorRegExp","RegExp","replace","a","on","e","content","serializer","addNodeFilter","nodes","i","length","node","className","attr","indexOf","parentNode","parent","schema","getBlockElements","name","type","value","raw","remove","FilterContent","register","addCommand","settings","pagebreak_split_block","insertContent","Commands","setup$1","target","nodeName","dom","hasClass","ResolveName","register$1","ui","registry","addButton","icon","tooltip","onAction","execCommand","addMenuItem","text","Buttons","Plugin","add"],"mappings":"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","file":"plugin.js","sourcesContent":["/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.1.0 (2019-10-17)\n */\n(function () {\n    'use strict';\n\n    var global = tinymce.util.Tools.resolve('tinymce.PluginManager');\n\n    var global$1 = tinymce.util.Tools.resolve('tinymce.Env');\n\n    var getSeparatorHtml = function (editor) {\n      return editor.getParam('pagebreak_separator', '<!-- pagebreak -->');\n    };\n    var shouldSplitBlock = function (editor) {\n      return editor.getParam('pagebreak_split_block', false);\n    };\n    var Settings = {\n      getSeparatorHtml: getSeparatorHtml,\n      shouldSplitBlock: shouldSplitBlock\n    };\n\n    var getPageBreakClass = function () {\n      return 'mce-pagebreak';\n    };\n    var getPlaceholderHtml = function () {\n      return '<img src=\"' + global$1.transparentSrc + '\" class=\"' + getPageBreakClass() + '\" data-mce-resize=\"false\" data-mce-placeholder />';\n    };\n    var setup = function (editor) {\n      var separatorHtml = Settings.getSeparatorHtml(editor);\n      var pageBreakSeparatorRegExp = new RegExp(separatorHtml.replace(/[\\?\\.\\*\\[\\]\\(\\)\\{\\}\\+\\^\\$\\:]/g, function (a) {\n        return '\\\\' + a;\n      }), 'gi');\n      editor.on('BeforeSetContent', function (e) {\n        e.content = e.content.replace(pageBreakSeparatorRegExp, getPlaceholderHtml());\n      });\n      editor.on('PreInit', function () {\n        editor.serializer.addNodeFilter('img', function (nodes) {\n          var i = nodes.length, node, className;\n          while (i--) {\n            node = nodes[i];\n            className = node.attr('class');\n            if (className && className.indexOf('mce-pagebreak') !== -1) {\n              var parentNode = node.parent;\n              if (editor.schema.getBlockElements()[parentNode.name] && Settings.shouldSplitBlock(editor)) {\n                parentNode.type = 3;\n                parentNode.value = separatorHtml;\n                parentNode.raw = true;\n                node.remove();\n                continue;\n              }\n              node.type = 3;\n              node.value = separatorHtml;\n              node.raw = true;\n            }\n          }\n        });\n      });\n    };\n    var FilterContent = {\n      setup: setup,\n      getPlaceholderHtml: getPlaceholderHtml,\n      getPageBreakClass: getPageBreakClass\n    };\n\n    var register = function (editor) {\n      editor.addCommand('mcePageBreak', function () {\n        if (editor.settings.pagebreak_split_block) {\n          editor.insertContent('<p>' + FilterContent.getPlaceholderHtml() + '</p>');\n        } else {\n          editor.insertContent(FilterContent.getPlaceholderHtml());\n        }\n      });\n    };\n    var Commands = { register: register };\n\n    var setup$1 = function (editor) {\n      editor.on('ResolveName', function (e) {\n        if (e.target.nodeName === 'IMG' && editor.dom.hasClass(e.target, FilterContent.getPageBreakClass())) {\n          e.name = 'pagebreak';\n        }\n      });\n    };\n    var ResolveName = { setup: setup$1 };\n\n    var register$1 = function (editor) {\n      editor.ui.registry.addButton('pagebreak', {\n        icon: 'page-break',\n        tooltip: 'Page break',\n        onAction: function () {\n          return editor.execCommand('mcePageBreak');\n        }\n      });\n      editor.ui.registry.addMenuItem('pagebreak', {\n        text: 'Page break',\n        icon: 'page-break',\n        onAction: function () {\n          return editor.execCommand('mcePageBreak');\n        }\n      });\n    };\n    var Buttons = { register: register$1 };\n\n    function Plugin () {\n      global.add('pagebreak', function (editor) {\n        Commands.register(editor);\n        Buttons.register(editor);\n        FilterContent.setup(editor);\n        ResolveName.setup(editor);\n      });\n    }\n\n    Plugin();\n\n}());\n"]}