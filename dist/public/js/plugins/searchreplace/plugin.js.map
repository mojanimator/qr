{"version":3,"sources":["../../../../../public/js/plugins/searchreplace/plugin.js"],"names":["Cell","initial","value","get","set","v","clone","global","tinymce","util","Tools","resolve","__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","global$1","isContentEditableFalse","node","nodeType","contentEditable","findAndReplaceDOMText","regex","replacementNode","captureGroup","schema","m","matches","text","count","doc","blockElementsMap","hiddenTextElementsMap","shortEndedElementsMap","ownerDocument","getBlockElements","getWhiteSpaceElements","getShortEndedElements","getMatchIndexes","Error","index","cg","indexOf","getText","txt","data","nodeName","firstChild","nextSibling","stepThroughMatches","replaceFn","startNode","endNode","startNodeIndex","endNodeIndex","innerNodes","atIndex","curNode","matchLocation","shift","matchIndex","out","push","match","parentNode","genReplacer","makeReplacementNode","stencilNode_1","createElement","fill","cloneNode","setAttribute","appendChild","createTextNode","range","before","after","node_1","substring","insertBefore","el","removeChild","elA","l","innerNode","innerEl","replaceChild","elB","exec","FindReplaceText","getElmIndex","elm","getAttribute","markAllMatches","editor","currentSearchState","marker","dom","create","className","getBody","done","unwrap","findSpansByIndex","nodes","spans","toArray","getElementsByTagName","nodeIndex","toString","moveSelection","forward","searchState","testIndex","removeClass","addClass","selection","scrollIntoView","removeNode","parent","remove","isEmpty","find","matchCase","wholeWord","replace","RegExp","newIndex","next","prev","isMatchSpan","all","currentIndex","currentMatchIndex","nextIndex","grep","parseInt","nodeValue","String","keepEditorSelection","startContainer","endContainer","rng","createRng","setStart","setEnd","setRng","hasNext","hasPrev","currentState","done$1","find$1","next$1","prev$1","replace$1","Api","noop","constant","never","always","none","NONE","eq","o","isNone","thunk","id","me","fold","is","isSome","getOr","getOrThunk","getOrDie","msg","getOrNull","getOrUndefined","undefined","or","orThunk","map","each","bind","exists","forall","filter","equals","equals_","freeze","some","a","constant_a","self","f","elementEq","b","from","Option","typeOf","x","Array","isPrototypeOf","constructor","name","isType","type","isFunction","nativeSlice","slice","xs","len","from$1","subject","clear","on","isSet","open","dialogApi","undoManager","add","selectedText","trim","getContent","format","updateButtonStates","api","updateNext","enable","disable","updatePrev","disableAll","buttons","toggle","notFoundAlert","windowManager","alert","focus","reset","doFind","getData","last","findtext","matchcase","wholewords","initialState","initialData","replacetext","spec","title","size","body","items","placeholder","maximized","inputMode","icon","disabled","borderless","tooltip","align","primary","onChange","details","onAction","onSubmit","onClose","inline","Dialog","register","addCommand","Commands","showDialog","register$1","ui","registry","addMenuItem","shortcut","addButton","shortcuts","Buttons","Plugin"],"mappings":"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","file":"plugin.js","sourcesContent":["/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.1.0 (2019-10-17)\n */\n(function () {\n    'use strict';\n\n    var Cell = function (initial) {\n      var value = initial;\n      var get = function () {\n        return value;\n      };\n      var set = function (v) {\n        value = v;\n      };\n      var clone = function () {\n        return Cell(get());\n      };\n      return {\n        get: get,\n        set: set,\n        clone: clone\n      };\n    };\n\n    var global = tinymce.util.Tools.resolve('tinymce.PluginManager');\n\n    var __assign = function () {\n      __assign = Object.assign || function __assign(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s)\n            if (Object.prototype.hasOwnProperty.call(s, p))\n              t[p] = s[p];\n        }\n        return t;\n      };\n      return __assign.apply(this, arguments);\n    };\n\n    var global$1 = tinymce.util.Tools.resolve('tinymce.util.Tools');\n\n    function isContentEditableFalse(node) {\n      return node && node.nodeType === 1 && node.contentEditable === 'false';\n    }\n    function findAndReplaceDOMText(regex, node, replacementNode, captureGroup, schema) {\n      var m;\n      var matches = [];\n      var text, count = 0, doc;\n      var blockElementsMap, hiddenTextElementsMap, shortEndedElementsMap;\n      doc = node.ownerDocument;\n      blockElementsMap = schema.getBlockElements();\n      hiddenTextElementsMap = schema.getWhiteSpaceElements();\n      shortEndedElementsMap = schema.getShortEndedElements();\n      function getMatchIndexes(m, captureGroup) {\n        captureGroup = captureGroup || 0;\n        if (!m[0]) {\n          throw new Error('findAndReplaceDOMText cannot handle zero-length matches');\n        }\n        var index = m.index;\n        if (captureGroup > 0) {\n          var cg = m[captureGroup];\n          if (!cg) {\n            throw new Error('Invalid capture group');\n          }\n          index += m[0].indexOf(cg);\n          m[0] = cg;\n        }\n        return [\n          index,\n          index + m[0].length,\n          [m[0]]\n        ];\n      }\n      function getText(node) {\n        var txt;\n        if (node.nodeType === 3) {\n          return node.data;\n        }\n        if (hiddenTextElementsMap[node.nodeName] && !blockElementsMap[node.nodeName]) {\n          return '';\n        }\n        txt = '';\n        if (isContentEditableFalse(node)) {\n          return '\\n';\n        }\n        if (blockElementsMap[node.nodeName] || shortEndedElementsMap[node.nodeName]) {\n          txt += '\\n';\n        }\n        if (node = node.firstChild) {\n          do {\n            txt += getText(node);\n          } while (node = node.nextSibling);\n        }\n        return txt;\n      }\n      function stepThroughMatches(node, matches, replaceFn) {\n        var startNode, endNode, startNodeIndex, endNodeIndex, innerNodes = [], atIndex = 0, curNode = node, matchLocation = matches.shift(), matchIndex = 0;\n        out:\n          while (true) {\n            if (blockElementsMap[curNode.nodeName] || shortEndedElementsMap[curNode.nodeName] || isContentEditableFalse(curNode)) {\n              atIndex++;\n            }\n            if (curNode.nodeType === 3) {\n              if (!endNode && curNode.length + atIndex >= matchLocation[1]) {\n                endNode = curNode;\n                endNodeIndex = matchLocation[1] - atIndex;\n              } else if (startNode) {\n                innerNodes.push(curNode);\n              }\n              if (!startNode && curNode.length + atIndex > matchLocation[0]) {\n                startNode = curNode;\n                startNodeIndex = matchLocation[0] - atIndex;\n              }\n              atIndex += curNode.length;\n            }\n            if (startNode && endNode) {\n              curNode = replaceFn({\n                startNode: startNode,\n                startNodeIndex: startNodeIndex,\n                endNode: endNode,\n                endNodeIndex: endNodeIndex,\n                innerNodes: innerNodes,\n                match: matchLocation[2],\n                matchIndex: matchIndex\n              });\n              atIndex -= endNode.length - endNodeIndex;\n              startNode = null;\n              endNode = null;\n              innerNodes = [];\n              matchLocation = matches.shift();\n              matchIndex++;\n              if (!matchLocation) {\n                break;\n              }\n            } else if ((!hiddenTextElementsMap[curNode.nodeName] || blockElementsMap[curNode.nodeName]) && curNode.firstChild) {\n              if (!isContentEditableFalse(curNode)) {\n                curNode = curNode.firstChild;\n                continue;\n              }\n            } else if (curNode.nextSibling) {\n              curNode = curNode.nextSibling;\n              continue;\n            }\n            while (true) {\n              if (curNode.nextSibling) {\n                curNode = curNode.nextSibling;\n                break;\n              } else if (curNode.parentNode !== node) {\n                curNode = curNode.parentNode;\n              } else {\n                break out;\n              }\n            }\n          }\n      }\n      function genReplacer(nodeName) {\n        var makeReplacementNode;\n        if (typeof nodeName !== 'function') {\n          var stencilNode_1 = nodeName.nodeType ? nodeName : doc.createElement(nodeName);\n          makeReplacementNode = function (fill, matchIndex) {\n            var clone = stencilNode_1.cloneNode(false);\n            clone.setAttribute('data-mce-index', matchIndex);\n            if (fill) {\n              clone.appendChild(doc.createTextNode(fill));\n            }\n            return clone;\n          };\n        } else {\n          makeReplacementNode = nodeName;\n        }\n        return function (range) {\n          var before;\n          var after;\n          var parentNode;\n          var startNode = range.startNode;\n          var endNode = range.endNode;\n          var matchIndex = range.matchIndex;\n          if (startNode === endNode) {\n            var node_1 = startNode;\n            parentNode = node_1.parentNode;\n            if (range.startNodeIndex > 0) {\n              before = doc.createTextNode(node_1.data.substring(0, range.startNodeIndex));\n              parentNode.insertBefore(before, node_1);\n            }\n            var el = makeReplacementNode(range.match[0], matchIndex);\n            parentNode.insertBefore(el, node_1);\n            if (range.endNodeIndex < node_1.length) {\n              after = doc.createTextNode(node_1.data.substring(range.endNodeIndex));\n              parentNode.insertBefore(after, node_1);\n            }\n            node_1.parentNode.removeChild(node_1);\n            return el;\n          }\n          before = doc.createTextNode(startNode.data.substring(0, range.startNodeIndex));\n          after = doc.createTextNode(endNode.data.substring(range.endNodeIndex));\n          var elA = makeReplacementNode(startNode.data.substring(range.startNodeIndex), matchIndex);\n          for (var i = 0, l = range.innerNodes.length; i < l; ++i) {\n            var innerNode = range.innerNodes[i];\n            var innerEl = makeReplacementNode(innerNode.data, matchIndex);\n            innerNode.parentNode.replaceChild(innerEl, innerNode);\n          }\n          var elB = makeReplacementNode(endNode.data.substring(0, range.endNodeIndex), matchIndex);\n          parentNode = startNode.parentNode;\n          parentNode.insertBefore(before, startNode);\n          parentNode.insertBefore(elA, startNode);\n          parentNode.removeChild(startNode);\n          parentNode = endNode.parentNode;\n          parentNode.insertBefore(elB, endNode);\n          parentNode.insertBefore(after, endNode);\n          parentNode.removeChild(endNode);\n          return elB;\n        };\n      }\n      text = getText(node);\n      if (!text) {\n        return;\n      }\n      if (regex.global) {\n        while (m = regex.exec(text)) {\n          matches.push(getMatchIndexes(m, captureGroup));\n        }\n      } else {\n        m = text.match(regex);\n        matches.push(getMatchIndexes(m, captureGroup));\n      }\n      if (matches.length) {\n        count = matches.length;\n        stepThroughMatches(node, matches, genReplacer(replacementNode));\n      }\n      return count;\n    }\n    var FindReplaceText = { findAndReplaceDOMText: findAndReplaceDOMText };\n\n    var getElmIndex = function (elm) {\n      var value = elm.getAttribute('data-mce-index');\n      if (typeof value === 'number') {\n        return '' + value;\n      }\n      return value;\n    };\n    var markAllMatches = function (editor, currentSearchState, regex) {\n      var node, marker;\n      marker = editor.dom.create('span', { 'data-mce-bogus': 1 });\n      marker.className = 'mce-match-marker';\n      node = editor.getBody();\n      done(editor, currentSearchState, false);\n      return FindReplaceText.findAndReplaceDOMText(regex, node, marker, false, editor.schema);\n    };\n    var unwrap = function (node) {\n      var parentNode = node.parentNode;\n      if (node.firstChild) {\n        parentNode.insertBefore(node.firstChild, node);\n      }\n      node.parentNode.removeChild(node);\n    };\n    var findSpansByIndex = function (editor, index) {\n      var nodes;\n      var spans = [];\n      nodes = global$1.toArray(editor.getBody().getElementsByTagName('span'));\n      if (nodes.length) {\n        for (var i = 0; i < nodes.length; i++) {\n          var nodeIndex = getElmIndex(nodes[i]);\n          if (nodeIndex === null || !nodeIndex.length) {\n            continue;\n          }\n          if (nodeIndex === index.toString()) {\n            spans.push(nodes[i]);\n          }\n        }\n      }\n      return spans;\n    };\n    var moveSelection = function (editor, currentSearchState, forward) {\n      var searchState = currentSearchState.get();\n      var testIndex = searchState.index;\n      var dom = editor.dom;\n      forward = forward !== false;\n      if (forward) {\n        if (testIndex + 1 === searchState.count) {\n          testIndex = 0;\n        } else {\n          testIndex++;\n        }\n      } else {\n        if (testIndex - 1 === -1) {\n          testIndex = searchState.count - 1;\n        } else {\n          testIndex--;\n        }\n      }\n      dom.removeClass(findSpansByIndex(editor, searchState.index), 'mce-match-marker-selected');\n      var spans = findSpansByIndex(editor, testIndex);\n      if (spans.length) {\n        dom.addClass(findSpansByIndex(editor, testIndex), 'mce-match-marker-selected');\n        editor.selection.scrollIntoView(spans[0]);\n        return testIndex;\n      }\n      return -1;\n    };\n    var removeNode = function (dom, node) {\n      var parent = node.parentNode;\n      dom.remove(node);\n      if (dom.isEmpty(parent)) {\n        dom.remove(parent);\n      }\n    };\n    var find = function (editor, currentSearchState, text, matchCase, wholeWord) {\n      text = text.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, '\\\\$&');\n      text = text.replace(/\\s/g, '[^\\\\S\\\\r\\\\n]');\n      text = wholeWord ? '\\\\b' + text + '\\\\b' : text;\n      var count = markAllMatches(editor, currentSearchState, new RegExp(text, matchCase ? 'g' : 'gi'));\n      if (count) {\n        var newIndex = moveSelection(editor, currentSearchState, true);\n        currentSearchState.set({\n          index: newIndex,\n          count: count,\n          text: text,\n          matchCase: matchCase,\n          wholeWord: wholeWord\n        });\n      }\n      return count;\n    };\n    var next = function (editor, currentSearchState) {\n      var index = moveSelection(editor, currentSearchState, true);\n      currentSearchState.set(__assign(__assign({}, currentSearchState.get()), { index: index }));\n    };\n    var prev = function (editor, currentSearchState) {\n      var index = moveSelection(editor, currentSearchState, false);\n      currentSearchState.set(__assign(__assign({}, currentSearchState.get()), { index: index }));\n    };\n    var isMatchSpan = function (node) {\n      var matchIndex = getElmIndex(node);\n      return matchIndex !== null && matchIndex.length > 0;\n    };\n    var replace = function (editor, currentSearchState, text, forward, all) {\n      var searchState = currentSearchState.get();\n      var currentIndex = searchState.index;\n      var i, nodes, node, matchIndex, currentMatchIndex, nextIndex = currentIndex;\n      forward = forward !== false;\n      node = editor.getBody();\n      nodes = global$1.grep(global$1.toArray(node.getElementsByTagName('span')), isMatchSpan);\n      for (i = 0; i < nodes.length; i++) {\n        var nodeIndex = getElmIndex(nodes[i]);\n        matchIndex = currentMatchIndex = parseInt(nodeIndex, 10);\n        if (all || matchIndex === searchState.index) {\n          if (text.length) {\n            nodes[i].firstChild.nodeValue = text;\n            unwrap(nodes[i]);\n          } else {\n            removeNode(editor.dom, nodes[i]);\n          }\n          while (nodes[++i]) {\n            matchIndex = parseInt(getElmIndex(nodes[i]), 10);\n            if (matchIndex === currentMatchIndex) {\n              removeNode(editor.dom, nodes[i]);\n            } else {\n              i--;\n              break;\n            }\n          }\n          if (forward) {\n            nextIndex--;\n          }\n        } else if (currentMatchIndex > currentIndex) {\n          nodes[i].setAttribute('data-mce-index', String(currentMatchIndex - 1));\n        }\n      }\n      currentSearchState.set(__assign(__assign({}, searchState), {\n        count: all ? 0 : searchState.count - 1,\n        index: nextIndex\n      }));\n      if (forward) {\n        next(editor, currentSearchState);\n      } else {\n        prev(editor, currentSearchState);\n      }\n      return !all && currentSearchState.get().count > 0;\n    };\n    var done = function (editor, currentSearchState, keepEditorSelection) {\n      var i, nodes, startContainer, endContainer;\n      var searchState = currentSearchState.get();\n      nodes = global$1.toArray(editor.getBody().getElementsByTagName('span'));\n      for (i = 0; i < nodes.length; i++) {\n        var nodeIndex = getElmIndex(nodes[i]);\n        if (nodeIndex !== null && nodeIndex.length) {\n          if (nodeIndex === searchState.index.toString()) {\n            if (!startContainer) {\n              startContainer = nodes[i].firstChild;\n            }\n            endContainer = nodes[i].firstChild;\n          }\n          unwrap(nodes[i]);\n        }\n      }\n      currentSearchState.set(__assign(__assign({}, searchState), {\n        index: -1,\n        count: 0,\n        text: ''\n      }));\n      if (startContainer && endContainer) {\n        var rng = editor.dom.createRng();\n        rng.setStart(startContainer, 0);\n        rng.setEnd(endContainer, endContainer.data.length);\n        if (keepEditorSelection !== false) {\n          editor.selection.setRng(rng);\n        }\n        return rng;\n      }\n    };\n    var hasNext = function (editor, currentSearchState) {\n      return currentSearchState.get().count > 1;\n    };\n    var hasPrev = function (editor, currentSearchState) {\n      return currentSearchState.get().count > 1;\n    };\n\n    var get = function (editor, currentState) {\n      var done$1 = function (keepEditorSelection) {\n        return done(editor, currentState, keepEditorSelection);\n      };\n      var find$1 = function (text, matchCase, wholeWord) {\n        return find(editor, currentState, text, matchCase, wholeWord);\n      };\n      var next$1 = function () {\n        return next(editor, currentState);\n      };\n      var prev$1 = function () {\n        return prev(editor, currentState);\n      };\n      var replace$1 = function (text, forward, all) {\n        return replace(editor, currentState, text, forward, all);\n      };\n      return {\n        done: done$1,\n        find: find$1,\n        next: next$1,\n        prev: prev$1,\n        replace: replace$1\n      };\n    };\n    var Api = { get: get };\n\n    var noop = function () {\n    };\n    var constant = function (value) {\n      return function () {\n        return value;\n      };\n    };\n    var never = constant(false);\n    var always = constant(true);\n\n    var none = function () {\n      return NONE;\n    };\n    var NONE = function () {\n      var eq = function (o) {\n        return o.isNone();\n      };\n      var call = function (thunk) {\n        return thunk();\n      };\n      var id = function (n) {\n        return n;\n      };\n      var me = {\n        fold: function (n, s) {\n          return n();\n        },\n        is: never,\n        isSome: never,\n        isNone: always,\n        getOr: id,\n        getOrThunk: call,\n        getOrDie: function (msg) {\n          throw new Error(msg || 'error: getOrDie called on none.');\n        },\n        getOrNull: constant(null),\n        getOrUndefined: constant(undefined),\n        or: id,\n        orThunk: call,\n        map: none,\n        each: noop,\n        bind: none,\n        exists: never,\n        forall: always,\n        filter: none,\n        equals: eq,\n        equals_: eq,\n        toArray: function () {\n          return [];\n        },\n        toString: constant('none()')\n      };\n      if (Object.freeze) {\n        Object.freeze(me);\n      }\n      return me;\n    }();\n    var some = function (a) {\n      var constant_a = constant(a);\n      var self = function () {\n        return me;\n      };\n      var bind = function (f) {\n        return f(a);\n      };\n      var me = {\n        fold: function (n, s) {\n          return s(a);\n        },\n        is: function (v) {\n          return a === v;\n        },\n        isSome: always,\n        isNone: never,\n        getOr: constant_a,\n        getOrThunk: constant_a,\n        getOrDie: constant_a,\n        getOrNull: constant_a,\n        getOrUndefined: constant_a,\n        or: self,\n        orThunk: self,\n        map: function (f) {\n          return some(f(a));\n        },\n        each: function (f) {\n          f(a);\n        },\n        bind: bind,\n        exists: bind,\n        forall: bind,\n        filter: function (f) {\n          return f(a) ? me : NONE;\n        },\n        toArray: function () {\n          return [a];\n        },\n        toString: function () {\n          return 'some(' + a + ')';\n        },\n        equals: function (o) {\n          return o.is(a);\n        },\n        equals_: function (o, elementEq) {\n          return o.fold(never, function (b) {\n            return elementEq(a, b);\n          });\n        }\n      };\n      return me;\n    };\n    var from = function (value) {\n      return value === null || value === undefined ? NONE : some(value);\n    };\n    var Option = {\n      some: some,\n      none: none,\n      from: from\n    };\n\n    var typeOf = function (x) {\n      if (x === null) {\n        return 'null';\n      }\n      var t = typeof x;\n      if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {\n        return 'array';\n      }\n      if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {\n        return 'string';\n      }\n      return t;\n    };\n    var isType = function (type) {\n      return function (value) {\n        return typeOf(value) === type;\n      };\n    };\n    var isFunction = isType('function');\n\n    var nativeSlice = Array.prototype.slice;\n    var each = function (xs, f) {\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        f(x, i);\n      }\n    };\n    var from$1 = isFunction(Array.from) ? Array.from : function (x) {\n      return nativeSlice.call(x);\n    };\n\n    var value = function () {\n      var subject = Cell(Option.none());\n      var clear = function () {\n        subject.set(Option.none());\n      };\n      var set = function (s) {\n        subject.set(Option.some(s));\n      };\n      var on = function (f) {\n        subject.get().each(f);\n      };\n      var isSet = function () {\n        return subject.get().isSome();\n      };\n      return {\n        clear: clear,\n        set: set,\n        isSet: isSet,\n        on: on\n      };\n    };\n\n    var open = function (editor, currentSearchState) {\n      var dialogApi = value();\n      editor.undoManager.add();\n      var selectedText = global$1.trim(editor.selection.getContent({ format: 'text' }));\n      function updateButtonStates(api) {\n        var updateNext = hasNext(editor, currentSearchState) ? api.enable : api.disable;\n        updateNext('next');\n        var updatePrev = hasPrev(editor, currentSearchState) ? api.enable : api.disable;\n        updatePrev('prev');\n      }\n      var disableAll = function (api, disable) {\n        var buttons = [\n          'replace',\n          'replaceall',\n          'prev',\n          'next'\n        ];\n        var toggle = disable ? api.disable : api.enable;\n        each(buttons, toggle);\n      };\n      function notFoundAlert(api) {\n        editor.windowManager.alert('Could not find the specified string.', function () {\n          api.focus('findtext');\n        });\n      }\n      var reset = function (api) {\n        done(editor, currentSearchState, false);\n        disableAll(api, true);\n        updateButtonStates(api);\n      };\n      var doFind = function (api) {\n        var data = api.getData();\n        var last = currentSearchState.get();\n        if (!data.findtext.length) {\n          reset(api);\n          return;\n        }\n        if (last.text === data.findtext && last.matchCase === data.matchcase && last.wholeWord === data.wholewords) {\n          next(editor, currentSearchState);\n        } else {\n          var count = find(editor, currentSearchState, data.findtext, data.matchcase, data.wholewords);\n          if (count <= 0) {\n            notFoundAlert(api);\n          }\n          disableAll(api, count === 0);\n        }\n        updateButtonStates(api);\n      };\n      var initialState = currentSearchState.get();\n      var initialData = {\n        findtext: selectedText,\n        replacetext: '',\n        wholewords: initialState.wholeWord,\n        matchcase: initialState.matchCase\n      };\n      var spec = {\n        title: 'Find and Replace',\n        size: 'normal',\n        body: {\n          type: 'panel',\n          items: [\n            {\n              type: 'bar',\n              items: [\n                {\n                  type: 'input',\n                  name: 'findtext',\n                  placeholder: 'Find',\n                  maximized: true,\n                  inputMode: 'search'\n                },\n                {\n                  type: 'button',\n                  name: 'prev',\n                  text: 'Previous',\n                  icon: 'action-prev',\n                  disabled: true,\n                  borderless: true\n                },\n                {\n                  type: 'button',\n                  name: 'next',\n                  text: 'Next',\n                  icon: 'action-next',\n                  disabled: true,\n                  borderless: true\n                }\n              ]\n            },\n            {\n              type: 'input',\n              name: 'replacetext',\n              placeholder: 'Replace with',\n              inputMode: 'search'\n            }\n          ]\n        },\n        buttons: [\n          {\n            type: 'menu',\n            name: 'options',\n            icon: 'preferences',\n            tooltip: 'Preferences',\n            align: 'start',\n            items: [\n              {\n                type: 'togglemenuitem',\n                name: 'matchcase',\n                text: 'Match case'\n              },\n              {\n                type: 'togglemenuitem',\n                name: 'wholewords',\n                text: 'Find whole words only'\n              }\n            ]\n          },\n          {\n            type: 'custom',\n            name: 'find',\n            text: 'Find',\n            primary: true\n          },\n          {\n            type: 'custom',\n            name: 'replace',\n            text: 'Replace',\n            disabled: true\n          },\n          {\n            type: 'custom',\n            name: 'replaceall',\n            text: 'Replace All',\n            disabled: true\n          }\n        ],\n        initialData: initialData,\n        onChange: function (api, details) {\n          if (details.name === 'findtext' && currentSearchState.get().count > 0) {\n            reset(api);\n          }\n        },\n        onAction: function (api, details) {\n          var data = api.getData();\n          switch (details.name) {\n          case 'find':\n            doFind(api);\n            break;\n          case 'replace':\n            if (!replace(editor, currentSearchState, data.replacetext)) {\n              reset(api);\n            } else {\n              updateButtonStates(api);\n            }\n            break;\n          case 'replaceall':\n            replace(editor, currentSearchState, data.replacetext, true, true);\n            reset(api);\n            break;\n          case 'prev':\n            prev(editor, currentSearchState);\n            updateButtonStates(api);\n            break;\n          case 'next':\n            next(editor, currentSearchState);\n            updateButtonStates(api);\n            break;\n          default:\n            break;\n          }\n        },\n        onSubmit: doFind,\n        onClose: function () {\n          editor.focus();\n          done(editor, currentSearchState);\n          editor.undoManager.add();\n        }\n      };\n      dialogApi.set(editor.windowManager.open(spec, { inline: 'toolbar' }));\n    };\n    var Dialog = { open: open };\n\n    var register = function (editor, currentSearchState) {\n      editor.addCommand('SearchReplace', function () {\n        Dialog.open(editor, currentSearchState);\n      });\n    };\n    var Commands = { register: register };\n\n    var showDialog = function (editor, currentSearchState) {\n      return function () {\n        Dialog.open(editor, currentSearchState);\n      };\n    };\n    var register$1 = function (editor, currentSearchState) {\n      editor.ui.registry.addMenuItem('searchreplace', {\n        text: 'Find and replace...',\n        shortcut: 'Meta+F',\n        onAction: showDialog(editor, currentSearchState),\n        icon: 'search'\n      });\n      editor.ui.registry.addButton('searchreplace', {\n        tooltip: 'Find and replace',\n        onAction: showDialog(editor, currentSearchState),\n        icon: 'search'\n      });\n      editor.shortcuts.add('Meta+F', '', showDialog(editor, currentSearchState));\n    };\n    var Buttons = { register: register$1 };\n\n    function Plugin () {\n      global.add('searchreplace', function (editor) {\n        var currentSearchState = Cell({\n          index: -1,\n          count: 0,\n          text: '',\n          matchCase: false,\n          wholeWord: false\n        });\n        Commands.register(editor, currentSearchState);\n        Buttons.register(editor, currentSearchState);\n        return Api.get(editor, currentSearchState);\n      });\n    }\n\n    Plugin();\n\n}());\n"]}