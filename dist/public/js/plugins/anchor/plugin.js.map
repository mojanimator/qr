{"version":3,"sources":["../../../../../public/js/plugins/anchor/plugin.js"],"names":["global","tinymce","util","Tools","resolve","isValidId","id","test","getId","editor","selectedNode","selection","getNode","isAnchor","tagName","dom","getAttrib","getAttribute","insert","removeAttribute","undoManager","add","focus","collapse","execCommand","createHTML","Anchor","insertAnchor","newId","windowManager","alert","open","currentId","title","size","body","type","items","name","label","placeholder","buttons","text","primary","initialData","onSubmit","api","getData","close","Dialog","register","addCommand","Commands","isAnchorNode","node","attr","firstChild","setContentEditable","state","nodes","i","length","setup","on","parser","addNodeFilter","serializer","FilterContent","register$1","ui","registry","addToggleButton","icon","tooltip","onAction","onSetup","buttonApi","selectorChangedWithUnbind","setActive","unbind","addMenuItem","Buttons","Plugin"],"mappings":"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","file":"plugin.js","sourcesContent":["/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.1.0 (2019-10-17)\n */\n(function () {\n    'use strict';\n\n    var global = tinymce.util.Tools.resolve('tinymce.PluginManager');\n\n    var isValidId = function (id) {\n      return /^[A-Za-z][A-Za-z0-9\\-:._]*$/.test(id);\n    };\n    var getId = function (editor) {\n      var selectedNode = editor.selection.getNode();\n      var isAnchor = selectedNode.tagName === 'A' && editor.dom.getAttrib(selectedNode, 'href') === '';\n      return isAnchor ? selectedNode.getAttribute('id') || selectedNode.getAttribute('name') : '';\n    };\n    var insert = function (editor, id) {\n      var selectedNode = editor.selection.getNode();\n      var isAnchor = selectedNode.tagName === 'A' && editor.dom.getAttrib(selectedNode, 'href') === '';\n      if (isAnchor) {\n        selectedNode.removeAttribute('name');\n        selectedNode.id = id;\n        editor.undoManager.add();\n      } else {\n        editor.focus();\n        editor.selection.collapse(true);\n        editor.execCommand('mceInsertContent', false, editor.dom.createHTML('a', { id: id }));\n      }\n    };\n    var Anchor = {\n      isValidId: isValidId,\n      getId: getId,\n      insert: insert\n    };\n\n    var insertAnchor = function (editor, newId) {\n      if (!Anchor.isValidId(newId)) {\n        editor.windowManager.alert('Id should start with a letter, followed only by letters, numbers, dashes, dots, colons or underscores.');\n        return true;\n      } else {\n        Anchor.insert(editor, newId);\n        return false;\n      }\n    };\n    var open = function (editor) {\n      var currentId = Anchor.getId(editor);\n      editor.windowManager.open({\n        title: 'Anchor',\n        size: 'normal',\n        body: {\n          type: 'panel',\n          items: [{\n              name: 'id',\n              type: 'input',\n              label: 'ID',\n              placeholder: 'example'\n            }]\n        },\n        buttons: [\n          {\n            type: 'cancel',\n            name: 'cancel',\n            text: 'Cancel'\n          },\n          {\n            type: 'submit',\n            name: 'save',\n            text: 'Save',\n            primary: true\n          }\n        ],\n        initialData: { id: currentId },\n        onSubmit: function (api) {\n          if (!insertAnchor(editor, api.getData().id)) {\n            api.close();\n          }\n        }\n      });\n    };\n    var Dialog = { open: open };\n\n    var register = function (editor) {\n      editor.addCommand('mceAnchor', function () {\n        Dialog.open(editor);\n      });\n    };\n    var Commands = { register: register };\n\n    var isAnchorNode = function (node) {\n      return !node.attr('href') && (node.attr('id') || node.attr('name')) && !node.firstChild;\n    };\n    var setContentEditable = function (state) {\n      return function (nodes) {\n        for (var i = 0; i < nodes.length; i++) {\n          if (isAnchorNode(nodes[i])) {\n            nodes[i].attr('contenteditable', state);\n          }\n        }\n      };\n    };\n    var setup = function (editor) {\n      editor.on('PreInit', function () {\n        editor.parser.addNodeFilter('a', setContentEditable('false'));\n        editor.serializer.addNodeFilter('a', setContentEditable(null));\n      });\n    };\n    var FilterContent = { setup: setup };\n\n    var register$1 = function (editor) {\n      editor.ui.registry.addToggleButton('anchor', {\n        icon: 'bookmark',\n        tooltip: 'Anchor',\n        onAction: function () {\n          return editor.execCommand('mceAnchor');\n        },\n        onSetup: function (buttonApi) {\n          return editor.selection.selectorChangedWithUnbind('a:not([href])', buttonApi.setActive).unbind;\n        }\n      });\n      editor.ui.registry.addMenuItem('anchor', {\n        icon: 'bookmark',\n        text: 'Anchor...',\n        onAction: function () {\n          return editor.execCommand('mceAnchor');\n        }\n      });\n    };\n    var Buttons = { register: register$1 };\n\n    function Plugin () {\n      global.add('anchor', function (editor) {\n        FilterContent.setup(editor);\n        Commands.register(editor);\n        Buttons.register(editor);\n      });\n    }\n\n    Plugin();\n\n}());\n"]}