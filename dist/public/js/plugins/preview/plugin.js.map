{"version":3,"sources":["../../../../../public/js/plugins/preview/plugin.js"],"names":["global","tinymce","util","Tools","resolve","global$1","getPreviewDialogWidth","editor","parseInt","getParam","getPreviewDialogHeight","getContentStyle","shouldUseContentCssCors","Settings","global$2","getPreviewHtml","headHtml","encode","dom","contentStyle","documentBaseURI","getURI","cors","each","contentCSS","url","toAbsolute","bodyId","settings","body_id","indexOf","id","bodyClass","body_class","isMetaKeyPressed","mac","preventClicksOnLinksScript","directionality","getBody","dir","dirAttr","previewHtml","getContent","IframeContent","open","content","dataApi","windowManager","title","size","body","type","items","name","sandboxed","buttons","text","primary","initialData","preview","focus","register","addCommand","Commands","register$1","ui","registry","addButton","icon","tooltip","onAction","execCommand","addMenuItem","Buttons","Plugin","add"],"mappings":"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","file":"plugin.js","sourcesContent":["/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.1.0 (2019-10-17)\n */\n(function () {\n    'use strict';\n\n    var global = tinymce.util.Tools.resolve('tinymce.PluginManager');\n\n    var global$1 = tinymce.util.Tools.resolve('tinymce.util.Tools');\n\n    var getPreviewDialogWidth = function (editor) {\n      return parseInt(editor.getParam('plugin_preview_width', '650'), 10);\n    };\n    var getPreviewDialogHeight = function (editor) {\n      return parseInt(editor.getParam('plugin_preview_height', '500'), 10);\n    };\n    var getContentStyle = function (editor) {\n      return editor.getParam('content_style', '');\n    };\n    var shouldUseContentCssCors = function (editor) {\n      return editor.getParam('content_css_cors', false, 'boolean');\n    };\n    var Settings = {\n      getPreviewDialogWidth: getPreviewDialogWidth,\n      getPreviewDialogHeight: getPreviewDialogHeight,\n      getContentStyle: getContentStyle,\n      shouldUseContentCssCors: shouldUseContentCssCors\n    };\n\n    var global$2 = tinymce.util.Tools.resolve('tinymce.Env');\n\n    var getPreviewHtml = function (editor) {\n      var headHtml = '';\n      var encode = editor.dom.encode;\n      var contentStyle = Settings.getContentStyle(editor);\n      headHtml += '<base href=\"' + encode(editor.documentBaseURI.getURI()) + '\">';\n      if (contentStyle) {\n        headHtml += '<style type=\"text/css\">' + contentStyle + '</style>';\n      }\n      var cors = Settings.shouldUseContentCssCors(editor) ? ' crossorigin=\"anonymous\"' : '';\n      global$1.each(editor.contentCSS, function (url) {\n        headHtml += '<link type=\"text/css\" rel=\"stylesheet\" href=\"' + encode(editor.documentBaseURI.toAbsolute(url)) + '\"' + cors + '>';\n      });\n      var bodyId = editor.settings.body_id || 'tinymce';\n      if (bodyId.indexOf('=') !== -1) {\n        bodyId = editor.getParam('body_id', '', 'hash');\n        bodyId = bodyId[editor.id] || bodyId;\n      }\n      var bodyClass = editor.settings.body_class || '';\n      if (bodyClass.indexOf('=') !== -1) {\n        bodyClass = editor.getParam('body_class', '', 'hash');\n        bodyClass = bodyClass[editor.id] || '';\n      }\n      var isMetaKeyPressed = global$2.mac ? 'e.metaKey' : 'e.ctrlKey && !e.altKey';\n      var preventClicksOnLinksScript = '<script>' + 'document.addEventListener && document.addEventListener(\"click\", function(e) {' + 'for (var elm = e.target; elm; elm = elm.parentNode) {' + 'if (elm.nodeName === \"A\" && !(' + isMetaKeyPressed + ')) {' + 'e.preventDefault();' + '}' + '}' + '}, false);' + '</script> ';\n      var directionality = editor.getBody().dir;\n      var dirAttr = directionality ? ' dir=\"' + encode(directionality) + '\"' : '';\n      var previewHtml = '<!DOCTYPE html>' + '<html>' + '<head>' + headHtml + '</head>' + '<body id=\"' + encode(bodyId) + '\" class=\"mce-content-body ' + encode(bodyClass) + '\"' + dirAttr + '>' + editor.getContent() + preventClicksOnLinksScript + '</body>' + '</html>';\n      return previewHtml;\n    };\n    var IframeContent = { getPreviewHtml: getPreviewHtml };\n\n    var open = function (editor) {\n      var content = IframeContent.getPreviewHtml(editor);\n      var dataApi = editor.windowManager.open({\n        title: 'Preview',\n        size: 'large',\n        body: {\n          type: 'panel',\n          items: [{\n              name: 'preview',\n              type: 'iframe',\n              sandboxed: true\n            }]\n        },\n        buttons: [{\n            type: 'cancel',\n            name: 'close',\n            text: 'Close',\n            primary: true\n          }],\n        initialData: { preview: content }\n      });\n      dataApi.focus('close');\n    };\n\n    var register = function (editor) {\n      editor.addCommand('mcePreview', function () {\n        open(editor);\n      });\n    };\n    var Commands = { register: register };\n\n    var register$1 = function (editor) {\n      editor.ui.registry.addButton('preview', {\n        icon: 'preview',\n        tooltip: 'Preview',\n        onAction: function () {\n          return editor.execCommand('mcePreview');\n        }\n      });\n      editor.ui.registry.addMenuItem('preview', {\n        icon: 'preview',\n        text: 'Preview',\n        onAction: function () {\n          return editor.execCommand('mcePreview');\n        }\n      });\n    };\n    var Buttons = { register: register$1 };\n\n    function Plugin () {\n      global.add('preview', function (editor) {\n        Commands.register(editor);\n        Buttons.register(editor);\n      });\n    }\n\n    Plugin();\n\n}());\n"]}