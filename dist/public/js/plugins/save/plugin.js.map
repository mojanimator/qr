{"version":3,"sources":["../../../../../public/js/plugins/save/plugin.js"],"names":["global","tinymce","util","Tools","resolve","global$1","global$2","enableWhenDirty","editor","getParam","hasOnSaveCallback","hasOnCancelCallback","Settings","displayErrorMessage","message","notificationManager","open","text","type","save","formObj","DOM","getParent","id","isDirty","execCallback","nodeChanged","setDirty","onsubmit","submit","cancel","h","trim","startContent","resetContent","Actions","register","addCommand","Commands","stateToggle","api","handler","setDisabled","on","off","register$1","ui","registry","addButton","icon","tooltip","disabled","onAction","execCommand","onSetup","addShortcut","Buttons","Plugin","add"],"mappings":"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","file":"plugin.js","sourcesContent":["/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.1.0 (2019-10-17)\n */\n(function () {\n    'use strict';\n\n    var global = tinymce.util.Tools.resolve('tinymce.PluginManager');\n\n    var global$1 = tinymce.util.Tools.resolve('tinymce.dom.DOMUtils');\n\n    var global$2 = tinymce.util.Tools.resolve('tinymce.util.Tools');\n\n    var enableWhenDirty = function (editor) {\n      return editor.getParam('save_enablewhendirty', true);\n    };\n    var hasOnSaveCallback = function (editor) {\n      return !!editor.getParam('save_onsavecallback');\n    };\n    var hasOnCancelCallback = function (editor) {\n      return !!editor.getParam('save_oncancelcallback');\n    };\n    var Settings = {\n      enableWhenDirty: enableWhenDirty,\n      hasOnSaveCallback: hasOnSaveCallback,\n      hasOnCancelCallback: hasOnCancelCallback\n    };\n\n    var displayErrorMessage = function (editor, message) {\n      editor.notificationManager.open({\n        text: message,\n        type: 'error'\n      });\n    };\n    var save = function (editor) {\n      var formObj;\n      formObj = global$1.DOM.getParent(editor.id, 'form');\n      if (Settings.enableWhenDirty(editor) && !editor.isDirty()) {\n        return;\n      }\n      editor.save();\n      if (Settings.hasOnSaveCallback(editor)) {\n        editor.execCallback('save_onsavecallback', editor);\n        editor.nodeChanged();\n        return;\n      }\n      if (formObj) {\n        editor.setDirty(false);\n        if (!formObj.onsubmit || formObj.onsubmit()) {\n          if (typeof formObj.submit === 'function') {\n            formObj.submit();\n          } else {\n            displayErrorMessage(editor, 'Error: Form submit field collision.');\n          }\n        }\n        editor.nodeChanged();\n      } else {\n        displayErrorMessage(editor, 'Error: No form element found.');\n      }\n    };\n    var cancel = function (editor) {\n      var h = global$2.trim(editor.startContent);\n      if (Settings.hasOnCancelCallback(editor)) {\n        editor.execCallback('save_oncancelcallback', editor);\n        return;\n      }\n      editor.resetContent(h);\n    };\n    var Actions = {\n      save: save,\n      cancel: cancel\n    };\n\n    var register = function (editor) {\n      editor.addCommand('mceSave', function () {\n        Actions.save(editor);\n      });\n      editor.addCommand('mceCancel', function () {\n        Actions.cancel(editor);\n      });\n    };\n    var Commands = { register: register };\n\n    var stateToggle = function (editor) {\n      return function (api) {\n        var handler = function () {\n          api.setDisabled(Settings.enableWhenDirty(editor) && !editor.isDirty());\n        };\n        editor.on('NodeChange dirty', handler);\n        return function () {\n          return editor.off('NodeChange dirty', handler);\n        };\n      };\n    };\n    var register$1 = function (editor) {\n      editor.ui.registry.addButton('save', {\n        icon: 'save',\n        tooltip: 'Save',\n        disabled: true,\n        onAction: function () {\n          return editor.execCommand('mceSave');\n        },\n        onSetup: stateToggle(editor)\n      });\n      editor.ui.registry.addButton('cancel', {\n        icon: 'cancel',\n        tooltip: 'Cancel',\n        disabled: true,\n        onAction: function () {\n          return editor.execCommand('mceCancel');\n        },\n        onSetup: stateToggle(editor)\n      });\n      editor.addShortcut('Meta+S', '', 'mceSave');\n    };\n    var Buttons = { register: register$1 };\n\n    function Plugin () {\n      global.add('save', function (editor) {\n        Buttons.register(editor);\n        Commands.register(editor);\n      });\n    }\n\n    Plugin();\n\n}());\n"]}