{"version":3,"sources":["../../../../../public/js/plugins/textpattern/plugin.js"],"names":["domGlobals","Cell","initial","value","get","set","v","clone","global","tinymce","util","Tools","resolve","__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","__spreadArrays","il","r","Array","k","a","j","jl","noop","constant","identity","x","die","msg","Error","never","always","none","NONE","eq","o","isNone","thunk","id","me","fold","is","isSome","getOr","getOrThunk","getOrDie","getOrNull","getOrUndefined","undefined","or","orThunk","map","each","bind","exists","forall","filter","equals","equals_","toArray","toString","freeze","some","constant_a","self","f","elementEq","b","from","Option","typeOf","isPrototypeOf","constructor","name","String","isType","type","isString","isObject","isArray","isFunction","nativeSlice","slice","nativeIndexOf","indexOf","rawIndexOf","ts","contains","xs","len","eachr","pred","push","foldr","acc","foldl","find","sort","comparator","copy","head","from$1","keys","obj","key","has","generate","cases","constructors","adt","acase","count","keys$1","argLength","args","match","branches","branchKeys","join","allReqd","reqKey","target","log","label","console","params","Adt","comparison","bothErrors","firstError","secondError","bothValues","partition","results","errors","values","result","err","opt","mapError","_","onValue","toOption","isValue","isError","error","message","onError","fromOption","Result","isInlinePattern","pattern","isBlockPattern","sortPatterns","patterns","start","normalizePattern","formatOrCmd","onFormat","onCommand","format","formats","cmd","end","start_1","end_1","replacement","command","commandValue","denormalizePattern","createPatternSet","inlinePatterns","blockPatterns","get$1","patternsState","setPatterns","newPatterns","normalized","JSON","stringify","getPatterns","Api","Global","window","Function","error$1","_i","defaultPatterns","getPatternSet","editorSettings","getForcedRootBlock","editor","block","getParam","global$1","global$2","zeroWidth","global$3","global$4","isText","node","nodeType","Node","TEXT_NODE","cleanEmptyNodes","dom","isRoot","isEmpty","parent","parentNode","remove","deleteRng","rng","clean","startParent","startContainer","endParent","endContainer","deleteContents","data","isBlockFormatName","formatter","formatSet","isInlinePattern$1","isReplacementPattern","findPattern","text","lastIndexOf","getParentBlock","parentBlockOpt","getParent","isBlock","getBody","point","element","offset","TextWalker","startNode","rootNode","walker","walk","direction","next","prev","prev2","textBefore","textWalker","scanLeft","textContent","prevText","scanRight","isBoundary","nodeName","getContentEditable","outcome","aborted","edge","success","phase","abort","kontinue","finish","repeat","process","recent","terminate","recurse","repeatLeft","generatePath","root","current","childNodes","reverse","generatePathRange","startOffset","endNode","endOffset","resolvePath","path","nodePath","pop","optNode","index","resolvePathRange","range","_a","document","createRange","setStart","setEnd","generatePathRangeFromRange","stripPattern","firstTextNode","createRng","e","applyPattern","getRoot","undoManager","transact","execCommand","findPatterns","selection","getRng","forcedRootBlock","matchesForcedRootBlock","blockText","matchedPattern","trim","applyMatches","matches","bookmark","getBookmark","moveToBookmark","unique","generate$1","prefix","date","Date","time","getTime","random","Math","floor","checkRange","str","substr","endsWith","suffix","newMarker","create","rangeFromMarker","marker","setStartAfter","setEndBefore","createMarker","markerPrefix","pathRange","textEnd","splitText","textStart","insertBefore","removeMarker","nodeMatchesPattern","content","optOffset","searchText","substring","startEndIndex","charAt","startIndex","spot","findPatternStart","requireGap","startRange","findPattern$1","details","position","endPathRng","startRng","endRng","resultsOpt","findPatternsRec","remainingPatterns","results_1","pos","startPathRng","concat","endSpot","patternsWithoutCurrent","splice","applyPattern$1","patternRange","setRng","applyReplacementPattern","markerRange","applyPatternWithContent","startMarker","endMarker","markerEndRange","markerStartRange","patternMarker","addMarkers","matchesWithEnds","idx","findPatterns$1","space","collapsed","applyMatches$1","matchesWithMarkers","handleEnter","patternSet","isCollapsed","inlineMatches","blockMatches","add","extra","insertContent","deleteData","handleInlineKey","checkKeyEvent","codes","event","predicate","checkKeyCode","code","keyCode","modifierPressed","checkCharCode","chars","chr","charCodeAt","charCode","KeyHandler","setup","charCodes","keyCodes","on","preventDefault","setEditorTimeout","Keyboard","Plugin","settings"],"mappings":";;;;AAAA;;;;;;;;AAQC,WAAUA,UAAV,EAAsB;AACnB;;AAEA,MAAIC,OAAO,SAAPA,IAAO,CAAUC,OAAV,EAAmB;AAC5B,QAAIC,QAAQD,OAAZ;AACA,QAAIE,MAAM,SAANA,GAAM,GAAY;AACpB,aAAOD,KAAP;AACD,KAFD;AAGA,QAAIE,MAAM,SAANA,GAAM,CAAUC,CAAV,EAAa;AACrBH,cAAQG,CAAR;AACD,KAFD;AAGA,QAAIC,QAAQ,SAARA,KAAQ,GAAY;AACtB,aAAON,KAAKG,KAAL,CAAP;AACD,KAFD;AAGA,WAAO;AACLA,WAAKA,GADA;AAELC,WAAKA,GAFA;AAGLE,aAAOA;AAHF,KAAP;AAKD,GAhBD;;AAkBA,MAAIC,SAASC,QAAQC,IAAR,CAAaC,KAAb,CAAmBC,OAAnB,CAA2B,uBAA3B,CAAb;;AAEA,MAAIC,UAAW,oBAAY;AACzBA,cAAWC,OAAOC,MAAP,IAAiB,SAASF,QAAT,CAAkBG,CAAlB,EAAqB;AAC/C,WAAK,IAAIC,CAAJ,EAAOC,IAAI,CAAX,EAAcC,IAAIC,UAAUC,MAAjC,EAAyCH,IAAIC,CAA7C,EAAgDD,GAAhD,EAAqD;AACnDD,YAAIG,UAAUF,CAAV,CAAJ;AACA,aAAK,IAAII,CAAT,IAAcL,CAAd;AACE,cAAIH,OAAOS,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCR,CAArC,EAAwCK,CAAxC,CAAJ,EACEN,EAAEM,CAAF,IAAOL,EAAEK,CAAF,CAAP;AAFJ;AAGD;AACD,aAAON,CAAP;AACD,KARD;AASA,WAAOH,QAASa,KAAT,CAAe,IAAf,EAAqBN,SAArB,CAAP;AACD,GAXD;AAYA,WAASO,cAAT,GAA0B;AACxB,SAAK,IAAIV,IAAI,CAAR,EAAWC,IAAI,CAAf,EAAkBU,KAAKR,UAAUC,MAAtC,EAA8CH,IAAIU,EAAlD,EAAsDV,GAAtD;AACED,WAAKG,UAAUF,CAAV,EAAaG,MAAlB;AADF,KAEA,KAAK,IAAIQ,IAAIC,MAAMb,CAAN,CAAR,EAAkBc,IAAI,CAAtB,EAAyBb,IAAI,CAAlC,EAAqCA,IAAIU,EAAzC,EAA6CV,GAA7C;AACE,WAAK,IAAIc,IAAIZ,UAAUF,CAAV,CAAR,EAAsBe,IAAI,CAA1B,EAA6BC,KAAKF,EAAEX,MAAzC,EAAiDY,IAAIC,EAArD,EAAyDD,KAAKF,GAA9D;AACEF,UAAEE,CAAF,IAAOC,EAAEC,CAAF,CAAP;AADF;AADF,KAGA,OAAOJ,CAAP;AACD;;AAED,MAAIM,OAAO,SAAPA,IAAO,GAAY,CACtB,CADD;AAEA,MAAIC,WAAW,SAAXA,QAAW,CAAUjC,KAAV,EAAiB;AAC9B,WAAO,YAAY;AACjB,aAAOA,KAAP;AACD,KAFD;AAGD,GAJD;AAKA,MAAIkC,WAAW,SAAXA,QAAW,CAAUC,CAAV,EAAa;AAC1B,WAAOA,CAAP;AACD,GAFD;AAGA,MAAIC,MAAM,SAANA,GAAM,CAAUC,GAAV,EAAe;AACvB,WAAO,YAAY;AACjB,YAAM,IAAIC,KAAJ,CAAUD,GAAV,CAAN;AACD,KAFD;AAGD,GAJD;AAKA,MAAIE,QAAQN,SAAS,KAAT,CAAZ;AACA,MAAIO,SAASP,SAAS,IAAT,CAAb;;AAEA,MAAIQ,OAAO,SAAPA,IAAO,GAAY;AACrB,WAAOC,IAAP;AACD,GAFD;AAGA,MAAIA,OAAO,YAAY;AACrB,QAAIC,KAAK,SAALA,EAAK,CAAUC,CAAV,EAAa;AACpB,aAAOA,EAAEC,MAAF,EAAP;AACD,KAFD;AAGA,QAAIvB,OAAO,SAAPA,IAAO,CAAUwB,KAAV,EAAiB;AAC1B,aAAOA,OAAP;AACD,KAFD;AAGA,QAAIC,KAAK,SAALA,EAAK,CAAU/B,CAAV,EAAa;AACpB,aAAOA,CAAP;AACD,KAFD;AAGA,QAAIgC,KAAK;AACPC,YAAM,cAAUjC,CAAV,EAAaF,CAAb,EAAgB;AACpB,eAAOE,GAAP;AACD,OAHM;AAIPkC,UAAIX,KAJG;AAKPY,cAAQZ,KALD;AAMPM,cAAQL,MAND;AAOPY,aAAOL,EAPA;AAQPM,kBAAY/B,IARL;AASPgC,gBAAU,kBAAUjB,GAAV,EAAe;AACvB,cAAM,IAAIC,KAAJ,CAAUD,OAAO,iCAAjB,CAAN;AACD,OAXM;AAYPkB,iBAAWtB,SAAS,IAAT,CAZJ;AAaPuB,sBAAgBvB,SAASwB,SAAT,CAbT;AAcPC,UAAIX,EAdG;AAePY,eAASrC,IAfF;AAgBPsC,WAAKnB,IAhBE;AAiBPoB,YAAM7B,IAjBC;AAkBP8B,YAAMrB,IAlBC;AAmBPsB,cAAQxB,KAnBD;AAoBPyB,cAAQxB,MApBD;AAqBPyB,cAAQxB,IArBD;AAsBPyB,cAAQvB,EAtBD;AAuBPwB,eAASxB,EAvBF;AAwBPyB,eAAS,mBAAY;AACnB,eAAO,EAAP;AACD,OA1BM;AA2BPC,gBAAUpC,SAAS,QAAT;AA3BH,KAAT;AA6BA,QAAItB,OAAO2D,MAAX,EAAmB;AACjB3D,aAAO2D,MAAP,CAActB,EAAd;AACD;AACD,WAAOA,EAAP;AACD,GA3CU,EAAX;AA4CA,MAAIuB,OAAO,SAAPA,IAAO,CAAU1C,CAAV,EAAa;AACtB,QAAI2C,aAAavC,SAASJ,CAAT,CAAjB;AACA,QAAI4C,OAAO,SAAPA,IAAO,GAAY;AACrB,aAAOzB,EAAP;AACD,KAFD;AAGA,QAAIc,OAAO,SAAPA,IAAO,CAAUY,CAAV,EAAa;AACtB,aAAOA,EAAE7C,CAAF,CAAP;AACD,KAFD;AAGA,QAAImB,KAAK;AACPC,YAAM,cAAUjC,CAAV,EAAaF,CAAb,EAAgB;AACpB,eAAOA,EAAEe,CAAF,CAAP;AACD,OAHM;AAIPqB,UAAI,YAAU/C,CAAV,EAAa;AACf,eAAO0B,MAAM1B,CAAb;AACD,OANM;AAOPgD,cAAQX,MAPD;AAQPK,cAAQN,KARD;AASPa,aAAOoB,UATA;AAUPnB,kBAAYmB,UAVL;AAWPlB,gBAAUkB,UAXH;AAYPjB,iBAAWiB,UAZJ;AAaPhB,sBAAgBgB,UAbT;AAcPd,UAAIe,IAdG;AAePd,eAASc,IAfF;AAgBPb,WAAK,aAAUc,CAAV,EAAa;AAChB,eAAOH,KAAKG,EAAE7C,CAAF,CAAL,CAAP;AACD,OAlBM;AAmBPgC,YAAM,cAAUa,CAAV,EAAa;AACjBA,UAAE7C,CAAF;AACD,OArBM;AAsBPiC,YAAMA,IAtBC;AAuBPC,cAAQD,IAvBD;AAwBPE,cAAQF,IAxBD;AAyBPG,cAAQ,gBAAUS,CAAV,EAAa;AACnB,eAAOA,EAAE7C,CAAF,IAAOmB,EAAP,GAAYN,IAAnB;AACD,OA3BM;AA4BP0B,eAAS,mBAAY;AACnB,eAAO,CAACvC,CAAD,CAAP;AACD,OA9BM;AA+BPwC,gBAAU,oBAAY;AACpB,eAAO,UAAUxC,CAAV,GAAc,GAArB;AACD,OAjCM;AAkCPqC,cAAQ,gBAAUtB,CAAV,EAAa;AACnB,eAAOA,EAAEM,EAAF,CAAKrB,CAAL,CAAP;AACD,OApCM;AAqCPsC,eAAS,iBAAUvB,CAAV,EAAa+B,SAAb,EAAwB;AAC/B,eAAO/B,EAAEK,IAAF,CAAOV,KAAP,EAAc,UAAUqC,CAAV,EAAa;AAChC,iBAAOD,UAAU9C,CAAV,EAAa+C,CAAb,CAAP;AACD,SAFM,CAAP;AAGD;AAzCM,KAAT;AA2CA,WAAO5B,EAAP;AACD,GApDD;AAqDA,MAAI6B,OAAO,SAAPA,IAAO,CAAU7E,KAAV,EAAiB;AAC1B,WAAOA,UAAU,IAAV,IAAkBA,UAAUyD,SAA5B,GAAwCf,IAAxC,GAA+C6B,KAAKvE,KAAL,CAAtD;AACD,GAFD;AAGA,MAAI8E,SAAS;AACXP,UAAMA,IADK;AAEX9B,UAAMA,IAFK;AAGXoC,UAAMA;AAHK,GAAb;;AAMA,MAAIE,SAAS,SAATA,MAAS,CAAU5C,CAAV,EAAa;AACxB,QAAIA,MAAM,IAAV,EAAgB;AACd,aAAO,MAAP;AACD;AACD,QAAItB,WAAWsB,CAAX,yCAAWA,CAAX,CAAJ;AACA,QAAItB,MAAM,QAAN,KAAmBc,MAAMP,SAAN,CAAgB4D,aAAhB,CAA8B7C,CAA9B,KAAoCA,EAAE8C,WAAF,IAAiB9C,EAAE8C,WAAF,CAAcC,IAAd,KAAuB,OAA/F,CAAJ,EAA6G;AAC3G,aAAO,OAAP;AACD;AACD,QAAIrE,MAAM,QAAN,KAAmBsE,OAAO/D,SAAP,CAAiB4D,aAAjB,CAA+B7C,CAA/B,KAAqCA,EAAE8C,WAAF,IAAiB9C,EAAE8C,WAAF,CAAcC,IAAd,KAAuB,QAAhG,CAAJ,EAA+G;AAC7G,aAAO,QAAP;AACD;AACD,WAAOrE,CAAP;AACD,GAZD;AAaA,MAAIuE,SAAS,SAATA,MAAS,CAAUC,IAAV,EAAgB;AAC3B,WAAO,UAAUrF,KAAV,EAAiB;AACtB,aAAO+E,OAAO/E,KAAP,MAAkBqF,IAAzB;AACD,KAFD;AAGD,GAJD;AAKA,MAAIC,WAAWF,OAAO,QAAP,CAAf;AACA,MAAIG,WAAWH,OAAO,QAAP,CAAf;AACA,MAAII,UAAUJ,OAAO,OAAP,CAAd;AACA,MAAIK,aAAaL,OAAO,UAAP,CAAjB;;AAEA,MAAIM,cAAc/D,MAAMP,SAAN,CAAgBuE,KAAlC;AACA,MAAIC,gBAAgBjE,MAAMP,SAAN,CAAgByE,OAApC;AACA,MAAIC,aAAa,SAAbA,UAAa,CAAUC,EAAV,EAAclF,CAAd,EAAiB;AAChC,WAAO+E,cAActE,IAAd,CAAmByE,EAAnB,EAAuBlF,CAAvB,CAAP;AACD,GAFD;AAGA,MAAImF,WAAW,SAAXA,QAAW,CAAUC,EAAV,EAAc9D,CAAd,EAAiB;AAC9B,WAAO2D,WAAWG,EAAX,EAAe9D,CAAf,IAAoB,CAAC,CAA5B;AACD,GAFD;AAGA,MAAIyB,MAAM,SAANA,GAAM,CAAUqC,EAAV,EAAcvB,CAAd,EAAiB;AACzB,QAAIwB,MAAMD,GAAG/E,MAAb;AACA,QAAIQ,IAAI,IAAIC,KAAJ,CAAUuE,GAAV,CAAR;AACA,SAAK,IAAInF,IAAI,CAAb,EAAgBA,IAAImF,GAApB,EAAyBnF,GAAzB,EAA8B;AAC5B,UAAIoB,IAAI8D,GAAGlF,CAAH,CAAR;AACAW,QAAEX,CAAF,IAAO2D,EAAEvC,CAAF,EAAKpB,CAAL,CAAP;AACD;AACD,WAAOW,CAAP;AACD,GARD;AASA,MAAImC,OAAO,SAAPA,IAAO,CAAUoC,EAAV,EAAcvB,CAAd,EAAiB;AAC1B,SAAK,IAAI3D,IAAI,CAAR,EAAWmF,MAAMD,GAAG/E,MAAzB,EAAiCH,IAAImF,GAArC,EAA0CnF,GAA1C,EAA+C;AAC7C,UAAIoB,IAAI8D,GAAGlF,CAAH,CAAR;AACA2D,QAAEvC,CAAF,EAAKpB,CAAL;AACD;AACF,GALD;AAMA,MAAIoF,QAAQ,SAARA,KAAQ,CAAUF,EAAV,EAAcvB,CAAd,EAAiB;AAC3B,SAAK,IAAI3D,IAAIkF,GAAG/E,MAAH,GAAY,CAAzB,EAA4BH,KAAK,CAAjC,EAAoCA,GAApC,EAAyC;AACvC,UAAIoB,IAAI8D,GAAGlF,CAAH,CAAR;AACA2D,QAAEvC,CAAF,EAAKpB,CAAL;AACD;AACF,GALD;AAMA,MAAIkD,SAAS,SAATA,MAAS,CAAUgC,EAAV,EAAcG,IAAd,EAAoB;AAC/B,QAAI1E,IAAI,EAAR;AACA,SAAK,IAAIX,IAAI,CAAR,EAAWmF,MAAMD,GAAG/E,MAAzB,EAAiCH,IAAImF,GAArC,EAA0CnF,GAA1C,EAA+C;AAC7C,UAAIoB,IAAI8D,GAAGlF,CAAH,CAAR;AACA,UAAIqF,KAAKjE,CAAL,EAAQpB,CAAR,CAAJ,EAAgB;AACdW,UAAE2E,IAAF,CAAOlE,CAAP;AACD;AACF;AACD,WAAOT,CAAP;AACD,GATD;AAUA,MAAI4E,QAAQ,SAARA,KAAQ,CAAUL,EAAV,EAAcvB,CAAd,EAAiB6B,GAAjB,EAAsB;AAChCJ,UAAMF,EAAN,EAAU,UAAU9D,CAAV,EAAa;AACrBoE,YAAM7B,EAAE6B,GAAF,EAAOpE,CAAP,CAAN;AACD,KAFD;AAGA,WAAOoE,GAAP;AACD,GALD;AAMA,MAAIC,QAAQ,SAARA,KAAQ,CAAUP,EAAV,EAAcvB,CAAd,EAAiB6B,GAAjB,EAAsB;AAChC1C,SAAKoC,EAAL,EAAS,UAAU9D,CAAV,EAAa;AACpBoE,YAAM7B,EAAE6B,GAAF,EAAOpE,CAAP,CAAN;AACD,KAFD;AAGA,WAAOoE,GAAP;AACD,GALD;AAMA,MAAIE,OAAO,SAAPA,IAAO,CAAUR,EAAV,EAAcG,IAAd,EAAoB;AAC7B,SAAK,IAAIrF,IAAI,CAAR,EAAWmF,MAAMD,GAAG/E,MAAzB,EAAiCH,IAAImF,GAArC,EAA0CnF,GAA1C,EAA+C;AAC7C,UAAIoB,IAAI8D,GAAGlF,CAAH,CAAR;AACA,UAAIqF,KAAKjE,CAAL,EAAQpB,CAAR,CAAJ,EAAgB;AACd,eAAO+D,OAAOP,IAAP,CAAYpC,CAAZ,CAAP;AACD;AACF;AACD,WAAO2C,OAAOrC,IAAP,EAAP;AACD,GARD;AASA,MAAIuB,SAAS,SAATA,MAAS,CAAUiC,EAAV,EAAcG,IAAd,EAAoB;AAC/B,SAAK,IAAIrF,IAAI,CAAR,EAAWmF,MAAMD,GAAG/E,MAAzB,EAAiCH,IAAImF,GAArC,EAA0C,EAAEnF,CAA5C,EAA+C;AAC7C,UAAIoB,IAAI8D,GAAGlF,CAAH,CAAR;AACA,UAAIqF,KAAKjE,CAAL,EAAQpB,CAAR,MAAe,IAAnB,EAAyB;AACvB,eAAO,KAAP;AACD;AACF;AACD,WAAO,IAAP;AACD,GARD;AASA,MAAI2F,OAAO,SAAPA,IAAO,CAAUT,EAAV,EAAcU,UAAd,EAA0B;AACnC,QAAIC,OAAOlB,YAAYpE,IAAZ,CAAiB2E,EAAjB,EAAqB,CAArB,CAAX;AACAW,SAAKF,IAAL,CAAUC,UAAV;AACA,WAAOC,IAAP;AACD,GAJD;AAKA,MAAIC,OAAO,SAAPA,IAAO,CAAUZ,EAAV,EAAc;AACvB,WAAOA,GAAG/E,MAAH,KAAc,CAAd,GAAkB4D,OAAOrC,IAAP,EAAlB,GAAkCqC,OAAOP,IAAP,CAAY0B,GAAG,CAAH,CAAZ,CAAzC;AACD,GAFD;AAGA,MAAIa,SAASrB,WAAW9D,MAAMkD,IAAjB,IAAyBlD,MAAMkD,IAA/B,GAAsC,UAAU1C,CAAV,EAAa;AAC9D,WAAOuD,YAAYpE,IAAZ,CAAiBa,CAAjB,CAAP;AACD,GAFD;;AAIA,MAAI4E,OAAOpG,OAAOoG,IAAlB;AACA,MAAI1F,iBAAiBV,OAAOU,cAA5B;AACA,MAAIpB,MAAM,SAANA,GAAM,CAAU+G,GAAV,EAAeC,GAAf,EAAoB;AAC5B,WAAOC,IAAIF,GAAJ,EAASC,GAAT,IAAgBnC,OAAOD,IAAP,CAAYmC,IAAIC,GAAJ,CAAZ,CAAhB,GAAwCnC,OAAOrC,IAAP,EAA/C;AACD,GAFD;AAGA,MAAIyE,MAAM,SAANA,GAAM,CAAUF,GAAV,EAAeC,GAAf,EAAoB;AAC5B,WAAO5F,eAAeC,IAAf,CAAoB0F,GAApB,EAAyBC,GAAzB,CAAP;AACD,GAFD;;AAIA,MAAIE,WAAW,SAAXA,QAAW,CAAUC,KAAV,EAAiB;AAC9B,QAAI,CAAC5B,QAAQ4B,KAAR,CAAL,EAAqB;AACnB,YAAM,IAAI9E,KAAJ,CAAU,wBAAV,CAAN;AACD;AACD,QAAI8E,MAAMlG,MAAN,KAAiB,CAArB,EAAwB;AACtB,YAAM,IAAIoB,KAAJ,CAAU,iCAAV,CAAN;AACD;AACD,QAAI+E,eAAe,EAAnB;AACA,QAAIC,MAAM,EAAV;AACAzD,SAAKuD,KAAL,EAAY,UAAUG,KAAV,EAAiBC,KAAjB,EAAwB;AAClC,UAAIC,SAASV,KAAKQ,KAAL,CAAb;AACA,UAAIE,OAAOvG,MAAP,KAAkB,CAAtB,EAAyB;AACvB,cAAM,IAAIoB,KAAJ,CAAU,gCAAV,CAAN;AACD;AACD,UAAI2E,MAAMQ,OAAO,CAAP,CAAV;AACA,UAAIzH,QAAQuH,MAAMN,GAAN,CAAZ;AACA,UAAIK,IAAIL,GAAJ,MAAaxD,SAAjB,EAA4B;AAC1B,cAAM,IAAInB,KAAJ,CAAU,4BAA4B2E,GAAtC,CAAN;AACD,OAFD,MAEO,IAAIA,QAAQ,MAAZ,EAAoB;AACzB,cAAM,IAAI3E,KAAJ,CAAU,uCAAV,CAAN;AACD,OAFM,MAEA,IAAI,CAACkD,QAAQxF,KAAR,CAAL,EAAqB;AAC1B,cAAM,IAAIsC,KAAJ,CAAU,iCAAV,CAAN;AACD;AACD+E,mBAAahB,IAAb,CAAkBY,GAAlB;AACAK,UAAIL,GAAJ,IAAW,YAAY;AACrB,YAAIS,YAAYzG,UAAUC,MAA1B;AACA,YAAIwG,cAAc1H,MAAMkB,MAAxB,EAAgC;AAC9B,gBAAM,IAAIoB,KAAJ,CAAU,uCAAuC2E,GAAvC,GAA6C,aAA7C,GAA6DjH,MAAMkB,MAAnE,GAA4E,IAA5E,GAAmFlB,KAAnF,GAA2F,SAA3F,GAAuG0H,SAAjH,CAAN;AACD;AACD,YAAIC,OAAO,IAAIhG,KAAJ,CAAU+F,SAAV,CAAX;AACA,aAAK,IAAI3G,IAAI,CAAb,EAAgBA,IAAI4G,KAAKzG,MAAzB,EAAiCH,GAAjC,EAAsC;AACpC4G,eAAK5G,CAAL,IAAUE,UAAUF,CAAV,CAAV;AACD;AACD,YAAI6G,QAAQ,SAARA,KAAQ,CAAUC,QAAV,EAAoB;AAC9B,cAAIC,aAAaf,KAAKc,QAAL,CAAjB;AACA,cAAIR,aAAanG,MAAb,KAAwB4G,WAAW5G,MAAvC,EAA+C;AAC7C,kBAAM,IAAIoB,KAAJ,CAAU,mDAAmD+E,aAAaU,IAAb,CAAkB,GAAlB,CAAnD,GAA4E,YAA5E,GAA2FD,WAAWC,IAAX,CAAgB,GAAhB,CAArG,CAAN;AACD;AACD,cAAIC,UAAUhE,OAAOqD,YAAP,EAAqB,UAAUY,MAAV,EAAkB;AACnD,mBAAOjC,SAAS8B,UAAT,EAAqBG,MAArB,CAAP;AACD,WAFa,CAAd;AAGA,cAAI,CAACD,OAAL,EAAc;AACZ,kBAAM,IAAI1F,KAAJ,CAAU,kEAAkEwF,WAAWC,IAAX,CAAgB,IAAhB,CAAlE,GAA0F,cAA1F,GAA2GV,aAAaU,IAAb,CAAkB,IAAlB,CAArH,CAAN;AACD;AACD,iBAAOF,SAASZ,GAAT,EAAc1F,KAAd,CAAoB,IAApB,EAA0BoG,IAA1B,CAAP;AACD,SAZD;AAaA,eAAO;AACL1E,gBAAM,gBAAY;AAChB,gBAAIhC,UAAUC,MAAV,KAAqBkG,MAAMlG,MAA/B,EAAuC;AACrC,oBAAM,IAAIoB,KAAJ,CAAU,iDAAiD8E,MAAMlG,MAAvD,GAAgE,QAAhE,GAA2ED,UAAUC,MAA/F,CAAN;AACD;AACD,gBAAIgH,SAASjH,UAAUuG,KAAV,CAAb;AACA,mBAAOU,OAAO3G,KAAP,CAAa,IAAb,EAAmBoG,IAAnB,CAAP;AACD,WAPI;AAQLC,iBAAOA,KARF;AASLO,eAAK,aAAUC,KAAV,EAAiB;AACpBvI,uBAAWwI,OAAX,CAAmBF,GAAnB,CAAuBC,KAAvB,EAA8B;AAC5Bf,4BAAcA,YADc;AAE5BpC,2BAAagC,GAFe;AAG5BqB,sBAAQX;AAHoB,aAA9B;AAKD;AAfI,SAAP;AAiBD,OAvCD;AAwCD,KAvDD;AAwDA,WAAOL,GAAP;AACD,GAlED;AAmEA,MAAIiB,MAAM,EAAEpB,UAAUA,QAAZ,EAAV;;AAEA,MAAIqB,aAAaD,IAAIpB,QAAJ,CAAa,CAC5B;AACEsB,gBAAY,CACV,QADU,EAEV,QAFU;AADd,GAD4B,EAO5B;AACEC,gBAAY,CACV,QADU,EAEV,QAFU;AADd,GAP4B,EAa5B;AACEC,iBAAa,CACX,QADW,EAEX,QAFW;AADf,GAb4B,EAmB5B;AACEC,gBAAY,CACV,QADU,EAEV,QAFU;AADd,GAnB4B,CAAb,CAAjB;AA0BA,MAAIC,YAAY,SAAZA,SAAY,CAAUC,OAAV,EAAmB;AACjC,QAAIC,SAAS,EAAb;AACA,QAAIC,SAAS,EAAb;AACAnF,SAAKiF,OAAL,EAAc,UAAUG,MAAV,EAAkB;AAC9BA,aAAOhG,IAAP,CAAY,UAAUiG,GAAV,EAAe;AACzBH,eAAO1C,IAAP,CAAY6C,GAAZ;AACD,OAFD,EAEG,UAAUlJ,KAAV,EAAiB;AAClBgJ,eAAO3C,IAAP,CAAYrG,KAAZ;AACD,OAJD;AAKD,KAND;AAOA,WAAO;AACL+I,cAAQA,MADH;AAELC,cAAQA;AAFH,KAAP;AAID,GAdD;;AAgBA,MAAIhJ,QAAQ,SAARA,KAAQ,CAAU4C,CAAV,EAAa;AACvB,QAAIM,KAAK,SAALA,EAAK,CAAU/C,CAAV,EAAa;AACpB,aAAOyC,MAAMzC,CAAb;AACD,KAFD;AAGA,QAAIuD,KAAK,SAALA,EAAK,CAAUyF,GAAV,EAAe;AACtB,aAAOnJ,MAAM4C,CAAN,CAAP;AACD,KAFD;AAGA,QAAIe,UAAU,SAAVA,OAAU,CAAUe,CAAV,EAAa;AACzB,aAAO1E,MAAM4C,CAAN,CAAP;AACD,KAFD;AAGA,QAAIgB,MAAM,SAANA,GAAM,CAAUc,CAAV,EAAa;AACrB,aAAO1E,MAAM0E,EAAE9B,CAAF,CAAN,CAAP;AACD,KAFD;AAGA,QAAIwG,WAAW,SAAXA,QAAW,CAAU1E,CAAV,EAAa;AAC1B,aAAO1E,MAAM4C,CAAN,CAAP;AACD,KAFD;AAGA,QAAIiB,OAAO,SAAPA,IAAO,CAAUa,CAAV,EAAa;AACtBA,QAAE9B,CAAF;AACD,KAFD;AAGA,QAAIkB,OAAO,SAAPA,IAAO,CAAUY,CAAV,EAAa;AACtB,aAAOA,EAAE9B,CAAF,CAAP;AACD,KAFD;AAGA,QAAIK,OAAO,SAAPA,IAAO,CAAUoG,CAAV,EAAaC,OAAb,EAAsB;AAC/B,aAAOA,QAAQ1G,CAAR,CAAP;AACD,KAFD;AAGA,QAAImB,SAAS,SAATA,MAAS,CAAUW,CAAV,EAAa;AACxB,aAAOA,EAAE9B,CAAF,CAAP;AACD,KAFD;AAGA,QAAIoB,SAAS,SAATA,MAAS,CAAUU,CAAV,EAAa;AACxB,aAAOA,EAAE9B,CAAF,CAAP;AACD,KAFD;AAGA,QAAI2G,WAAW,SAAXA,QAAW,GAAY;AACzB,aAAOzE,OAAOP,IAAP,CAAY3B,CAAZ,CAAP;AACD,KAFD;AAGA,WAAO;AACLM,UAAIA,EADC;AAELsG,eAAShH,MAFJ;AAGLiH,eAASlH,KAHJ;AAILa,aAAOnB,SAASW,CAAT,CAJF;AAKLS,kBAAYpB,SAASW,CAAT,CALP;AAMLU,gBAAUrB,SAASW,CAAT,CANL;AAOLc,UAAIA,EAPC;AAQLC,eAASA,OARJ;AASLV,YAAMA,IATD;AAULW,WAAKA,GAVA;AAWLwF,gBAAUA,QAXL;AAYLvF,YAAMA,IAZD;AAaLC,YAAMA,IAbD;AAcLC,cAAQA,MAdH;AAeLC,cAAQA,MAfH;AAgBLuF,gBAAUA;AAhBL,KAAP;AAkBD,GApDD;AAqDA,MAAIG,QAAQ,SAARA,KAAQ,CAAUC,OAAV,EAAmB;AAC7B,QAAItG,aAAa,SAAbA,UAAa,CAAUqB,CAAV,EAAa;AAC5B,aAAOA,GAAP;AACD,KAFD;AAGA,QAAIpB,WAAW,SAAXA,QAAW,GAAY;AACzB,aAAOlB,IAAI+C,OAAOwE,OAAP,CAAJ,GAAP;AACD,KAFD;AAGA,QAAIjG,KAAK,SAALA,EAAK,CAAUyF,GAAV,EAAe;AACtB,aAAOA,GAAP;AACD,KAFD;AAGA,QAAIxF,UAAU,SAAVA,OAAU,CAAUe,CAAV,EAAa;AACzB,aAAOA,GAAP;AACD,KAFD;AAGA,QAAId,MAAM,SAANA,GAAM,CAAUc,CAAV,EAAa;AACrB,aAAOgF,MAAMC,OAAN,CAAP;AACD,KAFD;AAGA,QAAIP,WAAW,SAAXA,QAAW,CAAU1E,CAAV,EAAa;AAC1B,aAAOgF,MAAMhF,EAAEiF,OAAF,CAAN,CAAP;AACD,KAFD;AAGA,QAAI7F,OAAO,SAAPA,IAAO,CAAUY,CAAV,EAAa;AACtB,aAAOgF,MAAMC,OAAN,CAAP;AACD,KAFD;AAGA,QAAI1G,OAAO,SAAPA,IAAO,CAAU2G,OAAV,EAAmBP,CAAnB,EAAsB;AAC/B,aAAOO,QAAQD,OAAR,CAAP;AACD,KAFD;AAGA,WAAO;AACLzG,UAAIX,KADC;AAELiH,eAASjH,KAFJ;AAGLkH,eAASjH,MAHJ;AAILY,aAAOlB,QAJF;AAKLmB,kBAAYA,UALP;AAMLC,gBAAUA,QANL;AAOLI,UAAIA,EAPC;AAQLC,eAASA,OARJ;AASLV,YAAMA,IATD;AAULW,WAAKA,GAVA;AAWLwF,gBAAUA,QAXL;AAYLvF,YAAM7B,IAZD;AAaL8B,YAAMA,IAbD;AAcLC,cAAQxB,KAdH;AAeLyB,cAAQxB,MAfH;AAgBL+G,gBAAUzE,OAAOrC;AAhBZ,KAAP;AAkBD,GA3CD;AA4CA,MAAIoH,aAAa,SAAbA,UAAa,CAAUV,GAAV,EAAeD,GAAf,EAAoB;AACnC,WAAOC,IAAIlG,IAAJ,CAAS,YAAY;AAC1B,aAAOyG,MAAMR,GAAN,CAAP;AACD,KAFM,EAEJlJ,KAFI,CAAP;AAGD,GAJD;AAKA,MAAI8J,SAAS;AACX9J,WAAOA,KADI;AAEX0J,WAAOA,KAFI;AAGXG,gBAAYA;AAHD,GAAb;;AAMA,MAAIE,kBAAkB,SAAlBA,eAAkB,CAAUC,OAAV,EAAmB;AACvC,WAAOA,QAAQ3E,IAAR,KAAiB,gBAAjB,IAAqC2E,QAAQ3E,IAAR,KAAiB,eAA7D;AACD,GAFD;AAGA,MAAI4E,iBAAiB,SAAjBA,cAAiB,CAAUD,OAAV,EAAmB;AACtC,WAAOA,QAAQ3E,IAAR,KAAiB,eAAjB,IAAoC2E,QAAQ3E,IAAR,KAAiB,cAA5D;AACD,GAFD;AAGA,MAAI6E,eAAe,SAAfA,YAAe,CAAUC,QAAV,EAAoB;AACrC,WAAOzD,KAAKyD,QAAL,EAAe,UAAUtI,CAAV,EAAa+C,CAAb,EAAgB;AACpC,UAAI/C,EAAEuI,KAAF,CAAQlJ,MAAR,KAAmB0D,EAAEwF,KAAF,CAAQlJ,MAA/B,EAAuC;AACrC,eAAO,CAAP;AACD;AACD,aAAOW,EAAEuI,KAAF,CAAQlJ,MAAR,GAAiB0D,EAAEwF,KAAF,CAAQlJ,MAAzB,GAAkC,CAAC,CAAnC,GAAuC,CAA9C;AACD,KALM,CAAP;AAMD,GAPD;AAQA,MAAImJ,mBAAmB,SAAnBA,gBAAmB,CAAUL,OAAV,EAAmB;AACxC,QAAId,MAAM,SAANA,GAAM,CAAUS,OAAV,EAAmB;AAC3B,aAAOG,OAAOJ,KAAP,CAAa;AAClBC,iBAASA,OADS;AAElBK,iBAASA;AAFS,OAAb,CAAP;AAID,KALD;AAMA,QAAIM,cAAc,SAAdA,WAAc,CAAUpF,IAAV,EAAgBqF,QAAhB,EAA0BC,SAA1B,EAAqC;AACrD,UAAIR,QAAQS,MAAR,KAAmBhH,SAAvB,EAAkC;AAChC,YAAIiH,UAAU,KAAK,CAAnB;AACA,YAAIlF,QAAQwE,QAAQS,MAAhB,CAAJ,EAA6B;AAC3B,cAAI,CAACzG,OAAOgG,QAAQS,MAAf,EAAuBnF,QAAvB,CAAL,EAAuC;AACrC,mBAAO4D,IAAIhE,OAAO,qDAAX,CAAP;AACD;AACDwF,oBAAUV,QAAQS,MAAlB;AACD,SALD,MAKO,IAAInF,SAAS0E,QAAQS,MAAjB,CAAJ,EAA8B;AACnCC,oBAAU,CAACV,QAAQS,MAAT,CAAV;AACD,SAFM,MAEA;AACL,iBAAOvB,IAAIhE,OAAO,4CAAX,CAAP;AACD;AACD,eAAO4E,OAAO9J,KAAP,CAAauK,SAASG,OAAT,CAAb,CAAP;AACD,OAbD,MAaO,IAAIV,QAAQW,GAAR,KAAgBlH,SAApB,EAA+B;AACpC,YAAI,CAAC6B,SAAS0E,QAAQW,GAAjB,CAAL,EAA4B;AAC1B,iBAAOzB,IAAIhE,OAAO,yCAAX,CAAP;AACD;AACD,eAAO4E,OAAO9J,KAAP,CAAawK,UAAUR,QAAQW,GAAlB,EAAuBX,QAAQhK,KAA/B,CAAb,CAAP;AACD,OALM,MAKA;AACL,eAAOkJ,IAAIhE,OAAO,wDAAX,CAAP;AACD;AACF,KAtBD;AAuBA,QAAI,CAACK,SAASyE,OAAT,CAAL,EAAwB;AACtB,aAAOd,IAAI,8BAAJ,CAAP;AACD;AACD,QAAI,CAAC5D,SAAS0E,QAAQI,KAAjB,CAAL,EAA8B;AAC5B,aAAOlB,IAAI,0CAAJ,CAAP;AACD;AACD,QAAIc,QAAQY,GAAR,KAAgBnH,SAApB,EAA+B;AAC7B,UAAI,CAAC6B,SAAS0E,QAAQY,GAAjB,CAAL,EAA4B;AAC1B,eAAO1B,IAAI,+CAAJ,CAAP;AACD;AACD,UAAIc,QAAQI,KAAR,CAAclJ,MAAd,KAAyB,CAAzB,IAA8B8I,QAAQY,GAAR,CAAY1J,MAAZ,KAAuB,CAAzD,EAA4D;AAC1D,eAAOgI,IAAI,uDAAJ,CAAP;AACD;AACD,UAAI2B,UAAUb,QAAQI,KAAtB;AACA,UAAIU,QAAQd,QAAQY,GAApB;AACA,UAAIE,MAAM5J,MAAN,KAAiB,CAArB,EAAwB;AACtB4J,gBAAQD,OAAR;AACAA,kBAAU,EAAV;AACD;AACD,aAAOP,YAAY,QAAZ,EAAsB,UAAUG,MAAV,EAAkB;AAC7C,eAAO;AACLpF,gBAAM,eADD;AAEL+E,iBAAOS,OAFF;AAGLD,eAAKE,KAHA;AAILL,kBAAQA;AAJH,SAAP;AAMD,OAPM,EAOJ,UAAUE,GAAV,EAAe3K,KAAf,EAAsB;AACvB,eAAO;AACLqF,gBAAM,gBADD;AAEL+E,iBAAOS,OAFF;AAGLD,eAAKE,KAHA;AAILH,eAAKA,GAJA;AAKL3K,iBAAOA;AALF,SAAP;AAOD,OAfM,CAAP;AAgBD,KA7BD,MA6BO,IAAIgK,QAAQe,WAAR,KAAwBtH,SAA5B,EAAuC;AAC5C,UAAI,CAAC6B,SAAS0E,QAAQe,WAAjB,CAAL,EAAoC;AAClC,eAAO7B,IAAI,4DAAJ,CAAP;AACD;AACD,UAAIc,QAAQI,KAAR,CAAclJ,MAAd,KAAyB,CAA7B,EAAgC;AAC9B,eAAOgI,IAAI,iDAAJ,CAAP;AACD;AACD,aAAOY,OAAO9J,KAAP,CAAa;AAClBqF,cAAM,gBADY;AAElB+E,eAAO,EAFW;AAGlBQ,aAAKZ,QAAQI,KAHK;AAIlBO,aAAK,kBAJa;AAKlB3K,eAAOgK,QAAQe;AALG,OAAb,CAAP;AAOD,KAdM,MAcA;AACL,UAAIf,QAAQI,KAAR,CAAclJ,MAAd,KAAyB,CAA7B,EAAgC;AAC9B,eAAOgI,IAAI,2CAAJ,CAAP;AACD;AACD,aAAOoB,YAAY,OAAZ,EAAqB,UAAUI,OAAV,EAAmB;AAC7C,eAAO;AACLrF,gBAAM,cADD;AAEL+E,iBAAOJ,QAAQI,KAFV;AAGLK,kBAAQC,QAAQ,CAAR;AAHH,SAAP;AAKD,OANM,EAMJ,UAAUM,OAAV,EAAmBC,YAAnB,EAAiC;AAClC,eAAO;AACL5F,gBAAM,eADD;AAEL+E,iBAAOJ,QAAQI,KAFV;AAGLO,eAAKK,OAHA;AAILhL,iBAAOiL;AAJF,SAAP;AAMD,OAbM,CAAP;AAcD;AACF,GAlGD;AAmGA,MAAIC,qBAAqB,SAArBA,kBAAqB,CAAUlB,OAAV,EAAmB;AAC1C,QAAIA,QAAQ3E,IAAR,KAAiB,eAArB,EAAsC;AACpC,aAAO;AACL+E,eAAOJ,QAAQI,KADV;AAELO,aAAKX,QAAQW,GAFR;AAGL3K,eAAOgK,QAAQhK;AAHV,OAAP;AAKD,KAND,MAMO,IAAIgK,QAAQ3E,IAAR,KAAiB,cAArB,EAAqC;AAC1C,aAAO;AACL+E,eAAOJ,QAAQI,KADV;AAELK,gBAAQT,QAAQS;AAFX,OAAP;AAID,KALM,MAKA,IAAIT,QAAQ3E,IAAR,KAAiB,gBAArB,EAAuC;AAC5C,UAAI2E,QAAQW,GAAR,KAAgB,kBAAhB,IAAsCX,QAAQI,KAAR,KAAkB,EAA5D,EAAgE;AAC9D,eAAO;AACLA,iBAAOJ,QAAQY,GADV;AAELG,uBAAaf,QAAQhK;AAFhB,SAAP;AAID,OALD,MAKO;AACL,eAAO;AACLoK,iBAAOJ,QAAQI,KADV;AAELQ,eAAKZ,QAAQY,GAFR;AAGLD,eAAKX,QAAQW,GAHR;AAIL3K,iBAAOgK,QAAQhK;AAJV,SAAP;AAMD;AACF,KAdM,MAcA,IAAIgK,QAAQ3E,IAAR,KAAiB,eAArB,EAAsC;AAC3C,aAAO;AACL+E,eAAOJ,QAAQI,KADV;AAELQ,aAAKZ,QAAQY,GAFR;AAGLH,gBAAQT,QAAQS,MAAR,CAAevJ,MAAf,KAA0B,CAA1B,GAA8B8I,QAAQS,MAAR,CAAe,CAAf,CAA9B,GAAkDT,QAAQS;AAH7D,OAAP;AAKD;AACF,GAjCD;AAkCA,MAAIU,mBAAmB,SAAnBA,gBAAmB,CAAUhB,QAAV,EAAoB;AACzC,WAAO;AACLiB,sBAAgBnH,OAAOkG,QAAP,EAAiBJ,eAAjB,CADX;AAELsB,qBAAenB,aAAajG,OAAOkG,QAAP,EAAiBF,cAAjB,CAAb;AAFV,KAAP;AAID,GALD;;AAOA,MAAIqB,QAAQ,SAARA,KAAQ,CAAUC,aAAV,EAAyB;AACnC,QAAIC,cAAc,SAAdA,WAAc,CAAUC,WAAV,EAAuB;AACvC,UAAIC,aAAa7C,UAAUjF,IAAI6H,WAAJ,EAAiBpB,gBAAjB,CAAV,CAAjB;AACA,UAAIqB,WAAW3C,MAAX,CAAkB7H,MAAlB,GAA2B,CAA/B,EAAkC;AAChC,YAAIwH,aAAagD,WAAW3C,MAAX,CAAkB,CAAlB,CAAjB;AACA,cAAM,IAAIzG,KAAJ,CAAUoG,WAAWiB,OAAX,GAAqB,KAArB,GAA6BgC,KAAKC,SAAL,CAAelD,WAAWsB,OAA1B,EAAmC,IAAnC,EAAyC,CAAzC,CAAvC,CAAN;AACD;AACDuB,oBAAcrL,GAAd,CAAkBiL,iBAAiBO,WAAW1C,MAA5B,CAAlB;AACD,KAPD;AAQA,QAAI6C,cAAc,SAAdA,WAAc,GAAY;AAC5B,aAAOrK,eAAeoC,IAAI2H,cAActL,GAAd,GAAoBmL,cAAxB,EAAwCF,kBAAxC,CAAf,EAA4EtH,IAAI2H,cAActL,GAAd,GAAoBoL,aAAxB,EAAuCH,kBAAvC,CAA5E,CAAP;AACD,KAFD;AAGA,WAAO;AACLM,mBAAaA,WADR;AAELK,mBAAaA;AAFR,KAAP;AAID,GAhBD;AAiBA,MAAIC,MAAM,EAAE7L,KAAKqL,KAAP,EAAV;;AAEA,MAAIS,SAAS,OAAOlM,WAAWmM,MAAlB,KAA6B,WAA7B,GAA2CnM,WAAWmM,MAAtD,GAA+DC,SAAS,cAAT,GAA5E;;AAEA,MAAIC,UAAU,SAAVA,OAAU,GAAY;AACxB,QAAIvE,OAAO,EAAX;AACA,SAAK,IAAIwE,KAAK,CAAd,EAAiBA,KAAKlL,UAAUC,MAAhC,EAAwCiL,IAAxC,EAA8C;AAC5CxE,WAAKwE,EAAL,IAAWlL,UAAUkL,EAAV,CAAX;AACD;AACD,QAAI9D,UAAU0D,OAAO1D,OAArB;AACA,QAAIA,OAAJ,EAAa;AACX,UAAIA,QAAQqB,KAAZ,EAAmB;AACjBrB,gBAAQqB,KAAR,CAAcnI,KAAd,CAAoB8G,OAApB,EAA6BV,IAA7B;AACD,OAFD,MAEO;AACLU,gBAAQF,GAAR,CAAY5G,KAAZ,CAAkB8G,OAAlB,EAA2BV,IAA3B;AACD;AACF;AACF,GAbD;AAcA,MAAIyE,kBAAkB,CACpB;AACEhC,WAAO,GADT;AAEEQ,SAAK,GAFP;AAGEH,YAAQ;AAHV,GADoB,EAMpB;AACEL,WAAO,IADT;AAEEQ,SAAK,IAFP;AAGEH,YAAQ;AAHV,GANoB,EAWpB;AACEL,WAAO,GADT;AAEEK,YAAQ;AAFV,GAXoB,EAepB;AACEL,WAAO,IADT;AAEEK,YAAQ;AAFV,GAfoB,EAmBpB;AACEL,WAAO,KADT;AAEEK,YAAQ;AAFV,GAnBoB,EAuBpB;AACEL,WAAO,MADT;AAEEK,YAAQ;AAFV,GAvBoB,EA2BpB;AACEL,WAAO,OADT;AAEEK,YAAQ;AAFV,GA3BoB,EA+BpB;AACEL,WAAO,QADT;AAEEK,YAAQ;AAFV,GA/BoB,EAmCpB;AACEL,WAAO,KADT;AAEEO,SAAK;AAFP,GAnCoB,EAuCpB;AACEP,WAAO,IADT;AAEEO,SAAK;AAFP,GAvCoB,EA2CpB;AACEP,WAAO,IADT;AAEEO,SAAK;AAFP,GA3CoB,CAAtB;AAgDA,MAAI0B,gBAAgB,SAAhBA,aAAgB,CAAUC,cAAV,EAA0B;AAC5C,QAAInC,WAAWlK,IAAIqM,cAAJ,EAAoB,sBAApB,EAA4ClJ,KAA5C,CAAkDgJ,eAAlD,CAAf;AACA,QAAI,CAAC5G,QAAQ2E,QAAR,CAAL,EAAwB;AACtB+B,cAAQ,qDAAR;AACA,aAAO;AACLd,wBAAgB,EADX;AAELC,uBAAe;AAFV,OAAP;AAID;AACD,QAAIK,aAAa7C,UAAUjF,IAAIuG,QAAJ,EAAcE,gBAAd,CAAV,CAAjB;AACAxG,SAAK6H,WAAW3C,MAAhB,EAAwB,UAAUG,GAAV,EAAe;AACrC,aAAOgD,QAAQhD,IAAIS,OAAZ,EAAqBT,IAAIc,OAAzB,CAAP;AACD,KAFD;AAGA,WAAOmB,iBAAiBO,WAAW1C,MAA5B,CAAP;AACD,GAdD;AAeA,MAAIuD,qBAAqB,SAArBA,kBAAqB,CAAUC,MAAV,EAAkB;AACzC,QAAIC,QAAQD,OAAOE,QAAP,CAAgB,mBAAhB,EAAqC,GAArC,CAAZ;AACA,QAAID,UAAU,KAAd,EAAqB;AACnB,aAAO,EAAP;AACD,KAFD,MAEO,IAAIA,UAAU,IAAd,EAAoB;AACzB,aAAO,GAAP;AACD,KAFM,MAEA;AACL,aAAOA,KAAP;AACD;AACF,GATD;;AAWA,MAAIE,WAAWrM,QAAQC,IAAR,CAAaC,KAAb,CAAmBC,OAAnB,CAA2B,oBAA3B,CAAf;;AAEA,MAAImM,WAAWtM,QAAQC,IAAR,CAAaC,KAAb,CAAmBC,OAAnB,CAA2B,iBAA3B,CAAf;;AAEA,MAAIoM,YAAY,SAAZA,SAAY,GAAY;AAC1B,WAAO,QAAP;AACD,GAFD;;AAIA,MAAIC,WAAWxM,QAAQC,IAAR,CAAaC,KAAb,CAAmBC,OAAnB,CAA2B,oBAA3B,CAAf;;AAEA,MAAIsM,WAAWzM,QAAQC,IAAR,CAAaC,KAAb,CAAmBC,OAAnB,CAA2B,wBAA3B,CAAf;;AAEA,MAAIuM,SAAS,SAATA,MAAS,CAAUC,IAAV,EAAgB;AAC3B,WAAOA,KAAKC,QAAL,KAAkBrN,WAAWsN,IAAX,CAAgBC,SAAzC;AACD,GAFD;AAGA,MAAIC,kBAAkB,SAAlBA,eAAkB,CAAUC,GAAV,EAAeL,IAAf,EAAqBM,MAArB,EAA6B;AACjD,QAAIN,QAAQK,IAAIE,OAAJ,CAAYP,IAAZ,CAAR,IAA6B,CAACM,OAAON,IAAP,CAAlC,EAAgD;AAC9C,UAAIQ,SAASR,KAAKS,UAAlB;AACAJ,UAAIK,MAAJ,CAAWV,IAAX;AACAI,sBAAgBC,GAAhB,EAAqBG,MAArB,EAA6BF,MAA7B;AACD;AACF,GAND;AAOA,MAAIK,YAAY,SAAZA,SAAY,CAAUN,GAAV,EAAeO,GAAf,EAAoBN,MAApB,EAA4BO,KAA5B,EAAmC;AACjD,QAAIA,UAAU,KAAK,CAAnB,EAAsB;AACpBA,cAAQ,IAAR;AACD;AACD,QAAIC,cAAcF,IAAIG,cAAJ,CAAmBN,UAArC;AACA,QAAIO,YAAYJ,IAAIK,YAAJ,CAAiBR,UAAjC;AACAG,QAAIM,cAAJ;AACA,QAAIL,SAAS,CAACP,OAAOM,IAAIG,cAAX,CAAd,EAA0C;AACxC,UAAIhB,OAAOa,IAAIG,cAAX,KAA8BH,IAAIG,cAAJ,CAAmBI,IAAnB,CAAwBlN,MAAxB,KAAmC,CAArE,EAAwE;AACtEoM,YAAIK,MAAJ,CAAWE,IAAIG,cAAf;AACD;AACD,UAAIhB,OAAOa,IAAIK,YAAX,KAA4BL,IAAIK,YAAJ,CAAiBE,IAAjB,CAAsBlN,MAAtB,KAAiC,CAAjE,EAAoE;AAClEoM,YAAIK,MAAJ,CAAWE,IAAIK,YAAf;AACD;AACDb,sBAAgBC,GAAhB,EAAqBS,WAArB,EAAkCR,MAAlC;AACA,UAAIQ,gBAAgBE,SAApB,EAA+B;AAC7BZ,wBAAgBC,GAAhB,EAAqBW,SAArB,EAAgCV,MAAhC;AACD;AACF;AACF,GAnBD;AAoBA,MAAIc,oBAAoB,SAApBA,iBAAoB,CAAUnJ,IAAV,EAAgBoJ,SAAhB,EAA2B;AACjD,QAAIC,YAAYD,UAAUrO,GAAV,CAAciF,IAAd,CAAhB;AACA,WAAOM,QAAQ+I,SAAR,KAAsB1H,KAAK0H,SAAL,EAAgBxK,MAAhB,CAAuB,UAAU0G,MAAV,EAAkB;AACpE,aAAOvD,IAAIuD,MAAJ,EAAY,OAAZ,CAAP;AACD,KAF4B,CAA7B;AAGD,GALD;AAMA,MAAI+D,oBAAoB,SAApBA,iBAAoB,CAAUxE,OAAV,EAAmB;AACzC,WAAO9C,IAAI8C,OAAJ,EAAa,KAAb,CAAP;AACD,GAFD;AAGA,MAAIyE,uBAAuB,SAAvBA,oBAAuB,CAAUzE,OAAV,EAAmB;AAC5C,WAAOA,QAAQI,KAAR,CAAclJ,MAAd,KAAyB,CAAhC;AACD,GAFD;AAGA,MAAIwN,cAAc,SAAdA,WAAc,CAAUvE,QAAV,EAAoBwE,IAApB,EAA0B;AAC1C,WAAOlI,KAAK0D,QAAL,EAAe,UAAUH,OAAV,EAAmB;AACvC,UAAI2E,KAAK9I,OAAL,CAAamE,QAAQI,KAArB,MAAgC,CAApC,EAAuC;AACrC,eAAO,KAAP;AACD;AACD,UAAIoE,kBAAkBxE,OAAlB,KAA8BA,QAAQY,GAAtC,IAA6C+D,KAAKC,WAAL,CAAiB5E,QAAQY,GAAzB,MAAkC+D,KAAKzN,MAAL,GAAc8I,QAAQY,GAAR,CAAY1J,MAA7G,EAAqH;AACnH,eAAO,KAAP;AACD;AACD,aAAO,IAAP;AACD,KARM,CAAP;AASD,GAVD;AAWA,MAAI2N,iBAAiB,SAAjBA,cAAiB,CAAUrC,MAAV,EAAkBqB,GAAlB,EAAuB;AAC1C,QAAIiB,iBAAiBhK,OAAOD,IAAP,CAAY2H,OAAOc,GAAP,CAAWyB,SAAX,CAAqBlB,IAAIG,cAAzB,EAAyCxB,OAAOc,GAAP,CAAW0B,OAApD,CAAZ,CAArB;AACA,QAAIzC,mBAAmBC,MAAnB,MAA+B,EAAnC,EAAuC;AACrC,aAAOsC,eAAenL,OAAf,CAAuB,YAAY;AACxC,eAAOmB,OAAOP,IAAP,CAAYiI,OAAOyC,OAAP,EAAZ,CAAP;AACD,OAFM,CAAP;AAGD,KAJD,MAIO;AACL,aAAOH,cAAP;AACD;AACF,GATD;;AAWA,MAAII,QAAQ,SAARA,KAAQ,CAAUC,OAAV,EAAmBC,MAAnB,EAA2B;AACrC,WAAO;AACLD,eAASA,OADJ;AAELC,cAAQA;AAFH,KAAP;AAID,GALD;;AAOA,MAAIC,aAAa,SAAbA,UAAa,CAAUC,SAAV,EAAqBC,QAArB,EAA+B;AAC9C,QAAIC,SAAS,IAAIzC,QAAJ,CAAauC,SAAb,EAAwBC,QAAxB,CAAb;AACA,QAAIE,OAAO,SAAPA,IAAO,CAAUC,SAAV,EAAqB;AAC9B,UAAIC,OAAOH,OAAOE,SAAP,GAAX;AACA,aAAOC,QAAQA,KAAKzC,QAAL,KAAkBrN,WAAWsN,IAAX,CAAgBC,SAAjD,EAA4D;AAC1DuC,eAAOH,OAAOE,SAAP,GAAP;AACD;AACD,aAAOC,QAAQA,KAAKzC,QAAL,KAAkBrN,WAAWsN,IAAX,CAAgBC,SAA1C,GAAsDtI,OAAOP,IAAP,CAAYoL,IAAZ,CAAtD,GAA0E7K,OAAOrC,IAAP,EAAjF;AACD,KAND;AAOA,WAAO;AACLkN,YAAM,gBAAY;AAChB,eAAOF,KAAK,MAAL,CAAP;AACD,OAHI;AAILG,YAAM,gBAAY;AAChB,eAAOH,KAAK,MAAL,CAAP;AACD,OANI;AAOLI,aAAO,iBAAY;AACjB,eAAOJ,KAAK,OAAL,CAAP;AACD;AATI,KAAP;AAWD,GApBD;;AAsBA,MAAIK,aAAa,SAAbA,UAAa,CAAU7C,IAAV,EAAgBmC,MAAhB,EAAwBG,QAAxB,EAAkC;AACjD,QAAIvC,OAAOC,IAAP,KAAgBmC,UAAU,CAA9B,EAAiC;AAC/B,aAAOtK,OAAOP,IAAP,CAAY2K,MAAMjC,IAAN,EAAYmC,MAAZ,CAAZ,CAAP;AACD,KAFD,MAEO;AACL,UAAIW,aAAaV,WAAWpC,IAAX,EAAiBsC,QAAjB,CAAjB;AACA,aAAOQ,WAAWH,IAAX,GAAkBhM,GAAlB,CAAsB,UAAUgM,IAAV,EAAgB;AAC3C,eAAOV,MAAMU,IAAN,EAAYA,KAAKxB,IAAL,CAAUlN,MAAtB,CAAP;AACD,OAFM,CAAP;AAGD;AACF,GATD;AAUA,MAAI8O,WAAW,SAAXA,QAAW,CAAU/C,IAAV,EAAgBmC,MAAhB,EAAwBG,QAAxB,EAAkC;AAC/C,QAAI,CAACvC,OAAOC,IAAP,CAAL,EAAmB;AACjB,aAAOnI,OAAOrC,IAAP,EAAP;AACD;AACD,QAAIkM,OAAO1B,KAAKgD,WAAhB;AACA,QAAIb,UAAU,CAAV,IAAeA,UAAUT,KAAKzN,MAAlC,EAA0C;AACxC,aAAO4D,OAAOP,IAAP,CAAY2K,MAAMjC,IAAN,EAAYmC,MAAZ,CAAZ,CAAP;AACD,KAFD,MAEO;AACL,UAAIW,aAAaV,WAAWpC,IAAX,EAAiBsC,QAAjB,CAAjB;AACA,aAAOQ,WAAWH,IAAX,GAAkB9L,IAAlB,CAAuB,UAAU8L,IAAV,EAAgB;AAC5C,YAAIM,WAAWN,KAAKK,WAApB;AACA,eAAOD,SAASJ,IAAT,EAAeR,SAASc,SAAShP,MAAjC,EAAyCqO,QAAzC,CAAP;AACD,OAHM,CAAP;AAID;AACF,GAdD;AAeA,MAAIY,YAAY,SAAZA,SAAY,CAAUlD,IAAV,EAAgBmC,MAAhB,EAAwBG,QAAxB,EAAkC;AAChD,QAAI,CAACvC,OAAOC,IAAP,CAAL,EAAmB;AACjB,aAAOnI,OAAOrC,IAAP,EAAP;AACD;AACD,QAAIkM,OAAO1B,KAAKgD,WAAhB;AACA,QAAIb,UAAUT,KAAKzN,MAAnB,EAA2B;AACzB,aAAO4D,OAAOP,IAAP,CAAY2K,MAAMjC,IAAN,EAAYmC,MAAZ,CAAZ,CAAP;AACD,KAFD,MAEO;AACL,UAAIW,aAAaV,WAAWpC,IAAX,EAAiBsC,QAAjB,CAAjB;AACA,aAAOQ,WAAWJ,IAAX,GAAkB7L,IAAlB,CAAuB,UAAU6L,IAAV,EAAgB;AAC5C,eAAOQ,UAAUR,IAAV,EAAgBP,SAAST,KAAKzN,MAA9B,EAAsCqO,QAAtC,CAAP;AACD,OAFM,CAAP;AAGD;AACF,GAbD;AAcA,MAAIa,aAAa,SAAbA,UAAa,CAAU9C,GAAV,EAAeL,IAAf,EAAqB;AACpC,WAAOK,IAAI0B,OAAJ,CAAY/B,IAAZ,KAAqBjH,SAAS,CACnC,IADmC,EAEnC,KAFmC,EAGnC,IAHmC,EAInC,OAJmC,CAAT,EAKzBiH,KAAKoD,QALoB,CAArB,IAKc/C,IAAIgD,kBAAJ,CAAuBrD,IAAvB,MAAiC,OALtD;AAMD,GAPD;AAQA,MAAIsD,UAAUhI,IAAIpB,QAAJ,CAAa,CACzB,EAAEqJ,SAAS,EAAX,EADyB,EAEzB,EAAEC,MAAM,CAAC,SAAD,CAAR,EAFyB,EAGzB,EAAEC,SAAS,CAAC,MAAD,CAAX,EAHyB,CAAb,CAAd;AAKA,MAAIC,QAAQpI,IAAIpB,QAAJ,CAAa,CACvB,EAAEyJ,OAAO,EAAT,EADuB,EAEvB,EAAEC,UAAU,EAAZ,EAFuB,EAGvB,EAAEC,QAAQ,CAAC,MAAD,CAAV,EAHuB,CAAb,CAAZ;AAKA,MAAIC,SAAS,SAATA,MAAS,CAAUzD,GAAV,EAAeL,IAAf,EAAqBmC,MAArB,EAA6B4B,OAA7B,EAAsCxB,MAAtC,EAA8CyB,MAA9C,EAAsD;AACjE,QAAIC,YAAY,SAAZA,SAAY,GAAY;AAC1B,aAAOD,OAAOhO,IAAP,CAAYsN,QAAQC,OAApB,EAA6BD,QAAQE,IAArC,CAAP;AACD,KAFD;AAGA,QAAIU,UAAU,SAAVA,OAAU,GAAY;AACxB,UAAIxB,OAAOH,QAAX;AACA,UAAIG,IAAJ,EAAU;AACR,eAAOoB,OAAOzD,GAAP,EAAYqC,IAAZ,EAAkB7K,OAAOrC,IAAP,EAAlB,EAAiCuO,OAAjC,EAA0CxB,MAA1C,EAAkD1K,OAAOP,IAAP,CAAY0I,IAAZ,CAAlD,CAAP;AACD,OAFD,MAEO;AACL,eAAOiE,WAAP;AACD;AACF,KAPD;AAQA,QAAId,WAAW9C,GAAX,EAAgBL,IAAhB,CAAJ,EAA2B;AACzB,aAAOiE,WAAP;AACD,KAFD,MAEO,IAAI,CAAClE,OAAOC,IAAP,CAAL,EAAmB;AACxB,aAAOkE,SAAP;AACD,KAFM,MAEA;AACL,UAAIxC,OAAO1B,KAAKgD,WAAhB;AACA,aAAOe,QAAQL,KAAR,EAAe1D,IAAf,EAAqB0B,IAArB,EAA2BS,MAA3B,EAAmCnM,IAAnC,CAAwCsN,QAAQC,OAAhD,EAAyD,YAAY;AAC1E,eAAOW,SAAP;AACD,OAFM,EAEJZ,QAAQG,OAFJ,CAAP;AAGD;AACF,GAtBD;AAuBA,MAAIU,aAAa,SAAbA,UAAa,CAAU9D,GAAV,EAAeL,IAAf,EAAqBmC,MAArB,EAA6B4B,OAA7B,EAAsCzB,QAAtC,EAAgD;AAC/D,QAAIC,SAAS,IAAIzC,QAAJ,CAAaE,IAAb,EAAmBsC,QAAnB,CAAb;AACA,WAAOwB,OAAOzD,GAAP,EAAYL,IAAZ,EAAkBnI,OAAOP,IAAP,CAAY6K,MAAZ,CAAlB,EAAuC4B,OAAvC,EAAgDxB,OAAOI,IAAvD,EAA6D9K,OAAOrC,IAAP,EAA7D,CAAP;AACD,GAHD;;AAKA,MAAI4O,eAAe,SAAfA,YAAe,CAAUC,IAAV,EAAgBrE,IAAhB,EAAsBmC,MAAtB,EAA8B;AAC/C,QAAIpC,OAAOC,IAAP,MAAiBmC,SAAS,CAAT,IAAcA,SAASnC,KAAKmB,IAAL,CAAUlN,MAAlD,CAAJ,EAA+D;AAC7D,aAAO,EAAP;AACD;AACD,QAAIC,IAAI,CAACiO,MAAD,CAAR;AACA,QAAImC,UAAUtE,IAAd;AACA,WAAOsE,YAAYD,IAAZ,IAAoBC,QAAQ7D,UAAnC,EAA+C;AAC7C,UAAID,SAAS8D,QAAQ7D,UAArB;AACA,WAAK,IAAI3M,IAAI,CAAb,EAAgBA,IAAI0M,OAAO+D,UAAP,CAAkBtQ,MAAtC,EAA8CH,GAA9C,EAAmD;AACjD,YAAI0M,OAAO+D,UAAP,CAAkBzQ,CAAlB,MAAyBwQ,OAA7B,EAAsC;AACpCpQ,YAAEkF,IAAF,CAAOtF,CAAP;AACA;AACD;AACF;AACDwQ,gBAAU9D,MAAV;AACD;AACD,WAAO8D,YAAYD,IAAZ,GAAmBnQ,EAAEsQ,OAAF,EAAnB,GAAiC,EAAxC;AACD,GAjBD;AAkBA,MAAIC,oBAAoB,SAApBA,iBAAoB,CAAUJ,IAAV,EAAgBhC,SAAhB,EAA2BqC,WAA3B,EAAwCC,OAAxC,EAAiDC,SAAjD,EAA4D;AAClF,QAAIzH,QAAQiH,aAAaC,IAAb,EAAmBhC,SAAnB,EAA8BqC,WAA9B,CAAZ;AACA,QAAI/G,MAAMyG,aAAaC,IAAb,EAAmBM,OAAnB,EAA4BC,SAA5B,CAAV;AACA,WAAO;AACLzH,aAAOA,KADF;AAELQ,WAAKA;AAFA,KAAP;AAID,GAPD;AAQA,MAAIkH,cAAc,SAAdA,WAAc,CAAUR,IAAV,EAAgBS,IAAhB,EAAsB;AACtC,QAAIC,WAAWD,KAAKpM,KAAL,EAAf;AACA,QAAIyJ,SAAS4C,SAASC,GAAT,EAAb;AACA,WAAOzL,MAAMwL,QAAN,EAAgB,UAAUE,OAAV,EAAmBC,KAAnB,EAA0B;AAC/C,aAAOD,QAAQpO,IAAR,CAAa,UAAUmJ,IAAV,EAAgB;AAClC,eAAOnI,OAAOD,IAAP,CAAYoI,KAAKuE,UAAL,CAAgBW,KAAhB,CAAZ,CAAP;AACD,OAFM,CAAP;AAGD,KAJM,EAIJrN,OAAOP,IAAP,CAAY+M,IAAZ,CAJI,EAIexN,IAJf,CAIoB,UAAUmJ,IAAV,EAAgB;AACzC,UAAID,OAAOC,IAAP,KAAgBmC,UAAU,CAA1B,IAA+BA,UAAUnC,KAAKmB,IAAL,CAAUlN,MAAvD,EAA+D;AAC7D,eAAO4D,OAAOP,IAAP,CAAY;AACjB0I,gBAAMA,IADW;AAEjBmC,kBAAQA;AAFS,SAAZ,CAAP;AAID,OALD,MAKO;AACL,eAAOtK,OAAOP,IAAP,CAAY;AACjB0I,gBAAMA,IADW;AAEjBmC,kBAAQA;AAFS,SAAZ,CAAP;AAID;AACF,KAhBM,CAAP;AAiBD,GApBD;AAqBA,MAAIgD,mBAAmB,SAAnBA,gBAAmB,CAAUd,IAAV,EAAgBe,KAAhB,EAAuB;AAC5C,WAAOP,YAAYR,IAAZ,EAAkBe,MAAMjI,KAAxB,EAA+BtG,IAA/B,CAAoC,UAAUwO,EAAV,EAAc;AACvD,UAAIhD,YAAYgD,GAAGrF,IAAnB;AAAA,UAAyB0E,cAAcW,GAAGlD,MAA1C;AACA,aAAO0C,YAAYR,IAAZ,EAAkBe,MAAMzH,GAAxB,EAA6BhH,GAA7B,CAAiC,UAAU0O,EAAV,EAAc;AACpD,YAAIV,UAAUU,GAAGrF,IAAjB;AAAA,YAAuB4E,YAAYS,GAAGlD,MAAtC;AACA,YAAIvB,MAAMhO,WAAW0S,QAAX,CAAoBC,WAApB,EAAV;AACA3E,YAAI4E,QAAJ,CAAanD,SAAb,EAAwBqC,WAAxB;AACA9D,YAAI6E,MAAJ,CAAWd,OAAX,EAAoBC,SAApB;AACA,eAAOhE,GAAP;AACD,OANM,CAAP;AAOD,KATM,CAAP;AAUD,GAXD;AAYA,MAAI8E,6BAA6B,SAA7BA,0BAA6B,CAAUrB,IAAV,EAAgBe,KAAhB,EAAuB;AACtD,WAAOX,kBAAkBJ,IAAlB,EAAwBe,MAAMrE,cAA9B,EAA8CqE,MAAMV,WAApD,EAAiEU,MAAMnE,YAAvE,EAAqFmE,MAAMR,SAA3F,CAAP;AACD,GAFD;;AAIA,MAAIe,eAAe,SAAfA,YAAe,CAAUtF,GAAV,EAAeb,KAAf,EAAsBzC,OAAtB,EAA+B;AAChD,QAAI6I,gBAAgBxD,WAAW5C,KAAX,EAAkBA,KAAlB,EAAyBkD,IAAzB,EAApB;AACAkD,kBAAchP,IAAd,CAAmB,UAAUoJ,IAAV,EAAgB;AACjCkD,gBAAUlD,IAAV,EAAgBjD,QAAQI,KAAR,CAAclJ,MAA9B,EAAsCuL,KAAtC,EAA6C5I,IAA7C,CAAkD,UAAU+G,GAAV,EAAe;AAC/D,YAAIiD,MAAMP,IAAIwF,SAAJ,EAAV;AACAjF,YAAI4E,QAAJ,CAAaxF,IAAb,EAAmB,CAAnB;AACAY,YAAI6E,MAAJ,CAAW9H,IAAIuE,OAAf,EAAwBvE,IAAIwE,MAA5B;AACAxB,kBAAUN,GAAV,EAAeO,GAAf,EAAoB,UAAUkF,CAAV,EAAa;AAC/B,iBAAOA,MAAMtG,KAAb;AACD,SAFD;AAGD,OAPD;AAQD,KATD;AAUD,GAZD;AAaA,MAAIuG,eAAe,SAAfA,YAAe,CAAUxG,MAAV,EAAkB5E,KAAlB,EAAyB;AAC1C,QAAI0F,MAAMd,OAAOc,GAAjB;AACA,QAAItD,UAAUpC,MAAMoC,OAApB;AACA,QAAI6D,MAAMuE,iBAAiB9E,IAAI2F,OAAJ,EAAjB,EAAgCrL,MAAMyK,KAAtC,EAA6C/O,QAA7C,CAAsD,8BAAtD,CAAV;AACAuL,mBAAerC,MAAf,EAAuBqB,GAAvB,EAA4BhK,IAA5B,CAAiC,UAAU4I,KAAV,EAAiB;AAChD,UAAIzC,QAAQ3E,IAAR,KAAiB,cAArB,EAAqC;AACnC,YAAIgJ,kBAAkBrE,QAAQS,MAA1B,EAAkC+B,OAAO8B,SAAzC,CAAJ,EAAyD;AACvD9B,iBAAO0G,WAAP,CAAmBC,QAAnB,CAA4B,YAAY;AACtCP,yBAAapG,OAAOc,GAApB,EAAyBb,KAAzB,EAAgCzC,OAAhC;AACAwC,mBAAO8B,SAAP,CAAiB/M,KAAjB,CAAuByI,QAAQS,MAA/B;AACD,WAHD;AAID;AACF,OAPD,MAOO,IAAIT,QAAQ3E,IAAR,KAAiB,eAArB,EAAsC;AAC3CmH,eAAO0G,WAAP,CAAmBC,QAAnB,CAA4B,YAAY;AACtCP,uBAAapG,OAAOc,GAApB,EAAyBb,KAAzB,EAAgCzC,OAAhC;AACAwC,iBAAO4G,WAAP,CAAmBpJ,QAAQW,GAA3B,EAAgC,KAAhC,EAAuCX,QAAQhK,KAA/C;AACD,SAHD;AAID;AACF,KAdD;AAeA,WAAO,IAAP;AACD,GApBD;AAqBA,MAAIqT,eAAe,SAAfA,YAAe,CAAU7G,MAAV,EAAkBrC,QAAlB,EAA4B;AAC7C,QAAImD,MAAMd,OAAOc,GAAjB;AACA,QAAIO,MAAMrB,OAAO8G,SAAP,CAAiBC,MAAjB,EAAV;AACA,WAAO1E,eAAerC,MAAf,EAAuBqB,GAAvB,EAA4B5J,MAA5B,CAAmC,UAAUwI,KAAV,EAAiB;AACzD,UAAI+G,kBAAkBjH,mBAAmBC,MAAnB,CAAtB;AACA,UAAIiH,yBAAyBD,oBAAoB,EAApB,IAA0BlG,IAAIpK,EAAJ,CAAOuJ,KAAP,EAAc,MAAd,CAA1B,IAAmDa,IAAIpK,EAAJ,CAAOuJ,KAAP,EAAc+G,eAAd,CAAhF;AACA,aAAO/G,UAAU,IAAV,IAAkBgH,sBAAzB;AACD,KAJM,EAIJ3P,IAJI,CAIC,UAAU2I,KAAV,EAAiB;AACvB,UAAIiH,YAAYjH,MAAMwD,WAAtB;AACA,UAAI0D,iBAAiBjF,YAAYvE,QAAZ,EAAsBuJ,SAAtB,CAArB;AACA,aAAOC,eAAe/P,GAAf,CAAmB,UAAUoG,OAAV,EAAmB;AAC3C,YAAI8C,SAAS8G,IAAT,CAAcF,SAAd,EAAyBxS,MAAzB,KAAoC8I,QAAQI,KAAR,CAAclJ,MAAtD,EAA8D;AAC5D,iBAAO,EAAP;AACD;AACD,eAAO,CAAC;AACJ8I,mBAASA,OADL;AAEJqI,iBAAOX,kBAAkBpE,IAAI2F,OAAJ,EAAlB,EAAiCxG,KAAjC,EAAwC,CAAxC,EAA2CA,KAA3C,EAAkD,CAAlD;AAFH,SAAD,CAAP;AAID,OARM,CAAP;AASD,KAhBM,EAgBJrJ,KAhBI,CAgBE,EAhBF,CAAP;AAiBD,GApBD;AAqBA,MAAIyQ,eAAe,SAAfA,YAAe,CAAUrH,MAAV,EAAkBsH,OAAlB,EAA2B;AAC5C,QAAIA,QAAQ5S,MAAR,KAAmB,CAAvB,EAA0B;AACxB;AACD;AACD,QAAI6S,WAAWvH,OAAO8G,SAAP,CAAiBU,WAAjB,EAAf;AACAnQ,SAAKiQ,OAAL,EAAc,UAAUlM,KAAV,EAAiB;AAC7B,aAAOoL,aAAaxG,MAAb,EAAqB5E,KAArB,CAAP;AACD,KAFD;AAGA4E,WAAO8G,SAAP,CAAiBW,cAAjB,CAAgCF,QAAhC;AACD,GATD;;AAWA,MAAIG,SAAS,CAAb;AACA,MAAIC,aAAa,SAAbA,UAAa,CAAUC,MAAV,EAAkB;AACjC,QAAIC,OAAO,IAAIC,IAAJ,EAAX;AACA,QAAIC,OAAOF,KAAKG,OAAL,EAAX;AACA,QAAIC,SAASC,KAAKC,KAAL,CAAWD,KAAKD,MAAL,KAAgB,UAA3B,CAAb;AACAP;AACA,WAAOE,SAAS,GAAT,GAAeK,MAAf,GAAwBP,MAAxB,GAAiC/O,OAAOoP,IAAP,CAAxC;AACD,GAND;;AAQA,MAAIK,aAAa,SAAbA,UAAa,CAAUC,GAAV,EAAeC,MAAf,EAAuB1K,KAAvB,EAA8B;AAC7C,QAAI0K,WAAW,EAAf,EAAmB;AACjB,aAAO,IAAP;AACD;AACD,QAAID,IAAI3T,MAAJ,GAAa4T,OAAO5T,MAAxB,EAAgC;AAC9B,aAAO,KAAP;AACD;AACD,QAAIiB,IAAI0S,IAAIC,MAAJ,CAAW1K,KAAX,EAAkBA,QAAQ0K,OAAO5T,MAAjC,CAAR;AACA,WAAOiB,MAAM2S,MAAb;AACD,GATD;AAUA,MAAIC,WAAW,SAAXA,QAAW,CAAUF,GAAV,EAAeG,MAAf,EAAuB;AACpC,WAAOJ,WAAWC,GAAX,EAAgBG,MAAhB,EAAwBH,IAAI3T,MAAJ,GAAa8T,OAAO9T,MAA5C,CAAP;AACD,GAFD;;AAIA,MAAI+T,YAAY,SAAZA,SAAY,CAAU3H,GAAV,EAAevK,EAAf,EAAmB;AACjC,WAAOuK,IAAI4H,MAAJ,CAAW,MAAX,EAAmB;AACxB,uBAAiB,UADO;AAExB,YAAMnS;AAFkB,KAAnB,CAAP;AAID,GALD;AAMA,MAAIoS,kBAAkB,SAAlBA,eAAkB,CAAU7H,GAAV,EAAe8H,MAAf,EAAuB;AAC3C,QAAIvH,MAAMP,IAAIwF,SAAJ,EAAV;AACAjF,QAAIwH,aAAJ,CAAkBD,OAAOhL,KAAzB;AACAyD,QAAIyH,YAAJ,CAAiBF,OAAOxK,GAAxB;AACA,WAAOiD,GAAP;AACD,GALD;AAMA,MAAI0H,eAAe,SAAfA,YAAe,CAAUjI,GAAV,EAAekI,YAAf,EAA6BC,SAA7B,EAAwC;AACzD,QAAI5H,MAAMuE,iBAAiB9E,IAAI2F,OAAJ,EAAjB,EAAgCwC,SAAhC,EAA2CnS,QAA3C,CAAoD,8BAApD,CAAV;AACA,QAAIgM,YAAYzB,IAAIG,cAApB;AACA,QAAI4D,UAAU/D,IAAIK,YAAlB;AACA,QAAIwH,UAAU7H,IAAIgE,SAAJ,KAAkB,CAAlB,GAAsBD,OAAtB,GAAgCA,QAAQ+D,SAAR,CAAkB9H,IAAIgE,SAAtB,CAA9C;AACA,QAAI+D,YAAY/H,IAAI8D,WAAJ,KAAoB,CAApB,GAAwBrC,SAAxB,GAAoCA,UAAUqG,SAAV,CAAoB9H,IAAI8D,WAAxB,CAApD;AACA,WAAO;AACLyC,cAAQoB,YADH;AAEL5K,WAAK8K,QAAQhI,UAAR,CAAmBmI,YAAnB,CAAgCZ,UAAU3H,GAAV,EAAekI,eAAe,MAA9B,CAAhC,EAAuEE,OAAvE,CAFA;AAGLtL,aAAOwL,UAAUlI,UAAV,CAAqBmI,YAArB,CAAkCZ,UAAU3H,GAAV,EAAekI,eAAe,QAA9B,CAAlC,EAA2EI,SAA3E;AAHF,KAAP;AAKD,GAXD;AAYA,MAAIE,eAAe,SAAfA,YAAe,CAAUxI,GAAV,EAAe8H,MAAf,EAAuB7H,MAAvB,EAA+B;AAChDF,oBAAgBC,GAAhB,EAAqBA,IAAIrN,GAAJ,CAAQmV,OAAOhB,MAAP,GAAgB,MAAxB,CAArB,EAAsD7G,MAAtD;AACAF,oBAAgBC,GAAhB,EAAqBA,IAAIrN,GAAJ,CAAQmV,OAAOhB,MAAP,GAAgB,QAAxB,CAArB,EAAwD7G,MAAxD;AACD,GAHD;;AAKA,MAAIwI,qBAAqB,SAArBA,kBAAqB,CAAUzI,GAAV,EAAeb,KAAf,EAAsBuJ,OAAtB,EAA+B;AACtD,WAAO,UAAUrF,KAAV,EAAiBxB,OAAjB,EAA0BR,IAA1B,EAAgCsH,SAAhC,EAA2C;AAChD,UAAI9G,YAAY1C,KAAhB,EAAuB;AACrB,eAAOkE,MAAMC,KAAN,EAAP;AACD;AACD,UAAIsF,aAAavH,KAAKwH,SAAL,CAAe,CAAf,EAAkBF,UAAU7S,KAAV,CAAgBuL,KAAKzN,MAArB,CAAlB,CAAjB;AACA,UAAIkV,gBAAgBF,WAAWtH,WAAX,CAAuBoH,QAAQK,MAAR,CAAeL,QAAQ9U,MAAR,GAAiB,CAAhC,CAAvB,CAApB;AACA,UAAIoV,aAAaJ,WAAWtH,WAAX,CAAuBoH,OAAvB,CAAjB;AACA,UAAIM,eAAe,CAAC,CAApB,EAAuB;AACrB,YAAIzI,MAAMP,IAAIwF,SAAJ,EAAV;AACAjF,YAAI4E,QAAJ,CAAatD,OAAb,EAAsBmH,UAAtB;AACAzI,YAAI6E,MAAJ,CAAWvD,OAAX,EAAoBmH,aAAaN,QAAQ9U,MAAzC;AACA,eAAOyP,MAAMG,MAAN,CAAajD,GAAb,CAAP;AACD,OALD,MAKO,IAAIuI,kBAAkB,CAAC,CAAvB,EAA0B;AAC/B,eAAOpG,SAASb,OAAT,EAAkBiH,gBAAgB,CAAhB,GAAoBJ,QAAQ9U,MAA9C,EAAsDuL,KAAtD,EAA6DxJ,IAA7D,CAAkE,YAAY;AACnF,iBAAO0N,MAAME,QAAN,EAAP;AACD,SAFM,EAEJ,UAAU0F,IAAV,EAAgB;AACjB,cAAI1I,MAAMP,IAAIwF,SAAJ,EAAV;AACAjF,cAAI4E,QAAJ,CAAa8D,KAAKpH,OAAlB,EAA2BoH,KAAKnH,MAAhC;AACAvB,cAAI6E,MAAJ,CAAWvD,OAAX,EAAoBiH,gBAAgB,CAApC;AACA,cAAIvI,IAAIxJ,QAAJ,OAAmB2R,OAAvB,EAAgC;AAC9B,mBAAOrF,MAAMG,MAAN,CAAajD,GAAb,CAAP;AACD,WAFD,MAEO;AACL,mBAAO8C,MAAME,QAAN,EAAP;AACD;AACF,SAXM,CAAP;AAYD,OAbM,MAaA;AACL,eAAOF,MAAME,QAAN,EAAP;AACD;AACF,KA5BD;AA6BD,GA9BD;AA+BA,MAAI2F,mBAAmB,SAAnBA,gBAAmB,CAAUlJ,GAAV,EAAetD,OAAf,EAAwBiD,IAAxB,EAA8BmC,MAA9B,EAAsC3C,KAAtC,EAA6CgK,UAA7C,EAAyD;AAC9E,QAAIA,eAAe,KAAK,CAAxB,EAA2B;AACzBA,mBAAa,KAAb;AACD;AACD,QAAIzM,QAAQI,KAAR,CAAclJ,MAAd,KAAyB,CAAzB,IAA8B,CAACuV,UAAnC,EAA+C;AAC7C,UAAI5I,MAAMP,IAAIwF,SAAJ,EAAV;AACAjF,UAAI4E,QAAJ,CAAaxF,IAAb,EAAmBmC,MAAnB;AACAvB,UAAI6E,MAAJ,CAAWzF,IAAX,EAAiBmC,MAAjB;AACA,aAAOtK,OAAOP,IAAP,CAAYsJ,GAAZ,CAAP;AACD;AACD,WAAOiC,WAAW7C,IAAX,EAAiBmC,MAAjB,EAAyB3C,KAAzB,EAAgC3I,IAAhC,CAAqC,UAAUyS,IAAV,EAAgB;AAC1D,UAAIhG,UAAUa,WAAW9D,GAAX,EAAgBiJ,KAAKpH,OAArB,EAA8BoH,KAAKnH,MAAnC,EAA2C2G,mBAAmBzI,GAAnB,EAAwBb,KAAxB,EAA+BzC,QAAQI,KAAvC,CAA3C,EAA0FqC,KAA1F,CAAd;AACA,UAAIrC,QAAQmG,QAAQtN,IAAR,CAAa6B,OAAOrC,IAApB,EAA0BqC,OAAOrC,IAAjC,EAAuCqC,OAAOP,IAA9C,CAAZ;AACA,aAAO6F,MAAMtG,IAAN,CAAW,UAAU4S,UAAV,EAAsB;AACtC,YAAID,UAAJ,EAAgB;AACd,cAAIC,WAAWxI,YAAX,KAA4BqI,KAAKpH,OAAjC,IAA4CuH,WAAW7E,SAAX,KAAyB0E,KAAKnH,MAA9E,EAAsF;AACpF,mBAAOtK,OAAOrC,IAAP,EAAP;AACD,WAFD,MAEO,IAAI8T,KAAKnH,MAAL,KAAgB,CAAhB,IAAqBsH,WAAWxI,YAAX,CAAwB+B,WAAxB,CAAoC/O,MAApC,KAA+CwV,WAAW7E,SAAnF,EAA8F;AACnG,mBAAO/M,OAAOrC,IAAP,EAAP;AACD;AACF;AACD,eAAOqC,OAAOP,IAAP,CAAYmS,UAAZ,CAAP;AACD,OATM,CAAP;AAUD,KAbM,CAAP;AAcD,GAxBD;AAyBA,MAAIC,gBAAgB,SAAhBA,aAAgB,CAAUnK,MAAV,EAAkBC,KAAlB,EAAyBmK,OAAzB,EAAkC;AACpD,QAAItJ,MAAMd,OAAOc,GAAjB;AACA,QAAIgE,OAAOhE,IAAI2F,OAAJ,EAAX;AACA,QAAIjJ,UAAU4M,QAAQ5M,OAAtB;AACA,QAAI4H,UAAUgF,QAAQC,QAAR,CAAiB1H,OAA/B;AACA,QAAI0C,YAAY+E,QAAQC,QAAR,CAAiBzH,MAAjC;AACA,WAAOY,SAAS4B,OAAT,EAAkBC,YAAY+E,QAAQ5M,OAAR,CAAgBY,GAAhB,CAAoB1J,MAAlD,EAA0DuL,KAA1D,EAAiE3I,IAAjE,CAAsE,UAAUyS,IAAV,EAAgB;AAC3F,UAAIO,aAAapF,kBAAkBJ,IAAlB,EAAwBiF,KAAKpH,OAA7B,EAAsCoH,KAAKnH,MAA3C,EAAmDwC,OAAnD,EAA4DC,SAA5D,CAAjB;AACA,UAAIpD,qBAAqBzE,OAArB,CAAJ,EAAmC;AACjC,eAAOlF,OAAOP,IAAP,CAAY;AACjBuP,mBAAS,CAAC;AACN9J,qBAASA,OADH;AAEN+M,sBAAUD,UAFJ;AAGNE,oBAAQF;AAHF,WAAD,CADQ;AAMjBD,oBAAUN;AANO,SAAZ,CAAP;AAQD,OATD,MASO;AACL,YAAIU,aAAaC,gBAAgB1K,MAAhB,EAAwBoK,QAAQO,iBAAhC,EAAmDZ,KAAKpH,OAAxD,EAAiEoH,KAAKnH,MAAtE,EAA8E3C,KAA9E,CAAjB;AACA,YAAI2K,YAAYH,WAAW7T,KAAX,CAAiB;AAC/B0Q,mBAAS,EADsB;AAE/B+C,oBAAUN;AAFqB,SAAjB,CAAhB;AAIA,YAAIc,MAAMD,UAAUP,QAApB;AACA,YAAIzM,QAAQoM,iBAAiBlJ,GAAjB,EAAsBtD,OAAtB,EAA+BqN,IAAIlI,OAAnC,EAA4CkI,IAAIjI,MAAhD,EAAwD3C,KAAxD,EAA+DwK,WAAWpU,MAAX,EAA/D,CAAZ;AACA,eAAOuH,MAAMxG,GAAN,CAAU,UAAUmT,QAAV,EAAoB;AACnC,cAAIO,eAAe3E,2BAA2BrB,IAA3B,EAAiCyF,QAAjC,CAAnB;AACA,iBAAO;AACLjD,qBAASsD,UAAUtD,OAAV,CAAkByD,MAAlB,CAAyB,CAAC;AAC/BvN,uBAASA,OADsB;AAE/B+M,wBAAUO,YAFqB;AAG/BN,sBAAQF;AAHuB,aAAD,CAAzB,CADJ;AAMLD,sBAAU3H,MAAM6H,SAAS/I,cAAf,EAA+B+I,SAASpF,WAAxC;AANL,WAAP;AAQD,SAVM,CAAP;AAWD;AACF,KA/BM,CAAP;AAgCD,GAtCD;AAuCA,MAAIuF,kBAAkB,SAAlBA,eAAkB,CAAU1K,MAAV,EAAkBrC,QAAlB,EAA4B8C,IAA5B,EAAkCmC,MAAlC,EAA0C3C,KAA1C,EAAiD;AACrE,QAAIa,MAAMd,OAAOc,GAAjB;AACA,WAAOwC,WAAW7C,IAAX,EAAiBmC,MAAjB,EAAyB9B,IAAI2F,OAAJ,EAAzB,EAAwCnP,IAAxC,CAA6C,UAAU0T,OAAV,EAAmB;AACrE,UAAI3J,MAAMP,IAAIwF,SAAJ,EAAV;AACAjF,UAAI4E,QAAJ,CAAahG,KAAb,EAAoB,CAApB;AACAoB,UAAI6E,MAAJ,CAAWzF,IAAX,EAAiBmC,MAAjB;AACA,UAAIT,OAAOd,IAAIxJ,QAAJ,EAAX;AACA,WAAK,IAAItD,IAAI,CAAb,EAAgBA,IAAIoJ,SAASjJ,MAA7B,EAAqCH,GAArC,EAA0C;AACxC,YAAIiJ,UAAUG,SAASpJ,CAAT,CAAd;AACA,YAAI,CAACgU,SAASpG,IAAT,EAAe3E,QAAQY,GAAvB,CAAL,EAAkC;AAChC;AACD;AACD,YAAI6M,yBAAyBtN,SAASxE,KAAT,EAA7B;AACA8R,+BAAuBC,MAAvB,CAA8B3W,CAA9B,EAAiC,CAAjC;AACA,YAAIkI,SAAS0N,cAAcnK,MAAd,EAAsBC,KAAtB,EAA6B;AACxCzC,mBAASA,OAD+B;AAExCmN,6BAAmBM,sBAFqB;AAGxCZ,oBAAUW;AAH8B,SAA7B,CAAb;AAKA,YAAIvO,OAAO9F,MAAP,EAAJ,EAAqB;AACnB,iBAAO8F,MAAP;AACD;AACF;AACD,aAAOnE,OAAOrC,IAAP,EAAP;AACD,KAtBM,CAAP;AAuBD,GAzBD;AA0BA,MAAIkV,iBAAiB,SAAjBA,cAAiB,CAAUnL,MAAV,EAAkBxC,OAAlB,EAA2B4N,YAA3B,EAAyC;AAC5DpL,WAAO8G,SAAP,CAAiBuE,MAAjB,CAAwBD,YAAxB;AACA,QAAI5N,QAAQ3E,IAAR,KAAiB,eAArB,EAAsC;AACpCxB,WAAKmG,QAAQS,MAAb,EAAqB,UAAUA,MAAV,EAAkB;AACrC+B,eAAO8B,SAAP,CAAiB/M,KAAjB,CAAuBkJ,MAAvB;AACD,OAFD;AAGD,KAJD,MAIO;AACL+B,aAAO4G,WAAP,CAAmBpJ,QAAQW,GAA3B,EAAgC,KAAhC,EAAuCX,QAAQhK,KAA/C;AACD;AACF,GATD;AAUA,MAAI8X,0BAA0B,SAA1BA,uBAA0B,CAAUtL,MAAV,EAAkBxC,OAAlB,EAA2BoL,MAA3B,EAAmC7H,MAAnC,EAA2C;AACvE,QAAIwK,cAAc5C,gBAAgB3I,OAAOc,GAAvB,EAA4B8H,MAA5B,CAAlB;AACAxH,cAAUpB,OAAOc,GAAjB,EAAsByK,WAAtB,EAAmCxK,MAAnC;AACAoK,mBAAenL,MAAf,EAAuBxC,OAAvB,EAAgC+N,WAAhC;AACD,GAJD;AAKA,MAAIC,0BAA0B,SAA1BA,uBAA0B,CAAUxL,MAAV,EAAkBxC,OAAlB,EAA2BiO,WAA3B,EAAwCC,SAAxC,EAAmD3K,MAAnD,EAA2D;AACvF,QAAID,MAAMd,OAAOc,GAAjB;AACA,QAAI6K,iBAAiBhD,gBAAgB7H,GAAhB,EAAqB4K,SAArB,CAArB;AACA,QAAIE,mBAAmBjD,gBAAgB7H,GAAhB,EAAqB2K,WAArB,CAAvB;AACArK,cAAUN,GAAV,EAAe8K,gBAAf,EAAiC7K,MAAjC;AACAK,cAAUN,GAAV,EAAe6K,cAAf,EAA+B5K,MAA/B;AACA,QAAI8K,gBAAgB;AAClBjE,cAAQ6D,YAAY7D,MADF;AAElBhK,aAAO6N,YAAYrN,GAFD;AAGlBA,WAAKsN,UAAU9N;AAHG,KAApB;AAKA,QAAIwN,eAAezC,gBAAgB7H,GAAhB,EAAqB+K,aAArB,CAAnB;AACAV,mBAAenL,MAAf,EAAuBxC,OAAvB,EAAgC4N,YAAhC;AACD,GAbD;AAcA,MAAIU,aAAa,SAAbA,UAAa,CAAUhL,GAAV,EAAewG,OAAf,EAAwB;AACvC,QAAI0B,eAAerB,WAAW,iBAAX,CAAnB;AACA,QAAIoE,kBAAkBjS,MAAMwN,OAAN,EAAe,UAAUvN,GAAV,EAAeqB,KAAf,EAAsB;AACzD,UAAIsQ,YAAY3C,aAAajI,GAAb,EAAkBkI,gBAAgB,SAASjP,IAAIrF,MAA7B,CAAlB,EAAwD0G,MAAMoP,MAA9D,CAAhB;AACA,aAAOzQ,IAAIgR,MAAJ,CAAW,CAAC7W,QAASA,QAAS,EAAT,EAAakH,KAAb,CAAT,EAA8B,EAAEsQ,WAAWA,SAAb,EAA9B,CAAD,CAAX,CAAP;AACD,KAHqB,EAGnB,EAHmB,CAAtB;AAIA,WAAO5R,MAAMiS,eAAN,EAAuB,UAAUhS,GAAV,EAAeqB,KAAf,EAAsB;AAClD,UAAI4Q,MAAMD,gBAAgBrX,MAAhB,GAAyBqF,IAAIrF,MAA7B,GAAsC,CAAhD;AACA,UAAI+W,cAAcxJ,qBAAqB7G,MAAMoC,OAA3B,IAAsCpC,MAAMsQ,SAA5C,GAAwD3C,aAAajI,GAAb,EAAkBkI,gBAAgB,WAAWgD,GAA3B,CAAlB,EAAmD5Q,MAAMmP,QAAzD,CAA1E;AACA,aAAOxQ,IAAIgR,MAAJ,CAAW,CAAC7W,QAASA,QAAS,EAAT,EAAakH,KAAb,CAAT,EAA8B,EAAEqQ,aAAaA,WAAf,EAA9B,CAAD,CAAX,CAAP;AACD,KAJM,EAIJ,EAJI,CAAP;AAKD,GAXD;AAYA,MAAIQ,iBAAiB,SAAjBA,cAAiB,CAAUjM,MAAV,EAAkBrC,QAAlB,EAA4BuO,KAA5B,EAAmC;AACtD,QAAI7K,MAAMrB,OAAO8G,SAAP,CAAiBC,MAAjB,EAAV;AACA,QAAI1F,IAAI8K,SAAJ,KAAkB,KAAtB,EAA6B;AAC3B,aAAO,EAAP;AACD;AACD,WAAO9J,eAAerC,MAAf,EAAuBqB,GAAvB,EAA4B/J,IAA5B,CAAiC,UAAU2I,KAAV,EAAiB;AACvD,UAAI2C,SAASvB,IAAI8D,WAAJ,IAAmB+G,QAAQ,CAAR,GAAY,CAA/B,CAAb;AACA,aAAOxB,gBAAgB1K,MAAhB,EAAwBrC,QAAxB,EAAkC0D,IAAIG,cAAtC,EAAsDoB,MAAtD,EAA8D3C,KAA9D,CAAP;AACD,KAHM,EAGJxJ,IAHI,CAGC,YAAY;AAClB,aAAO,EAAP;AACD,KALM,EAKJ,UAAUgG,MAAV,EAAkB;AACnB,aAAOA,OAAO6K,OAAd;AACD,KAPM,CAAP;AAQD,GAbD;AAcA,MAAI8E,iBAAiB,SAAjBA,cAAiB,CAAUpM,MAAV,EAAkBsH,OAAlB,EAA2B;AAC9C,QAAIA,QAAQ5S,MAAR,KAAmB,CAAvB,EAA0B;AACxB;AACD;AACD,QAAIoM,MAAMd,OAAOc,GAAjB;AACA,QAAIyG,WAAWvH,OAAO8G,SAAP,CAAiBU,WAAjB,EAAf;AACA,QAAI6E,qBAAqBP,WAAWhL,GAAX,EAAgBwG,OAAhB,CAAzB;AACAjQ,SAAKgV,kBAAL,EAAyB,UAAUjR,KAAV,EAAiB;AACxC,UAAI6E,QAAQa,IAAIyB,SAAJ,CAAcnH,MAAMqQ,WAAN,CAAkB7N,KAAhC,EAAuCkD,IAAI0B,OAA3C,CAAZ;AACA,UAAIzB,SAAS,SAATA,MAAS,CAAUN,IAAV,EAAgB;AAC3B,eAAOA,SAASR,KAAhB;AACD,OAFD;AAGA,UAAIgC,qBAAqB7G,MAAMoC,OAA3B,CAAJ,EAAyC;AACvC8N,gCAAwBtL,MAAxB,EAAgC5E,MAAMoC,OAAtC,EAA+CpC,MAAMsQ,SAArD,EAAgE3K,MAAhE;AACD,OAFD,MAEO;AACLyK,gCAAwBxL,MAAxB,EAAgC5E,MAAMoC,OAAtC,EAA+CpC,MAAMqQ,WAArD,EAAkErQ,MAAMsQ,SAAxE,EAAmF3K,MAAnF;AACD;AACDuI,mBAAaxI,GAAb,EAAkB1F,MAAMsQ,SAAxB,EAAmC3K,MAAnC;AACAuI,mBAAaxI,GAAb,EAAkB1F,MAAMqQ,WAAxB,EAAqC1K,MAArC;AACD,KAZD;AAaAf,WAAO8G,SAAP,CAAiBW,cAAjB,CAAgCF,QAAhC;AACD,GArBD;;AAuBA,MAAI+E,cAAc,SAAdA,WAAc,CAAUtM,MAAV,EAAkBuM,UAAlB,EAA8B;AAC9C,QAAI,CAACvM,OAAO8G,SAAP,CAAiB0F,WAAjB,EAAL,EAAqC;AACnC,aAAO,KAAP;AACD;AACD,QAAIC,gBAAgBR,eAAejM,MAAf,EAAuBuM,WAAW3N,cAAlC,EAAkD,KAAlD,CAApB;AACA,QAAI8N,eAAe7F,aAAa7G,MAAb,EAAqBuM,WAAW1N,aAAhC,CAAnB;AACA,QAAI6N,aAAahY,MAAb,GAAsB,CAAtB,IAA2B+X,cAAc/X,MAAd,GAAuB,CAAtD,EAAyD;AACvDsL,aAAO0G,WAAP,CAAmBiG,GAAnB;AACA3M,aAAO0G,WAAP,CAAmBkG,KAAnB,CAAyB,YAAY;AACnC5M,eAAO4G,WAAP,CAAmB,kBAAnB;AACD,OAFD,EAEG,YAAY;AACb5G,eAAO6M,aAAP,CAAqBxM,WAArB;AACA+L,uBAAepM,MAAf,EAAuByM,aAAvB;AACApF,qBAAarH,MAAb,EAAqB0M,YAArB;AACA,YAAI7G,QAAQ7F,OAAO8G,SAAP,CAAiBC,MAAjB,EAAZ;AACA,YAAIgD,OAAOzG,WAAWuC,MAAMrE,cAAjB,EAAiCqE,MAAMV,WAAvC,EAAoDnF,OAAOc,GAAP,CAAW2F,OAAX,EAApD,CAAX;AACAzG,eAAO4G,WAAP,CAAmB,kBAAnB;AACAmD,aAAK1S,IAAL,CAAU,UAAU/C,CAAV,EAAa;AACrB,cAAIA,EAAEqO,OAAF,CAAUf,IAAV,CAAeiI,MAAf,CAAsBvV,EAAEsO,MAAF,GAAW,CAAjC,MAAwCvC,WAA5C,EAAyD;AACvD/L,cAAEqO,OAAF,CAAUmK,UAAV,CAAqBxY,EAAEsO,MAAF,GAAW,CAAhC,EAAmC,CAAnC;AACA/B,4BAAgBb,OAAOc,GAAvB,EAA4BxM,EAAEqO,OAAF,CAAUzB,UAAtC,EAAkD,UAAUqF,CAAV,EAAa;AAC7D,qBAAOA,MAAMvG,OAAOc,GAAP,CAAW2F,OAAX,EAAb;AACD,aAFD;AAGD;AACF,SAPD;AAQD,OAjBD;AAkBA,aAAO,IAAP;AACD;AACD,WAAO,KAAP;AACD,GA7BD;AA8BA,MAAIsG,kBAAkB,SAAlBA,eAAkB,CAAU/M,MAAV,EAAkBuM,UAAlB,EAA8B;AAClD,QAAIE,gBAAgBR,eAAejM,MAAf,EAAuBuM,WAAW3N,cAAlC,EAAkD,IAAlD,CAApB;AACA,QAAI6N,cAAc/X,MAAd,GAAuB,CAA3B,EAA8B;AAC5BsL,aAAO0G,WAAP,CAAmBC,QAAnB,CAA4B,YAAY;AACtCyF,uBAAepM,MAAf,EAAuByM,aAAvB;AACD,OAFD;AAGD;AACF,GAPD;AAQA,MAAIO,gBAAgB,SAAhBA,aAAgB,CAAUC,KAAV,EAAiBC,KAAjB,EAAwBC,SAAxB,EAAmC;AACrD,SAAK,IAAI5Y,IAAI,CAAb,EAAgBA,IAAI0Y,MAAMvY,MAA1B,EAAkCH,GAAlC,EAAuC;AACrC,UAAI4Y,UAAUF,MAAM1Y,CAAN,CAAV,EAAoB2Y,KAApB,CAAJ,EAAgC;AAC9B,eAAO,IAAP;AACD;AACF;AACF,GAND;AAOA,MAAIE,eAAe,SAAfA,YAAe,CAAUH,KAAV,EAAiBC,KAAjB,EAAwB;AACzC,WAAOF,cAAcC,KAAd,EAAqBC,KAArB,EAA4B,UAAUG,IAAV,EAAgBH,KAAhB,EAAuB;AACxD,aAAOG,SAASH,MAAMI,OAAf,IAA0BlN,SAASmN,eAAT,CAAyBL,KAAzB,MAAoC,KAArE;AACD,KAFM,CAAP;AAGD,GAJD;AAKA,MAAIM,gBAAgB,SAAhBA,aAAgB,CAAUC,KAAV,EAAiBP,KAAjB,EAAwB;AAC1C,WAAOF,cAAcS,KAAd,EAAqBP,KAArB,EAA4B,UAAUQ,GAAV,EAAeR,KAAf,EAAsB;AACvD,aAAOQ,IAAIC,UAAJ,CAAe,CAAf,MAAsBT,MAAMU,QAAnC;AACD,KAFM,CAAP;AAGD,GAJD;AAKA,MAAIC,aAAa;AACfvB,iBAAaA,WADE;AAEfS,qBAAiBA,eAFF;AAGfS,mBAAeA,aAHA;AAIfJ,kBAAcA;AAJC,GAAjB;;AAOA,MAAIU,QAAQ,SAARA,KAAQ,CAAU9N,MAAV,EAAkBjB,aAAlB,EAAiC;AAC3C,QAAIgP,YAAY,CACd,GADc,EAEd,GAFc,EAGd,GAHc,EAId,GAJc,EAKd,GALc,EAMd,GANc,CAAhB;AAQA,QAAIC,WAAW,CAAC,EAAD,CAAf;AACAhO,WAAOiO,EAAP,CAAU,SAAV,EAAqB,UAAU1H,CAAV,EAAa;AAChC,UAAIA,EAAE+G,OAAF,KAAc,EAAd,IAAoB,CAAClN,SAASmN,eAAT,CAAyBhH,CAAzB,CAAzB,EAAsD;AACpD,YAAIsH,WAAWvB,WAAX,CAAuBtM,MAAvB,EAA+BjB,cAActL,GAAd,EAA/B,CAAJ,EAAyD;AACvD8S,YAAE2H,cAAF;AACD;AACF;AACF,KAND,EAMG,IANH;AAOAlO,WAAOiO,EAAP,CAAU,OAAV,EAAmB,UAAU1H,CAAV,EAAa;AAC9B,UAAIsH,WAAWT,YAAX,CAAwBY,QAAxB,EAAkCzH,CAAlC,CAAJ,EAA0C;AACxCsH,mBAAWd,eAAX,CAA2B/M,MAA3B,EAAmCjB,cAActL,GAAd,EAAnC;AACD;AACF,KAJD;AAKAuM,WAAOiO,EAAP,CAAU,UAAV,EAAsB,UAAU1H,CAAV,EAAa;AACjC,UAAIsH,WAAWL,aAAX,CAAyBO,SAAzB,EAAoCxH,CAApC,CAAJ,EAA4C;AAC1CpG,iBAASgO,gBAAT,CAA0BnO,MAA1B,EAAkC,YAAY;AAC5C6N,qBAAWd,eAAX,CAA2B/M,MAA3B,EAAmCjB,cAActL,GAAd,EAAnC;AACD,SAFD;AAGD;AACF,KAND;AAOD,GA7BD;AA8BA,MAAI2a,WAAW,EAAEN,OAAOA,KAAT,EAAf;;AAEA,WAASO,MAAT,GAAmB;AACjBxa,WAAO8Y,GAAP,CAAW,aAAX,EAA0B,UAAU3M,MAAV,EAAkB;AAC1C,UAAIjB,gBAAgBzL,KAAKuM,cAAcG,OAAOsO,QAArB,CAAL,CAApB;AACAF,eAASN,KAAT,CAAe9N,MAAf,EAAuBjB,aAAvB;AACA,aAAOO,IAAI7L,GAAJ,CAAQsL,aAAR,CAAP;AACD,KAJD;AAKD;;AAEDsP;AAEH,CAh6CA,EAg6CC7O,MAh6CD,CAAD","file":"plugin.js","sourcesContent":["/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.1.0 (2019-10-17)\n */\n(function (domGlobals) {\n    'use strict';\n\n    var Cell = function (initial) {\n      var value = initial;\n      var get = function () {\n        return value;\n      };\n      var set = function (v) {\n        value = v;\n      };\n      var clone = function () {\n        return Cell(get());\n      };\n      return {\n        get: get,\n        set: set,\n        clone: clone\n      };\n    };\n\n    var global = tinymce.util.Tools.resolve('tinymce.PluginManager');\n\n    var __assign = function () {\n      __assign = Object.assign || function __assign(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s)\n            if (Object.prototype.hasOwnProperty.call(s, p))\n              t[p] = s[p];\n        }\n        return t;\n      };\n      return __assign.apply(this, arguments);\n    };\n    function __spreadArrays() {\n      for (var s = 0, i = 0, il = arguments.length; i < il; i++)\n        s += arguments[i].length;\n      for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n          r[k] = a[j];\n      return r;\n    }\n\n    var noop = function () {\n    };\n    var constant = function (value) {\n      return function () {\n        return value;\n      };\n    };\n    var identity = function (x) {\n      return x;\n    };\n    var die = function (msg) {\n      return function () {\n        throw new Error(msg);\n      };\n    };\n    var never = constant(false);\n    var always = constant(true);\n\n    var none = function () {\n      return NONE;\n    };\n    var NONE = function () {\n      var eq = function (o) {\n        return o.isNone();\n      };\n      var call = function (thunk) {\n        return thunk();\n      };\n      var id = function (n) {\n        return n;\n      };\n      var me = {\n        fold: function (n, s) {\n          return n();\n        },\n        is: never,\n        isSome: never,\n        isNone: always,\n        getOr: id,\n        getOrThunk: call,\n        getOrDie: function (msg) {\n          throw new Error(msg || 'error: getOrDie called on none.');\n        },\n        getOrNull: constant(null),\n        getOrUndefined: constant(undefined),\n        or: id,\n        orThunk: call,\n        map: none,\n        each: noop,\n        bind: none,\n        exists: never,\n        forall: always,\n        filter: none,\n        equals: eq,\n        equals_: eq,\n        toArray: function () {\n          return [];\n        },\n        toString: constant('none()')\n      };\n      if (Object.freeze) {\n        Object.freeze(me);\n      }\n      return me;\n    }();\n    var some = function (a) {\n      var constant_a = constant(a);\n      var self = function () {\n        return me;\n      };\n      var bind = function (f) {\n        return f(a);\n      };\n      var me = {\n        fold: function (n, s) {\n          return s(a);\n        },\n        is: function (v) {\n          return a === v;\n        },\n        isSome: always,\n        isNone: never,\n        getOr: constant_a,\n        getOrThunk: constant_a,\n        getOrDie: constant_a,\n        getOrNull: constant_a,\n        getOrUndefined: constant_a,\n        or: self,\n        orThunk: self,\n        map: function (f) {\n          return some(f(a));\n        },\n        each: function (f) {\n          f(a);\n        },\n        bind: bind,\n        exists: bind,\n        forall: bind,\n        filter: function (f) {\n          return f(a) ? me : NONE;\n        },\n        toArray: function () {\n          return [a];\n        },\n        toString: function () {\n          return 'some(' + a + ')';\n        },\n        equals: function (o) {\n          return o.is(a);\n        },\n        equals_: function (o, elementEq) {\n          return o.fold(never, function (b) {\n            return elementEq(a, b);\n          });\n        }\n      };\n      return me;\n    };\n    var from = function (value) {\n      return value === null || value === undefined ? NONE : some(value);\n    };\n    var Option = {\n      some: some,\n      none: none,\n      from: from\n    };\n\n    var typeOf = function (x) {\n      if (x === null) {\n        return 'null';\n      }\n      var t = typeof x;\n      if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {\n        return 'array';\n      }\n      if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {\n        return 'string';\n      }\n      return t;\n    };\n    var isType = function (type) {\n      return function (value) {\n        return typeOf(value) === type;\n      };\n    };\n    var isString = isType('string');\n    var isObject = isType('object');\n    var isArray = isType('array');\n    var isFunction = isType('function');\n\n    var nativeSlice = Array.prototype.slice;\n    var nativeIndexOf = Array.prototype.indexOf;\n    var rawIndexOf = function (ts, t) {\n      return nativeIndexOf.call(ts, t);\n    };\n    var contains = function (xs, x) {\n      return rawIndexOf(xs, x) > -1;\n    };\n    var map = function (xs, f) {\n      var len = xs.length;\n      var r = new Array(len);\n      for (var i = 0; i < len; i++) {\n        var x = xs[i];\n        r[i] = f(x, i);\n      }\n      return r;\n    };\n    var each = function (xs, f) {\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        f(x, i);\n      }\n    };\n    var eachr = function (xs, f) {\n      for (var i = xs.length - 1; i >= 0; i--) {\n        var x = xs[i];\n        f(x, i);\n      }\n    };\n    var filter = function (xs, pred) {\n      var r = [];\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        if (pred(x, i)) {\n          r.push(x);\n        }\n      }\n      return r;\n    };\n    var foldr = function (xs, f, acc) {\n      eachr(xs, function (x) {\n        acc = f(acc, x);\n      });\n      return acc;\n    };\n    var foldl = function (xs, f, acc) {\n      each(xs, function (x) {\n        acc = f(acc, x);\n      });\n      return acc;\n    };\n    var find = function (xs, pred) {\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        if (pred(x, i)) {\n          return Option.some(x);\n        }\n      }\n      return Option.none();\n    };\n    var forall = function (xs, pred) {\n      for (var i = 0, len = xs.length; i < len; ++i) {\n        var x = xs[i];\n        if (pred(x, i) !== true) {\n          return false;\n        }\n      }\n      return true;\n    };\n    var sort = function (xs, comparator) {\n      var copy = nativeSlice.call(xs, 0);\n      copy.sort(comparator);\n      return copy;\n    };\n    var head = function (xs) {\n      return xs.length === 0 ? Option.none() : Option.some(xs[0]);\n    };\n    var from$1 = isFunction(Array.from) ? Array.from : function (x) {\n      return nativeSlice.call(x);\n    };\n\n    var keys = Object.keys;\n    var hasOwnProperty = Object.hasOwnProperty;\n    var get = function (obj, key) {\n      return has(obj, key) ? Option.from(obj[key]) : Option.none();\n    };\n    var has = function (obj, key) {\n      return hasOwnProperty.call(obj, key);\n    };\n\n    var generate = function (cases) {\n      if (!isArray(cases)) {\n        throw new Error('cases must be an array');\n      }\n      if (cases.length === 0) {\n        throw new Error('there must be at least one case');\n      }\n      var constructors = [];\n      var adt = {};\n      each(cases, function (acase, count) {\n        var keys$1 = keys(acase);\n        if (keys$1.length !== 1) {\n          throw new Error('one and only one name per case');\n        }\n        var key = keys$1[0];\n        var value = acase[key];\n        if (adt[key] !== undefined) {\n          throw new Error('duplicate key detected:' + key);\n        } else if (key === 'cata') {\n          throw new Error('cannot have a case named cata (sorry)');\n        } else if (!isArray(value)) {\n          throw new Error('case arguments must be an array');\n        }\n        constructors.push(key);\n        adt[key] = function () {\n          var argLength = arguments.length;\n          if (argLength !== value.length) {\n            throw new Error('Wrong number of arguments to case ' + key + '. Expected ' + value.length + ' (' + value + '), got ' + argLength);\n          }\n          var args = new Array(argLength);\n          for (var i = 0; i < args.length; i++) {\n            args[i] = arguments[i];\n          }\n          var match = function (branches) {\n            var branchKeys = keys(branches);\n            if (constructors.length !== branchKeys.length) {\n              throw new Error('Wrong number of arguments to match. Expected: ' + constructors.join(',') + '\\nActual: ' + branchKeys.join(','));\n            }\n            var allReqd = forall(constructors, function (reqKey) {\n              return contains(branchKeys, reqKey);\n            });\n            if (!allReqd) {\n              throw new Error('Not all branches were specified when using match. Specified: ' + branchKeys.join(', ') + '\\nRequired: ' + constructors.join(', '));\n            }\n            return branches[key].apply(null, args);\n          };\n          return {\n            fold: function () {\n              if (arguments.length !== cases.length) {\n                throw new Error('Wrong number of arguments to fold. Expected ' + cases.length + ', got ' + arguments.length);\n              }\n              var target = arguments[count];\n              return target.apply(null, args);\n            },\n            match: match,\n            log: function (label) {\n              domGlobals.console.log(label, {\n                constructors: constructors,\n                constructor: key,\n                params: args\n              });\n            }\n          };\n        };\n      });\n      return adt;\n    };\n    var Adt = { generate: generate };\n\n    var comparison = Adt.generate([\n      {\n        bothErrors: [\n          'error1',\n          'error2'\n        ]\n      },\n      {\n        firstError: [\n          'error1',\n          'value2'\n        ]\n      },\n      {\n        secondError: [\n          'value1',\n          'error2'\n        ]\n      },\n      {\n        bothValues: [\n          'value1',\n          'value2'\n        ]\n      }\n    ]);\n    var partition = function (results) {\n      var errors = [];\n      var values = [];\n      each(results, function (result) {\n        result.fold(function (err) {\n          errors.push(err);\n        }, function (value) {\n          values.push(value);\n        });\n      });\n      return {\n        errors: errors,\n        values: values\n      };\n    };\n\n    var value = function (o) {\n      var is = function (v) {\n        return o === v;\n      };\n      var or = function (opt) {\n        return value(o);\n      };\n      var orThunk = function (f) {\n        return value(o);\n      };\n      var map = function (f) {\n        return value(f(o));\n      };\n      var mapError = function (f) {\n        return value(o);\n      };\n      var each = function (f) {\n        f(o);\n      };\n      var bind = function (f) {\n        return f(o);\n      };\n      var fold = function (_, onValue) {\n        return onValue(o);\n      };\n      var exists = function (f) {\n        return f(o);\n      };\n      var forall = function (f) {\n        return f(o);\n      };\n      var toOption = function () {\n        return Option.some(o);\n      };\n      return {\n        is: is,\n        isValue: always,\n        isError: never,\n        getOr: constant(o),\n        getOrThunk: constant(o),\n        getOrDie: constant(o),\n        or: or,\n        orThunk: orThunk,\n        fold: fold,\n        map: map,\n        mapError: mapError,\n        each: each,\n        bind: bind,\n        exists: exists,\n        forall: forall,\n        toOption: toOption\n      };\n    };\n    var error = function (message) {\n      var getOrThunk = function (f) {\n        return f();\n      };\n      var getOrDie = function () {\n        return die(String(message))();\n      };\n      var or = function (opt) {\n        return opt;\n      };\n      var orThunk = function (f) {\n        return f();\n      };\n      var map = function (f) {\n        return error(message);\n      };\n      var mapError = function (f) {\n        return error(f(message));\n      };\n      var bind = function (f) {\n        return error(message);\n      };\n      var fold = function (onError, _) {\n        return onError(message);\n      };\n      return {\n        is: never,\n        isValue: never,\n        isError: always,\n        getOr: identity,\n        getOrThunk: getOrThunk,\n        getOrDie: getOrDie,\n        or: or,\n        orThunk: orThunk,\n        fold: fold,\n        map: map,\n        mapError: mapError,\n        each: noop,\n        bind: bind,\n        exists: never,\n        forall: always,\n        toOption: Option.none\n      };\n    };\n    var fromOption = function (opt, err) {\n      return opt.fold(function () {\n        return error(err);\n      }, value);\n    };\n    var Result = {\n      value: value,\n      error: error,\n      fromOption: fromOption\n    };\n\n    var isInlinePattern = function (pattern) {\n      return pattern.type === 'inline-command' || pattern.type === 'inline-format';\n    };\n    var isBlockPattern = function (pattern) {\n      return pattern.type === 'block-command' || pattern.type === 'block-format';\n    };\n    var sortPatterns = function (patterns) {\n      return sort(patterns, function (a, b) {\n        if (a.start.length === b.start.length) {\n          return 0;\n        }\n        return a.start.length > b.start.length ? -1 : 1;\n      });\n    };\n    var normalizePattern = function (pattern) {\n      var err = function (message) {\n        return Result.error({\n          message: message,\n          pattern: pattern\n        });\n      };\n      var formatOrCmd = function (name, onFormat, onCommand) {\n        if (pattern.format !== undefined) {\n          var formats = void 0;\n          if (isArray(pattern.format)) {\n            if (!forall(pattern.format, isString)) {\n              return err(name + ' pattern has non-string items in the `format` array');\n            }\n            formats = pattern.format;\n          } else if (isString(pattern.format)) {\n            formats = [pattern.format];\n          } else {\n            return err(name + ' pattern has non-string `format` parameter');\n          }\n          return Result.value(onFormat(formats));\n        } else if (pattern.cmd !== undefined) {\n          if (!isString(pattern.cmd)) {\n            return err(name + ' pattern has non-string `cmd` parameter');\n          }\n          return Result.value(onCommand(pattern.cmd, pattern.value));\n        } else {\n          return err(name + ' pattern is missing both `format` and `cmd` parameters');\n        }\n      };\n      if (!isObject(pattern)) {\n        return err('Raw pattern is not an object');\n      }\n      if (!isString(pattern.start)) {\n        return err('Raw pattern is missing `start` parameter');\n      }\n      if (pattern.end !== undefined) {\n        if (!isString(pattern.end)) {\n          return err('Inline pattern has non-string `end` parameter');\n        }\n        if (pattern.start.length === 0 && pattern.end.length === 0) {\n          return err('Inline pattern has empty `start` and `end` parameters');\n        }\n        var start_1 = pattern.start;\n        var end_1 = pattern.end;\n        if (end_1.length === 0) {\n          end_1 = start_1;\n          start_1 = '';\n        }\n        return formatOrCmd('Inline', function (format) {\n          return {\n            type: 'inline-format',\n            start: start_1,\n            end: end_1,\n            format: format\n          };\n        }, function (cmd, value) {\n          return {\n            type: 'inline-command',\n            start: start_1,\n            end: end_1,\n            cmd: cmd,\n            value: value\n          };\n        });\n      } else if (pattern.replacement !== undefined) {\n        if (!isString(pattern.replacement)) {\n          return err('Replacement pattern has non-string `replacement` parameter');\n        }\n        if (pattern.start.length === 0) {\n          return err('Replacement pattern has empty `start` parameter');\n        }\n        return Result.value({\n          type: 'inline-command',\n          start: '',\n          end: pattern.start,\n          cmd: 'mceInsertContent',\n          value: pattern.replacement\n        });\n      } else {\n        if (pattern.start.length === 0) {\n          return err('Block pattern has empty `start` parameter');\n        }\n        return formatOrCmd('Block', function (formats) {\n          return {\n            type: 'block-format',\n            start: pattern.start,\n            format: formats[0]\n          };\n        }, function (command, commandValue) {\n          return {\n            type: 'block-command',\n            start: pattern.start,\n            cmd: command,\n            value: commandValue\n          };\n        });\n      }\n    };\n    var denormalizePattern = function (pattern) {\n      if (pattern.type === 'block-command') {\n        return {\n          start: pattern.start,\n          cmd: pattern.cmd,\n          value: pattern.value\n        };\n      } else if (pattern.type === 'block-format') {\n        return {\n          start: pattern.start,\n          format: pattern.format\n        };\n      } else if (pattern.type === 'inline-command') {\n        if (pattern.cmd === 'mceInsertContent' && pattern.start === '') {\n          return {\n            start: pattern.end,\n            replacement: pattern.value\n          };\n        } else {\n          return {\n            start: pattern.start,\n            end: pattern.end,\n            cmd: pattern.cmd,\n            value: pattern.value\n          };\n        }\n      } else if (pattern.type === 'inline-format') {\n        return {\n          start: pattern.start,\n          end: pattern.end,\n          format: pattern.format.length === 1 ? pattern.format[0] : pattern.format\n        };\n      }\n    };\n    var createPatternSet = function (patterns) {\n      return {\n        inlinePatterns: filter(patterns, isInlinePattern),\n        blockPatterns: sortPatterns(filter(patterns, isBlockPattern))\n      };\n    };\n\n    var get$1 = function (patternsState) {\n      var setPatterns = function (newPatterns) {\n        var normalized = partition(map(newPatterns, normalizePattern));\n        if (normalized.errors.length > 0) {\n          var firstError = normalized.errors[0];\n          throw new Error(firstError.message + ':\\n' + JSON.stringify(firstError.pattern, null, 2));\n        }\n        patternsState.set(createPatternSet(normalized.values));\n      };\n      var getPatterns = function () {\n        return __spreadArrays(map(patternsState.get().inlinePatterns, denormalizePattern), map(patternsState.get().blockPatterns, denormalizePattern));\n      };\n      return {\n        setPatterns: setPatterns,\n        getPatterns: getPatterns\n      };\n    };\n    var Api = { get: get$1 };\n\n    var Global = typeof domGlobals.window !== 'undefined' ? domGlobals.window : Function('return this;')();\n\n    var error$1 = function () {\n      var args = [];\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n      var console = Global.console;\n      if (console) {\n        if (console.error) {\n          console.error.apply(console, args);\n        } else {\n          console.log.apply(console, args);\n        }\n      }\n    };\n    var defaultPatterns = [\n      {\n        start: '*',\n        end: '*',\n        format: 'italic'\n      },\n      {\n        start: '**',\n        end: '**',\n        format: 'bold'\n      },\n      {\n        start: '#',\n        format: 'h1'\n      },\n      {\n        start: '##',\n        format: 'h2'\n      },\n      {\n        start: '###',\n        format: 'h3'\n      },\n      {\n        start: '####',\n        format: 'h4'\n      },\n      {\n        start: '#####',\n        format: 'h5'\n      },\n      {\n        start: '######',\n        format: 'h6'\n      },\n      {\n        start: '1. ',\n        cmd: 'InsertOrderedList'\n      },\n      {\n        start: '* ',\n        cmd: 'InsertUnorderedList'\n      },\n      {\n        start: '- ',\n        cmd: 'InsertUnorderedList'\n      }\n    ];\n    var getPatternSet = function (editorSettings) {\n      var patterns = get(editorSettings, 'textpattern_patterns').getOr(defaultPatterns);\n      if (!isArray(patterns)) {\n        error$1('The setting textpattern_patterns should be an array');\n        return {\n          inlinePatterns: [],\n          blockPatterns: []\n        };\n      }\n      var normalized = partition(map(patterns, normalizePattern));\n      each(normalized.errors, function (err) {\n        return error$1(err.message, err.pattern);\n      });\n      return createPatternSet(normalized.values);\n    };\n    var getForcedRootBlock = function (editor) {\n      var block = editor.getParam('forced_root_block', 'p');\n      if (block === false) {\n        return '';\n      } else if (block === true) {\n        return 'p';\n      } else {\n        return block;\n      }\n    };\n\n    var global$1 = tinymce.util.Tools.resolve('tinymce.util.Delay');\n\n    var global$2 = tinymce.util.Tools.resolve('tinymce.util.VK');\n\n    var zeroWidth = function () {\n      return '\\uFEFF';\n    };\n\n    var global$3 = tinymce.util.Tools.resolve('tinymce.util.Tools');\n\n    var global$4 = tinymce.util.Tools.resolve('tinymce.dom.TreeWalker');\n\n    var isText = function (node) {\n      return node.nodeType === domGlobals.Node.TEXT_NODE;\n    };\n    var cleanEmptyNodes = function (dom, node, isRoot) {\n      if (node && dom.isEmpty(node) && !isRoot(node)) {\n        var parent = node.parentNode;\n        dom.remove(node);\n        cleanEmptyNodes(dom, parent, isRoot);\n      }\n    };\n    var deleteRng = function (dom, rng, isRoot, clean) {\n      if (clean === void 0) {\n        clean = true;\n      }\n      var startParent = rng.startContainer.parentNode;\n      var endParent = rng.endContainer.parentNode;\n      rng.deleteContents();\n      if (clean && !isRoot(rng.startContainer)) {\n        if (isText(rng.startContainer) && rng.startContainer.data.length === 0) {\n          dom.remove(rng.startContainer);\n        }\n        if (isText(rng.endContainer) && rng.endContainer.data.length === 0) {\n          dom.remove(rng.endContainer);\n        }\n        cleanEmptyNodes(dom, startParent, isRoot);\n        if (startParent !== endParent) {\n          cleanEmptyNodes(dom, endParent, isRoot);\n        }\n      }\n    };\n    var isBlockFormatName = function (name, formatter) {\n      var formatSet = formatter.get(name);\n      return isArray(formatSet) && head(formatSet).exists(function (format) {\n        return has(format, 'block');\n      });\n    };\n    var isInlinePattern$1 = function (pattern) {\n      return has(pattern, 'end');\n    };\n    var isReplacementPattern = function (pattern) {\n      return pattern.start.length === 0;\n    };\n    var findPattern = function (patterns, text) {\n      return find(patterns, function (pattern) {\n        if (text.indexOf(pattern.start) !== 0) {\n          return false;\n        }\n        if (isInlinePattern$1(pattern) && pattern.end && text.lastIndexOf(pattern.end) !== text.length - pattern.end.length) {\n          return false;\n        }\n        return true;\n      });\n    };\n    var getParentBlock = function (editor, rng) {\n      var parentBlockOpt = Option.from(editor.dom.getParent(rng.startContainer, editor.dom.isBlock));\n      if (getForcedRootBlock(editor) === '') {\n        return parentBlockOpt.orThunk(function () {\n          return Option.some(editor.getBody());\n        });\n      } else {\n        return parentBlockOpt;\n      }\n    };\n\n    var point = function (element, offset) {\n      return {\n        element: element,\n        offset: offset\n      };\n    };\n\n    var TextWalker = function (startNode, rootNode) {\n      var walker = new global$4(startNode, rootNode);\n      var walk = function (direction) {\n        var next = walker[direction]();\n        while (next && next.nodeType !== domGlobals.Node.TEXT_NODE) {\n          next = walker[direction]();\n        }\n        return next && next.nodeType === domGlobals.Node.TEXT_NODE ? Option.some(next) : Option.none();\n      };\n      return {\n        next: function () {\n          return walk('next');\n        },\n        prev: function () {\n          return walk('prev');\n        },\n        prev2: function () {\n          return walk('prev2');\n        }\n      };\n    };\n\n    var textBefore = function (node, offset, rootNode) {\n      if (isText(node) && offset >= 0) {\n        return Option.some(point(node, offset));\n      } else {\n        var textWalker = TextWalker(node, rootNode);\n        return textWalker.prev().map(function (prev) {\n          return point(prev, prev.data.length);\n        });\n      }\n    };\n    var scanLeft = function (node, offset, rootNode) {\n      if (!isText(node)) {\n        return Option.none();\n      }\n      var text = node.textContent;\n      if (offset >= 0 && offset <= text.length) {\n        return Option.some(point(node, offset));\n      } else {\n        var textWalker = TextWalker(node, rootNode);\n        return textWalker.prev().bind(function (prev) {\n          var prevText = prev.textContent;\n          return scanLeft(prev, offset + prevText.length, rootNode);\n        });\n      }\n    };\n    var scanRight = function (node, offset, rootNode) {\n      if (!isText(node)) {\n        return Option.none();\n      }\n      var text = node.textContent;\n      if (offset <= text.length) {\n        return Option.some(point(node, offset));\n      } else {\n        var textWalker = TextWalker(node, rootNode);\n        return textWalker.next().bind(function (next) {\n          return scanRight(next, offset - text.length, rootNode);\n        });\n      }\n    };\n    var isBoundary = function (dom, node) {\n      return dom.isBlock(node) || contains([\n        'BR',\n        'IMG',\n        'HR',\n        'INPUT'\n      ], node.nodeName) || dom.getContentEditable(node) === 'false';\n    };\n    var outcome = Adt.generate([\n      { aborted: [] },\n      { edge: ['element'] },\n      { success: ['info'] }\n    ]);\n    var phase = Adt.generate([\n      { abort: [] },\n      { kontinue: [] },\n      { finish: ['info'] }\n    ]);\n    var repeat = function (dom, node, offset, process, walker, recent) {\n      var terminate = function () {\n        return recent.fold(outcome.aborted, outcome.edge);\n      };\n      var recurse = function () {\n        var next = walker();\n        if (next) {\n          return repeat(dom, next, Option.none(), process, walker, Option.some(node));\n        } else {\n          return terminate();\n        }\n      };\n      if (isBoundary(dom, node)) {\n        return terminate();\n      } else if (!isText(node)) {\n        return recurse();\n      } else {\n        var text = node.textContent;\n        return process(phase, node, text, offset).fold(outcome.aborted, function () {\n          return recurse();\n        }, outcome.success);\n      }\n    };\n    var repeatLeft = function (dom, node, offset, process, rootNode) {\n      var walker = new global$4(node, rootNode);\n      return repeat(dom, node, Option.some(offset), process, walker.prev, Option.none());\n    };\n\n    var generatePath = function (root, node, offset) {\n      if (isText(node) && (offset < 0 || offset > node.data.length)) {\n        return [];\n      }\n      var p = [offset];\n      var current = node;\n      while (current !== root && current.parentNode) {\n        var parent = current.parentNode;\n        for (var i = 0; i < parent.childNodes.length; i++) {\n          if (parent.childNodes[i] === current) {\n            p.push(i);\n            break;\n          }\n        }\n        current = parent;\n      }\n      return current === root ? p.reverse() : [];\n    };\n    var generatePathRange = function (root, startNode, startOffset, endNode, endOffset) {\n      var start = generatePath(root, startNode, startOffset);\n      var end = generatePath(root, endNode, endOffset);\n      return {\n        start: start,\n        end: end\n      };\n    };\n    var resolvePath = function (root, path) {\n      var nodePath = path.slice();\n      var offset = nodePath.pop();\n      return foldl(nodePath, function (optNode, index) {\n        return optNode.bind(function (node) {\n          return Option.from(node.childNodes[index]);\n        });\n      }, Option.some(root)).bind(function (node) {\n        if (isText(node) && offset >= 0 && offset <= node.data.length) {\n          return Option.some({\n            node: node,\n            offset: offset\n          });\n        } else {\n          return Option.some({\n            node: node,\n            offset: offset\n          });\n        }\n      });\n    };\n    var resolvePathRange = function (root, range) {\n      return resolvePath(root, range.start).bind(function (_a) {\n        var startNode = _a.node, startOffset = _a.offset;\n        return resolvePath(root, range.end).map(function (_a) {\n          var endNode = _a.node, endOffset = _a.offset;\n          var rng = domGlobals.document.createRange();\n          rng.setStart(startNode, startOffset);\n          rng.setEnd(endNode, endOffset);\n          return rng;\n        });\n      });\n    };\n    var generatePathRangeFromRange = function (root, range) {\n      return generatePathRange(root, range.startContainer, range.startOffset, range.endContainer, range.endOffset);\n    };\n\n    var stripPattern = function (dom, block, pattern) {\n      var firstTextNode = TextWalker(block, block).next();\n      firstTextNode.each(function (node) {\n        scanRight(node, pattern.start.length, block).each(function (end) {\n          var rng = dom.createRng();\n          rng.setStart(node, 0);\n          rng.setEnd(end.element, end.offset);\n          deleteRng(dom, rng, function (e) {\n            return e === block;\n          });\n        });\n      });\n    };\n    var applyPattern = function (editor, match) {\n      var dom = editor.dom;\n      var pattern = match.pattern;\n      var rng = resolvePathRange(dom.getRoot(), match.range).getOrDie('Unable to resolve path range');\n      getParentBlock(editor, rng).each(function (block) {\n        if (pattern.type === 'block-format') {\n          if (isBlockFormatName(pattern.format, editor.formatter)) {\n            editor.undoManager.transact(function () {\n              stripPattern(editor.dom, block, pattern);\n              editor.formatter.apply(pattern.format);\n            });\n          }\n        } else if (pattern.type === 'block-command') {\n          editor.undoManager.transact(function () {\n            stripPattern(editor.dom, block, pattern);\n            editor.execCommand(pattern.cmd, false, pattern.value);\n          });\n        }\n      });\n      return true;\n    };\n    var findPatterns = function (editor, patterns) {\n      var dom = editor.dom;\n      var rng = editor.selection.getRng();\n      return getParentBlock(editor, rng).filter(function (block) {\n        var forcedRootBlock = getForcedRootBlock(editor);\n        var matchesForcedRootBlock = forcedRootBlock === '' && dom.is(block, 'body') || dom.is(block, forcedRootBlock);\n        return block !== null && matchesForcedRootBlock;\n      }).bind(function (block) {\n        var blockText = block.textContent;\n        var matchedPattern = findPattern(patterns, blockText);\n        return matchedPattern.map(function (pattern) {\n          if (global$3.trim(blockText).length === pattern.start.length) {\n            return [];\n          }\n          return [{\n              pattern: pattern,\n              range: generatePathRange(dom.getRoot(), block, 0, block, 0)\n            }];\n        });\n      }).getOr([]);\n    };\n    var applyMatches = function (editor, matches) {\n      if (matches.length === 0) {\n        return;\n      }\n      var bookmark = editor.selection.getBookmark();\n      each(matches, function (match) {\n        return applyPattern(editor, match);\n      });\n      editor.selection.moveToBookmark(bookmark);\n    };\n\n    var unique = 0;\n    var generate$1 = function (prefix) {\n      var date = new Date();\n      var time = date.getTime();\n      var random = Math.floor(Math.random() * 1000000000);\n      unique++;\n      return prefix + '_' + random + unique + String(time);\n    };\n\n    var checkRange = function (str, substr, start) {\n      if (substr === '') {\n        return true;\n      }\n      if (str.length < substr.length) {\n        return false;\n      }\n      var x = str.substr(start, start + substr.length);\n      return x === substr;\n    };\n    var endsWith = function (str, suffix) {\n      return checkRange(str, suffix, str.length - suffix.length);\n    };\n\n    var newMarker = function (dom, id) {\n      return dom.create('span', {\n        'data-mce-type': 'bookmark',\n        'id': id\n      });\n    };\n    var rangeFromMarker = function (dom, marker) {\n      var rng = dom.createRng();\n      rng.setStartAfter(marker.start);\n      rng.setEndBefore(marker.end);\n      return rng;\n    };\n    var createMarker = function (dom, markerPrefix, pathRange) {\n      var rng = resolvePathRange(dom.getRoot(), pathRange).getOrDie('Unable to resolve path range');\n      var startNode = rng.startContainer;\n      var endNode = rng.endContainer;\n      var textEnd = rng.endOffset === 0 ? endNode : endNode.splitText(rng.endOffset);\n      var textStart = rng.startOffset === 0 ? startNode : startNode.splitText(rng.startOffset);\n      return {\n        prefix: markerPrefix,\n        end: textEnd.parentNode.insertBefore(newMarker(dom, markerPrefix + '-end'), textEnd),\n        start: textStart.parentNode.insertBefore(newMarker(dom, markerPrefix + '-start'), textStart)\n      };\n    };\n    var removeMarker = function (dom, marker, isRoot) {\n      cleanEmptyNodes(dom, dom.get(marker.prefix + '-end'), isRoot);\n      cleanEmptyNodes(dom, dom.get(marker.prefix + '-start'), isRoot);\n    };\n\n    var nodeMatchesPattern = function (dom, block, content) {\n      return function (phase, element, text, optOffset) {\n        if (element === block) {\n          return phase.abort();\n        }\n        var searchText = text.substring(0, optOffset.getOr(text.length));\n        var startEndIndex = searchText.lastIndexOf(content.charAt(content.length - 1));\n        var startIndex = searchText.lastIndexOf(content);\n        if (startIndex !== -1) {\n          var rng = dom.createRng();\n          rng.setStart(element, startIndex);\n          rng.setEnd(element, startIndex + content.length);\n          return phase.finish(rng);\n        } else if (startEndIndex !== -1) {\n          return scanLeft(element, startEndIndex + 1 - content.length, block).fold(function () {\n            return phase.kontinue();\n          }, function (spot) {\n            var rng = dom.createRng();\n            rng.setStart(spot.element, spot.offset);\n            rng.setEnd(element, startEndIndex + 1);\n            if (rng.toString() === content) {\n              return phase.finish(rng);\n            } else {\n              return phase.kontinue();\n            }\n          });\n        } else {\n          return phase.kontinue();\n        }\n      };\n    };\n    var findPatternStart = function (dom, pattern, node, offset, block, requireGap) {\n      if (requireGap === void 0) {\n        requireGap = false;\n      }\n      if (pattern.start.length === 0 && !requireGap) {\n        var rng = dom.createRng();\n        rng.setStart(node, offset);\n        rng.setEnd(node, offset);\n        return Option.some(rng);\n      }\n      return textBefore(node, offset, block).bind(function (spot) {\n        var outcome = repeatLeft(dom, spot.element, spot.offset, nodeMatchesPattern(dom, block, pattern.start), block);\n        var start = outcome.fold(Option.none, Option.none, Option.some);\n        return start.bind(function (startRange) {\n          if (requireGap) {\n            if (startRange.endContainer === spot.element && startRange.endOffset === spot.offset) {\n              return Option.none();\n            } else if (spot.offset === 0 && startRange.endContainer.textContent.length === startRange.endOffset) {\n              return Option.none();\n            }\n          }\n          return Option.some(startRange);\n        });\n      });\n    };\n    var findPattern$1 = function (editor, block, details) {\n      var dom = editor.dom;\n      var root = dom.getRoot();\n      var pattern = details.pattern;\n      var endNode = details.position.element;\n      var endOffset = details.position.offset;\n      return scanLeft(endNode, endOffset - details.pattern.end.length, block).bind(function (spot) {\n        var endPathRng = generatePathRange(root, spot.element, spot.offset, endNode, endOffset);\n        if (isReplacementPattern(pattern)) {\n          return Option.some({\n            matches: [{\n                pattern: pattern,\n                startRng: endPathRng,\n                endRng: endPathRng\n              }],\n            position: spot\n          });\n        } else {\n          var resultsOpt = findPatternsRec(editor, details.remainingPatterns, spot.element, spot.offset, block);\n          var results_1 = resultsOpt.getOr({\n            matches: [],\n            position: spot\n          });\n          var pos = results_1.position;\n          var start = findPatternStart(dom, pattern, pos.element, pos.offset, block, resultsOpt.isNone());\n          return start.map(function (startRng) {\n            var startPathRng = generatePathRangeFromRange(root, startRng);\n            return {\n              matches: results_1.matches.concat([{\n                  pattern: pattern,\n                  startRng: startPathRng,\n                  endRng: endPathRng\n                }]),\n              position: point(startRng.startContainer, startRng.startOffset)\n            };\n          });\n        }\n      });\n    };\n    var findPatternsRec = function (editor, patterns, node, offset, block) {\n      var dom = editor.dom;\n      return textBefore(node, offset, dom.getRoot()).bind(function (endSpot) {\n        var rng = dom.createRng();\n        rng.setStart(block, 0);\n        rng.setEnd(node, offset);\n        var text = rng.toString();\n        for (var i = 0; i < patterns.length; i++) {\n          var pattern = patterns[i];\n          if (!endsWith(text, pattern.end)) {\n            continue;\n          }\n          var patternsWithoutCurrent = patterns.slice();\n          patternsWithoutCurrent.splice(i, 1);\n          var result = findPattern$1(editor, block, {\n            pattern: pattern,\n            remainingPatterns: patternsWithoutCurrent,\n            position: endSpot\n          });\n          if (result.isSome()) {\n            return result;\n          }\n        }\n        return Option.none();\n      });\n    };\n    var applyPattern$1 = function (editor, pattern, patternRange) {\n      editor.selection.setRng(patternRange);\n      if (pattern.type === 'inline-format') {\n        each(pattern.format, function (format) {\n          editor.formatter.apply(format);\n        });\n      } else {\n        editor.execCommand(pattern.cmd, false, pattern.value);\n      }\n    };\n    var applyReplacementPattern = function (editor, pattern, marker, isRoot) {\n      var markerRange = rangeFromMarker(editor.dom, marker);\n      deleteRng(editor.dom, markerRange, isRoot);\n      applyPattern$1(editor, pattern, markerRange);\n    };\n    var applyPatternWithContent = function (editor, pattern, startMarker, endMarker, isRoot) {\n      var dom = editor.dom;\n      var markerEndRange = rangeFromMarker(dom, endMarker);\n      var markerStartRange = rangeFromMarker(dom, startMarker);\n      deleteRng(dom, markerStartRange, isRoot);\n      deleteRng(dom, markerEndRange, isRoot);\n      var patternMarker = {\n        prefix: startMarker.prefix,\n        start: startMarker.end,\n        end: endMarker.start\n      };\n      var patternRange = rangeFromMarker(dom, patternMarker);\n      applyPattern$1(editor, pattern, patternRange);\n    };\n    var addMarkers = function (dom, matches) {\n      var markerPrefix = generate$1('mce_textpattern');\n      var matchesWithEnds = foldr(matches, function (acc, match) {\n        var endMarker = createMarker(dom, markerPrefix + ('_end' + acc.length), match.endRng);\n        return acc.concat([__assign(__assign({}, match), { endMarker: endMarker })]);\n      }, []);\n      return foldr(matchesWithEnds, function (acc, match) {\n        var idx = matchesWithEnds.length - acc.length - 1;\n        var startMarker = isReplacementPattern(match.pattern) ? match.endMarker : createMarker(dom, markerPrefix + ('_start' + idx), match.startRng);\n        return acc.concat([__assign(__assign({}, match), { startMarker: startMarker })]);\n      }, []);\n    };\n    var findPatterns$1 = function (editor, patterns, space) {\n      var rng = editor.selection.getRng();\n      if (rng.collapsed === false) {\n        return [];\n      }\n      return getParentBlock(editor, rng).bind(function (block) {\n        var offset = rng.startOffset - (space ? 1 : 0);\n        return findPatternsRec(editor, patterns, rng.startContainer, offset, block);\n      }).fold(function () {\n        return [];\n      }, function (result) {\n        return result.matches;\n      });\n    };\n    var applyMatches$1 = function (editor, matches) {\n      if (matches.length === 0) {\n        return;\n      }\n      var dom = editor.dom;\n      var bookmark = editor.selection.getBookmark();\n      var matchesWithMarkers = addMarkers(dom, matches);\n      each(matchesWithMarkers, function (match) {\n        var block = dom.getParent(match.startMarker.start, dom.isBlock);\n        var isRoot = function (node) {\n          return node === block;\n        };\n        if (isReplacementPattern(match.pattern)) {\n          applyReplacementPattern(editor, match.pattern, match.endMarker, isRoot);\n        } else {\n          applyPatternWithContent(editor, match.pattern, match.startMarker, match.endMarker, isRoot);\n        }\n        removeMarker(dom, match.endMarker, isRoot);\n        removeMarker(dom, match.startMarker, isRoot);\n      });\n      editor.selection.moveToBookmark(bookmark);\n    };\n\n    var handleEnter = function (editor, patternSet) {\n      if (!editor.selection.isCollapsed()) {\n        return false;\n      }\n      var inlineMatches = findPatterns$1(editor, patternSet.inlinePatterns, false);\n      var blockMatches = findPatterns(editor, patternSet.blockPatterns);\n      if (blockMatches.length > 0 || inlineMatches.length > 0) {\n        editor.undoManager.add();\n        editor.undoManager.extra(function () {\n          editor.execCommand('mceInsertNewLine');\n        }, function () {\n          editor.insertContent(zeroWidth());\n          applyMatches$1(editor, inlineMatches);\n          applyMatches(editor, blockMatches);\n          var range = editor.selection.getRng();\n          var spot = textBefore(range.startContainer, range.startOffset, editor.dom.getRoot());\n          editor.execCommand('mceInsertNewLine');\n          spot.each(function (s) {\n            if (s.element.data.charAt(s.offset - 1) === zeroWidth()) {\n              s.element.deleteData(s.offset - 1, 1);\n              cleanEmptyNodes(editor.dom, s.element.parentNode, function (e) {\n                return e === editor.dom.getRoot();\n              });\n            }\n          });\n        });\n        return true;\n      }\n      return false;\n    };\n    var handleInlineKey = function (editor, patternSet) {\n      var inlineMatches = findPatterns$1(editor, patternSet.inlinePatterns, true);\n      if (inlineMatches.length > 0) {\n        editor.undoManager.transact(function () {\n          applyMatches$1(editor, inlineMatches);\n        });\n      }\n    };\n    var checkKeyEvent = function (codes, event, predicate) {\n      for (var i = 0; i < codes.length; i++) {\n        if (predicate(codes[i], event)) {\n          return true;\n        }\n      }\n    };\n    var checkKeyCode = function (codes, event) {\n      return checkKeyEvent(codes, event, function (code, event) {\n        return code === event.keyCode && global$2.modifierPressed(event) === false;\n      });\n    };\n    var checkCharCode = function (chars, event) {\n      return checkKeyEvent(chars, event, function (chr, event) {\n        return chr.charCodeAt(0) === event.charCode;\n      });\n    };\n    var KeyHandler = {\n      handleEnter: handleEnter,\n      handleInlineKey: handleInlineKey,\n      checkCharCode: checkCharCode,\n      checkKeyCode: checkKeyCode\n    };\n\n    var setup = function (editor, patternsState) {\n      var charCodes = [\n        ',',\n        '.',\n        ';',\n        ':',\n        '!',\n        '?'\n      ];\n      var keyCodes = [32];\n      editor.on('keydown', function (e) {\n        if (e.keyCode === 13 && !global$2.modifierPressed(e)) {\n          if (KeyHandler.handleEnter(editor, patternsState.get())) {\n            e.preventDefault();\n          }\n        }\n      }, true);\n      editor.on('keyup', function (e) {\n        if (KeyHandler.checkKeyCode(keyCodes, e)) {\n          KeyHandler.handleInlineKey(editor, patternsState.get());\n        }\n      });\n      editor.on('keypress', function (e) {\n        if (KeyHandler.checkCharCode(charCodes, e)) {\n          global$1.setEditorTimeout(editor, function () {\n            KeyHandler.handleInlineKey(editor, patternsState.get());\n          });\n        }\n      });\n    };\n    var Keyboard = { setup: setup };\n\n    function Plugin () {\n      global.add('textpattern', function (editor) {\n        var patternsState = Cell(getPatternSet(editor.settings));\n        Keyboard.setup(editor, patternsState);\n        return Api.get(patternsState);\n      });\n    }\n\n    Plugin();\n\n}(window));\n"]}