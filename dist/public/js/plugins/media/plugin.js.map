{"version":3,"sources":["../../../../../public/js/plugins/media/plugin.js"],"names":["global","tinymce","util","Tools","resolve","__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","call","apply","noop","constant","value","never","always","none","NONE","eq","o","isNone","thunk","id","me","fold","is","isSome","getOr","getOrThunk","getOrDie","msg","Error","getOrNull","getOrUndefined","undefined","or","orThunk","map","each","bind","exists","forall","filter","equals","equals_","toArray","toString","freeze","some","a","constant_a","self","f","v","elementEq","b","from","Option","typeOf","x","Array","isPrototypeOf","constructor","name","String","isType","type","isString","isArray","isFunction","nativeSlice","slice","nativePush","push","xs","len","flatten","r","from$1","Cell","initial","get","set","clone","shallow","old","nu","baseMerge","merger","objects","ret","j","curObject","key","merge","hasOwnProperty$1","obj","has","getScripts","editor","getParam","getAudioTemplateCallback","getVideoTemplateCallback","hasLiveEmbeds","shouldFilterHtml","getUrlResolver","hasAltSource","hasPoster","hasDimensions","Settings","global$1","global$2","global$3","trimPx","replace","addPx","test","getSize","elm","style","setSize","Size","getMaxWidth","getMaxHeight","setMaxWidth","setMaxHeight","getVideoScriptMatch","prefixes","src","indexOf","DOM","getEphoxEmbedIri","getAttrib","isEphoxEmbed","html","fragment","createFragment","firstChild","htmlToDataSax","data","validate","allow_conditional_comments","start","attrs","source1","movie","extend","videoScript","width","height","source2","poster","parse","ephoxEmbedHtmlToData","div","htmlToData","global$4","guess","url","mimes","mp3","m4a","wav","mp4","webm","ogg","swf","fileEnd","toLowerCase","split","pop","mime","Mime","global$5","global$6","DOM$1","setAttributes","updatedAttrs","attr","splice","normalizeHtml","writer","parser","getContent","updateHtmlSax","updateAll","sourceCount","hasImage","comment","text","cdata","raw","empty","end","index","imgAttrs","isEphoxEmbed$1","updateEphoxEmbed","outerHTML","updateHtml","UpdateHtml","urlPatterns","regex","w","h","allowFullscreen","getUrl","pattern","match","exec","newUrl","_loop_1","matchPattern","getIframeHtml","getFlashHtml","getAudioHtml","audioTemplateCallback","source2mime","getVideoHtml","videoTemplateCallback","source1mime","getScriptHtml","dataToHtml","dataIn","embed","convertURL","dom","encode","cache","embedPromise","handler","res","rej","wrappedResolve","response","defaultPromise","loadedData","getEmbedHtml","embedHandler","isCached","Service","unwrap","unwrapped","dimensions","prop","wrap","wrapped","handleError","error","errorMessage","notificationManager","open","snippetToData","embedSnippet","isMediaElement","element","getAttribute","getEditorData","selection","getNode","snippet","serializer","serialize","addEmbedHtml","api","trim","snippetData","nuData","setData","selectPlaceholder","beforeObjects","afterObjects","select","y","handleInsert","insertContent","nodeChanged","submitForm","prevData","newData","then","catch","showDialog","editorData","currentData","initialData","getSourceData","getData","handleSource1","serviceData","win","handleEmbed","dataFromEmbed","handleUpdate","mediaInput","filetype","label","sizeInput","constrain","generalTab","title","items","embedTextarea","embedTab","advancedFormItems","advancedTab","tabs","body","windowManager","size","buttons","primary","onSubmit","close","onChange","detail","Dialog","get$1","Api","register","addCommand","Commands","global$7","global$8","sanitize","blocked","serializeStyle","parseStyle","Sanitize","createPlaceholderNode","node","placeHolder","shortEnded","retainAttributesAndInnerHtml","transparentSrc","createPreviewIframeNode","previewWrapper","previewNode","shimNode","allowfullscreen","class","frameborder","append","sourceNode","targetNode","attrName","attrValue","attribs","ai","innerHtml","attributes","escape","isPageEmbedWrapper","nodeClass","isWithinEmbedWrapper","parent","placeHolderConverter","nodes","ceFalse","Nodes","setup","on","specialElements","schema","getSpecialElements","RegExp","boolAttrs","getBoolAttrs","addNodeFilter","addAttributeFilter","realElm","innerNode","realElmName","className","substr","unescape","$","$elm","find","FilterContent","setup$1","e","target","nodeType","ResolveName","setup$2","selectedNode","hasClass","setAttribute","objectType","preventDefault","Selection","stateSelectorAdapter","selector","buttonApi","selectorChangedWithUnbind","join","setActive","unbind","register$1","ui","registry","addToggleButton","tooltip","icon","onAction","execCommand","onSetup","addMenuItem","Buttons","Plugin","add"],"mappings":"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","file":"plugin.js","sourcesContent":["/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.1.0 (2019-10-17)\n */\n(function () {\n    'use strict';\n\n    var global = tinymce.util.Tools.resolve('tinymce.PluginManager');\n\n    var __assign = function () {\n      __assign = Object.assign || function __assign(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s)\n            if (Object.prototype.hasOwnProperty.call(s, p))\n              t[p] = s[p];\n        }\n        return t;\n      };\n      return __assign.apply(this, arguments);\n    };\n\n    var noop = function () {\n    };\n    var constant = function (value) {\n      return function () {\n        return value;\n      };\n    };\n    var never = constant(false);\n    var always = constant(true);\n\n    var none = function () {\n      return NONE;\n    };\n    var NONE = function () {\n      var eq = function (o) {\n        return o.isNone();\n      };\n      var call = function (thunk) {\n        return thunk();\n      };\n      var id = function (n) {\n        return n;\n      };\n      var me = {\n        fold: function (n, s) {\n          return n();\n        },\n        is: never,\n        isSome: never,\n        isNone: always,\n        getOr: id,\n        getOrThunk: call,\n        getOrDie: function (msg) {\n          throw new Error(msg || 'error: getOrDie called on none.');\n        },\n        getOrNull: constant(null),\n        getOrUndefined: constant(undefined),\n        or: id,\n        orThunk: call,\n        map: none,\n        each: noop,\n        bind: none,\n        exists: never,\n        forall: always,\n        filter: none,\n        equals: eq,\n        equals_: eq,\n        toArray: function () {\n          return [];\n        },\n        toString: constant('none()')\n      };\n      if (Object.freeze) {\n        Object.freeze(me);\n      }\n      return me;\n    }();\n    var some = function (a) {\n      var constant_a = constant(a);\n      var self = function () {\n        return me;\n      };\n      var bind = function (f) {\n        return f(a);\n      };\n      var me = {\n        fold: function (n, s) {\n          return s(a);\n        },\n        is: function (v) {\n          return a === v;\n        },\n        isSome: always,\n        isNone: never,\n        getOr: constant_a,\n        getOrThunk: constant_a,\n        getOrDie: constant_a,\n        getOrNull: constant_a,\n        getOrUndefined: constant_a,\n        or: self,\n        orThunk: self,\n        map: function (f) {\n          return some(f(a));\n        },\n        each: function (f) {\n          f(a);\n        },\n        bind: bind,\n        exists: bind,\n        forall: bind,\n        filter: function (f) {\n          return f(a) ? me : NONE;\n        },\n        toArray: function () {\n          return [a];\n        },\n        toString: function () {\n          return 'some(' + a + ')';\n        },\n        equals: function (o) {\n          return o.is(a);\n        },\n        equals_: function (o, elementEq) {\n          return o.fold(never, function (b) {\n            return elementEq(a, b);\n          });\n        }\n      };\n      return me;\n    };\n    var from = function (value) {\n      return value === null || value === undefined ? NONE : some(value);\n    };\n    var Option = {\n      some: some,\n      none: none,\n      from: from\n    };\n\n    var typeOf = function (x) {\n      if (x === null) {\n        return 'null';\n      }\n      var t = typeof x;\n      if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {\n        return 'array';\n      }\n      if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {\n        return 'string';\n      }\n      return t;\n    };\n    var isType = function (type) {\n      return function (value) {\n        return typeOf(value) === type;\n      };\n    };\n    var isString = isType('string');\n    var isArray = isType('array');\n    var isFunction = isType('function');\n\n    var nativeSlice = Array.prototype.slice;\n    var nativePush = Array.prototype.push;\n    var each = function (xs, f) {\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        f(x, i);\n      }\n    };\n    var flatten = function (xs) {\n      var r = [];\n      for (var i = 0, len = xs.length; i < len; ++i) {\n        if (!isArray(xs[i])) {\n          throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);\n        }\n        nativePush.apply(r, xs[i]);\n      }\n      return r;\n    };\n    var from$1 = isFunction(Array.from) ? Array.from : function (x) {\n      return nativeSlice.call(x);\n    };\n\n    var Cell = function (initial) {\n      var value = initial;\n      var get = function () {\n        return value;\n      };\n      var set = function (v) {\n        value = v;\n      };\n      var clone = function () {\n        return Cell(get());\n      };\n      return {\n        get: get,\n        set: set,\n        clone: clone\n      };\n    };\n\n    var hasOwnProperty = Object.prototype.hasOwnProperty;\n    var shallow = function (old, nu) {\n      return nu;\n    };\n    var baseMerge = function (merger) {\n      return function () {\n        var objects = new Array(arguments.length);\n        for (var i = 0; i < objects.length; i++) {\n          objects[i] = arguments[i];\n        }\n        if (objects.length === 0) {\n          throw new Error('Can\\'t merge zero objects');\n        }\n        var ret = {};\n        for (var j = 0; j < objects.length; j++) {\n          var curObject = objects[j];\n          for (var key in curObject) {\n            if (hasOwnProperty.call(curObject, key)) {\n              ret[key] = merger(ret[key], curObject[key]);\n            }\n          }\n        }\n        return ret;\n      };\n    };\n    var merge = baseMerge(shallow);\n\n    var hasOwnProperty$1 = Object.hasOwnProperty;\n    var get = function (obj, key) {\n      return has(obj, key) ? Option.from(obj[key]) : Option.none();\n    };\n    var has = function (obj, key) {\n      return hasOwnProperty$1.call(obj, key);\n    };\n\n    var getScripts = function (editor) {\n      return editor.getParam('media_scripts');\n    };\n    var getAudioTemplateCallback = function (editor) {\n      return editor.getParam('audio_template_callback');\n    };\n    var getVideoTemplateCallback = function (editor) {\n      return editor.getParam('video_template_callback');\n    };\n    var hasLiveEmbeds = function (editor) {\n      return editor.getParam('media_live_embeds', true);\n    };\n    var shouldFilterHtml = function (editor) {\n      return editor.getParam('media_filter_html', true);\n    };\n    var getUrlResolver = function (editor) {\n      return editor.getParam('media_url_resolver');\n    };\n    var hasAltSource = function (editor) {\n      return editor.getParam('media_alt_source', true);\n    };\n    var hasPoster = function (editor) {\n      return editor.getParam('media_poster', true);\n    };\n    var hasDimensions = function (editor) {\n      return editor.getParam('media_dimensions', true);\n    };\n    var Settings = {\n      getScripts: getScripts,\n      getAudioTemplateCallback: getAudioTemplateCallback,\n      getVideoTemplateCallback: getVideoTemplateCallback,\n      hasLiveEmbeds: hasLiveEmbeds,\n      shouldFilterHtml: shouldFilterHtml,\n      getUrlResolver: getUrlResolver,\n      hasAltSource: hasAltSource,\n      hasPoster: hasPoster,\n      hasDimensions: hasDimensions\n    };\n\n    var global$1 = tinymce.util.Tools.resolve('tinymce.util.Tools');\n\n    var global$2 = tinymce.util.Tools.resolve('tinymce.html.SaxParser');\n\n    var global$3 = tinymce.util.Tools.resolve('tinymce.dom.DOMUtils');\n\n    var trimPx = function (value) {\n      return value.replace(/px$/, '');\n    };\n    var addPx = function (value) {\n      return /^[0-9.]+$/.test(value) ? value + 'px' : value;\n    };\n    var getSize = function (name) {\n      return function (elm) {\n        return elm ? trimPx(elm.style[name]) : '';\n      };\n    };\n    var setSize = function (name) {\n      return function (elm, value) {\n        if (elm) {\n          elm.style[name] = addPx(value);\n        }\n      };\n    };\n    var Size = {\n      getMaxWidth: getSize('maxWidth'),\n      getMaxHeight: getSize('maxHeight'),\n      setMaxWidth: setSize('maxWidth'),\n      setMaxHeight: setSize('maxHeight')\n    };\n\n    var getVideoScriptMatch = function (prefixes, src) {\n      if (prefixes) {\n        for (var i = 0; i < prefixes.length; i++) {\n          if (src.indexOf(prefixes[i].filter) !== -1) {\n            return prefixes[i];\n          }\n        }\n      }\n    };\n\n    var DOM = global$3.DOM;\n    var getEphoxEmbedIri = function (elm) {\n      return DOM.getAttrib(elm, 'data-ephox-embed-iri');\n    };\n    var isEphoxEmbed = function (html) {\n      var fragment = DOM.createFragment(html);\n      return getEphoxEmbedIri(fragment.firstChild) !== '';\n    };\n    var htmlToDataSax = function (prefixes, html) {\n      var data = {};\n      global$2({\n        validate: false,\n        allow_conditional_comments: true,\n        start: function (name, attrs) {\n          if (!data.source1 && name === 'param') {\n            data.source1 = attrs.map.movie;\n          }\n          if (name === 'iframe' || name === 'object' || name === 'embed' || name === 'video' || name === 'audio') {\n            if (!data.type) {\n              data.type = name;\n            }\n            data = global$1.extend(attrs.map, data);\n          }\n          if (name === 'script') {\n            var videoScript = getVideoScriptMatch(prefixes, attrs.map.src);\n            if (!videoScript) {\n              return;\n            }\n            data = {\n              type: 'script',\n              source1: attrs.map.src,\n              width: String(videoScript.width),\n              height: String(videoScript.height)\n            };\n          }\n          if (name === 'source') {\n            if (!data.source1) {\n              data.source1 = attrs.map.src;\n            } else if (!data.source2) {\n              data.source2 = attrs.map.src;\n            }\n          }\n          if (name === 'img' && !data.poster) {\n            data.poster = attrs.map.src;\n          }\n        }\n      }).parse(html);\n      data.source1 = data.source1 || data.src || data.data;\n      data.source2 = data.source2 || '';\n      data.poster = data.poster || '';\n      return data;\n    };\n    var ephoxEmbedHtmlToData = function (html) {\n      var fragment = DOM.createFragment(html);\n      var div = fragment.firstChild;\n      return {\n        type: 'ephox-embed-iri',\n        source1: getEphoxEmbedIri(div),\n        source2: '',\n        poster: '',\n        width: Size.getMaxWidth(div),\n        height: Size.getMaxHeight(div)\n      };\n    };\n    var htmlToData = function (prefixes, html) {\n      return isEphoxEmbed(html) ? ephoxEmbedHtmlToData(html) : htmlToDataSax(prefixes, html);\n    };\n\n    var global$4 = tinymce.util.Tools.resolve('tinymce.util.Promise');\n\n    var guess = function (url) {\n      var mimes = {\n        mp3: 'audio/mpeg',\n        m4a: 'audio/x-m4a',\n        wav: 'audio/wav',\n        mp4: 'video/mp4',\n        webm: 'video/webm',\n        ogg: 'video/ogg',\n        swf: 'application/x-shockwave-flash'\n      };\n      var fileEnd = url.toLowerCase().split('.').pop();\n      var mime = mimes[fileEnd];\n      return mime ? mime : '';\n    };\n    var Mime = { guess: guess };\n\n    var global$5 = tinymce.util.Tools.resolve('tinymce.html.Writer');\n\n    var global$6 = tinymce.util.Tools.resolve('tinymce.html.Schema');\n\n    var DOM$1 = global$3.DOM;\n    var setAttributes = function (attrs, updatedAttrs) {\n      var name;\n      var i;\n      var value;\n      var attr;\n      for (name in updatedAttrs) {\n        value = '' + updatedAttrs[name];\n        if (attrs.map[name]) {\n          i = attrs.length;\n          while (i--) {\n            attr = attrs[i];\n            if (attr.name === name) {\n              if (value) {\n                attrs.map[name] = value;\n                attr.value = value;\n              } else {\n                delete attrs.map[name];\n                attrs.splice(i, 1);\n              }\n            }\n          }\n        } else if (value) {\n          attrs.push({\n            name: name,\n            value: value\n          });\n          attrs.map[name] = value;\n        }\n      }\n    };\n    var normalizeHtml = function (html) {\n      var writer = global$5();\n      var parser = global$2(writer);\n      parser.parse(html);\n      return writer.getContent();\n    };\n    var updateHtmlSax = function (html, data, updateAll) {\n      var writer = global$5();\n      var sourceCount = 0;\n      var hasImage;\n      global$2({\n        validate: false,\n        allow_conditional_comments: true,\n        comment: function (text) {\n          writer.comment(text);\n        },\n        cdata: function (text) {\n          writer.cdata(text);\n        },\n        text: function (text, raw) {\n          writer.text(text, raw);\n        },\n        start: function (name, attrs, empty) {\n          switch (name) {\n          case 'video':\n          case 'object':\n          case 'embed':\n          case 'img':\n          case 'iframe':\n            if (data.height !== undefined && data.width !== undefined) {\n              setAttributes(attrs, {\n                width: data.width,\n                height: data.height\n              });\n            }\n            break;\n          }\n          if (updateAll) {\n            switch (name) {\n            case 'video':\n              setAttributes(attrs, {\n                poster: data.poster,\n                src: ''\n              });\n              if (data.source2) {\n                setAttributes(attrs, { src: '' });\n              }\n              break;\n            case 'iframe':\n              setAttributes(attrs, { src: data.source1 });\n              break;\n            case 'source':\n              sourceCount++;\n              if (sourceCount <= 2) {\n                setAttributes(attrs, {\n                  src: data['source' + sourceCount],\n                  type: data['source' + sourceCount + 'mime']\n                });\n                if (!data['source' + sourceCount]) {\n                  return;\n                }\n              }\n              break;\n            case 'img':\n              if (!data.poster) {\n                return;\n              }\n              hasImage = true;\n              break;\n            }\n          }\n          writer.start(name, attrs, empty);\n        },\n        end: function (name) {\n          if (name === 'video' && updateAll) {\n            for (var index = 1; index <= 2; index++) {\n              if (data['source' + index]) {\n                var attrs = [];\n                attrs.map = {};\n                if (sourceCount < index) {\n                  setAttributes(attrs, {\n                    src: data['source' + index],\n                    type: data['source' + index + 'mime']\n                  });\n                  writer.start('source', attrs, true);\n                }\n              }\n            }\n          }\n          if (data.poster && name === 'object' && updateAll && !hasImage) {\n            var imgAttrs = [];\n            imgAttrs.map = {};\n            setAttributes(imgAttrs, {\n              src: data.poster,\n              width: data.width,\n              height: data.height\n            });\n            writer.start('img', imgAttrs, true);\n          }\n          writer.end(name);\n        }\n      }, global$6({})).parse(html);\n      return writer.getContent();\n    };\n    var isEphoxEmbed$1 = function (html) {\n      var fragment = DOM$1.createFragment(html);\n      return DOM$1.getAttrib(fragment.firstChild, 'data-ephox-embed-iri') !== '';\n    };\n    var updateEphoxEmbed = function (html, data) {\n      var fragment = DOM$1.createFragment(html);\n      var div = fragment.firstChild;\n      Size.setMaxWidth(div, data.width);\n      Size.setMaxHeight(div, data.height);\n      return normalizeHtml(div.outerHTML);\n    };\n    var updateHtml = function (html, data, updateAll) {\n      return isEphoxEmbed$1(html) ? updateEphoxEmbed(html, data) : updateHtmlSax(html, data, updateAll);\n    };\n    var UpdateHtml = { updateHtml: updateHtml };\n\n    var urlPatterns = [\n      {\n        regex: /youtu\\.be\\/([\\w\\-_\\?&=.]+)/i,\n        type: 'iframe',\n        w: 560,\n        h: 314,\n        url: '//www.youtube.com/embed/$1',\n        allowFullscreen: true\n      },\n      {\n        regex: /youtube\\.com(.+)v=([^&]+)(&([a-z0-9&=\\-_]+))?/i,\n        type: 'iframe',\n        w: 560,\n        h: 314,\n        url: '//www.youtube.com/embed/$2?$4',\n        allowFullscreen: true\n      },\n      {\n        regex: /youtube.com\\/embed\\/([a-z0-9\\?&=\\-_]+)/i,\n        type: 'iframe',\n        w: 560,\n        h: 314,\n        url: '//www.youtube.com/embed/$1',\n        allowFullscreen: true\n      },\n      {\n        regex: /vimeo\\.com\\/([0-9]+)/,\n        type: 'iframe',\n        w: 425,\n        h: 350,\n        url: '//player.vimeo.com/video/$1?title=0&byline=0&portrait=0&color=8dc7dc',\n        allowFullscreen: true\n      },\n      {\n        regex: /vimeo\\.com\\/(.*)\\/([0-9]+)/,\n        type: 'iframe',\n        w: 425,\n        h: 350,\n        url: '//player.vimeo.com/video/$2?title=0&amp;byline=0',\n        allowFullscreen: true\n      },\n      {\n        regex: /maps\\.google\\.([a-z]{2,3})\\/maps\\/(.+)msid=(.+)/,\n        type: 'iframe',\n        w: 425,\n        h: 350,\n        url: '//maps.google.com/maps/ms?msid=$2&output=embed\"',\n        allowFullscreen: false\n      },\n      {\n        regex: /dailymotion\\.com\\/video\\/([^_]+)/,\n        type: 'iframe',\n        w: 480,\n        h: 270,\n        url: '//www.dailymotion.com/embed/video/$1',\n        allowFullscreen: true\n      },\n      {\n        regex: /dai\\.ly\\/([^_]+)/,\n        type: 'iframe',\n        w: 480,\n        h: 270,\n        url: '//www.dailymotion.com/embed/video/$1',\n        allowFullscreen: true\n      }\n    ];\n    var getUrl = function (pattern, url) {\n      var match = pattern.regex.exec(url);\n      var newUrl = pattern.url;\n      var _loop_1 = function (i) {\n        newUrl = newUrl.replace('$' + i, function () {\n          return match[i] ? match[i] : '';\n        });\n      };\n      for (var i = 0; i < match.length; i++) {\n        _loop_1(i);\n      }\n      return newUrl.replace(/\\?$/, '');\n    };\n    var matchPattern = function (url) {\n      var pattern = urlPatterns.filter(function (pattern) {\n        return pattern.regex.test(url);\n      });\n      if (pattern.length > 0) {\n        return global$1.extend({}, pattern[0], { url: getUrl(pattern[0], url) });\n      } else {\n        return null;\n      }\n    };\n\n    var getIframeHtml = function (data) {\n      var allowFullscreen = data.allowFullscreen ? ' allowFullscreen=\"1\"' : '';\n      return '<iframe src=\"' + data.source1 + '\" width=\"' + data.width + '\" height=\"' + data.height + '\"' + allowFullscreen + '></iframe>';\n    };\n    var getFlashHtml = function (data) {\n      var html = '<object data=\"' + data.source1 + '\" width=\"' + data.width + '\" height=\"' + data.height + '\" type=\"application/x-shockwave-flash\">';\n      if (data.poster) {\n        html += '<img src=\"' + data.poster + '\" width=\"' + data.width + '\" height=\"' + data.height + '\" />';\n      }\n      html += '</object>';\n      return html;\n    };\n    var getAudioHtml = function (data, audioTemplateCallback) {\n      if (audioTemplateCallback) {\n        return audioTemplateCallback(data);\n      } else {\n        return '<audio controls=\"controls\" src=\"' + data.source1 + '\">' + (data.source2 ? '\\n<source src=\"' + data.source2 + '\"' + (data.source2mime ? ' type=\"' + data.source2mime + '\"' : '') + ' />\\n' : '') + '</audio>';\n      }\n    };\n    var getVideoHtml = function (data, videoTemplateCallback) {\n      if (videoTemplateCallback) {\n        return videoTemplateCallback(data);\n      } else {\n        return '<video width=\"' + data.width + '\" height=\"' + data.height + '\"' + (data.poster ? ' poster=\"' + data.poster + '\"' : '') + ' controls=\"controls\">\\n' + '<source src=\"' + data.source1 + '\"' + (data.source1mime ? ' type=\"' + data.source1mime + '\"' : '') + ' />\\n' + (data.source2 ? '<source src=\"' + data.source2 + '\"' + (data.source2mime ? ' type=\"' + data.source2mime + '\"' : '') + ' />\\n' : '') + '</video>';\n      }\n    };\n    var getScriptHtml = function (data) {\n      return '<script src=\"' + data.source1 + '\"></script>';\n    };\n    var dataToHtml = function (editor, dataIn) {\n      var data = global$1.extend({}, dataIn);\n      if (!data.source1) {\n        global$1.extend(data, htmlToData(Settings.getScripts(editor), data.embed));\n        if (!data.source1) {\n          return '';\n        }\n      }\n      if (!data.source2) {\n        data.source2 = '';\n      }\n      if (!data.poster) {\n        data.poster = '';\n      }\n      data.source1 = editor.convertURL(data.source1, 'source');\n      data.source2 = editor.convertURL(data.source2, 'source');\n      data.source1mime = Mime.guess(data.source1);\n      data.source2mime = Mime.guess(data.source2);\n      data.poster = editor.convertURL(data.poster, 'poster');\n      var pattern = matchPattern(data.source1);\n      if (pattern) {\n        data.source1 = pattern.url;\n        data.type = pattern.type;\n        data.allowFullscreen = pattern.allowFullscreen;\n        data.width = data.width || String(pattern.w);\n        data.height = data.height || String(pattern.h);\n      }\n      if (data.embed) {\n        return UpdateHtml.updateHtml(data.embed, data, true);\n      } else {\n        var videoScript = getVideoScriptMatch(Settings.getScripts(editor), data.source1);\n        if (videoScript) {\n          data.type = 'script';\n          data.width = String(videoScript.width);\n          data.height = String(videoScript.height);\n        }\n        var audioTemplateCallback = Settings.getAudioTemplateCallback(editor);\n        var videoTemplateCallback = Settings.getVideoTemplateCallback(editor);\n        data.width = data.width || '300';\n        data.height = data.height || '150';\n        global$1.each(data, function (value, key) {\n          data[key] = editor.dom.encode('' + value);\n        });\n        if (data.type === 'iframe') {\n          return getIframeHtml(data);\n        } else if (data.source1mime === 'application/x-shockwave-flash') {\n          return getFlashHtml(data);\n        } else if (data.source1mime.indexOf('audio') !== -1) {\n          return getAudioHtml(data, audioTemplateCallback);\n        } else if (data.type === 'script') {\n          return getScriptHtml(data);\n        } else {\n          return getVideoHtml(data, videoTemplateCallback);\n        }\n      }\n    };\n\n    var cache = {};\n    var embedPromise = function (data, dataToHtml, handler) {\n      return new global$4(function (res, rej) {\n        var wrappedResolve = function (response) {\n          if (response.html) {\n            cache[data.source1] = response;\n          }\n          return res({\n            url: data.source1,\n            html: response.html ? response.html : dataToHtml(data)\n          });\n        };\n        if (cache[data.source1]) {\n          wrappedResolve(cache[data.source1]);\n        } else {\n          handler({ url: data.source1 }, wrappedResolve, rej);\n        }\n      });\n    };\n    var defaultPromise = function (data, dataToHtml) {\n      return new global$4(function (res) {\n        res({\n          html: dataToHtml(data),\n          url: data.source1\n        });\n      });\n    };\n    var loadedData = function (editor) {\n      return function (data) {\n        return dataToHtml(editor, data);\n      };\n    };\n    var getEmbedHtml = function (editor, data) {\n      var embedHandler = Settings.getUrlResolver(editor);\n      return embedHandler ? embedPromise(data, loadedData(editor), embedHandler) : defaultPromise(data, loadedData(editor));\n    };\n    var isCached = function (url) {\n      return cache.hasOwnProperty(url);\n    };\n    var Service = {\n      getEmbedHtml: getEmbedHtml,\n      isCached: isCached\n    };\n\n    var unwrap = function (data) {\n      var unwrapped = merge(data, {\n        source1: data.source1.value,\n        source2: get(data, 'source2').bind(function (source2) {\n          return get(source2, 'value');\n        }).getOr(''),\n        poster: get(data, 'poster').bind(function (poster) {\n          return get(poster, 'value');\n        }).getOr('')\n      });\n      get(data, 'dimensions').each(function (dimensions) {\n        each([\n          'width',\n          'height'\n        ], function (prop) {\n          get(dimensions, prop).each(function (value) {\n            return unwrapped[prop] = value;\n          });\n        });\n      });\n      return unwrapped;\n    };\n    var wrap = function (data) {\n      var wrapped = merge(data, {\n        source1: { value: get(data, 'source1').getOr('') },\n        source2: { value: get(data, 'source2').getOr('') },\n        poster: { value: get(data, 'poster').getOr('') }\n      });\n      each([\n        'width',\n        'height'\n      ], function (prop) {\n        get(data, prop).each(function (value) {\n          var dimensions = wrapped.dimensions || {};\n          dimensions[prop] = value;\n          wrapped.dimensions = dimensions;\n        });\n      });\n      return wrapped;\n    };\n    var handleError = function (editor) {\n      return function (error) {\n        var errorMessage = error && error.msg ? 'Media embed handler error: ' + error.msg : 'Media embed handler threw unknown error.';\n        editor.notificationManager.open({\n          type: 'error',\n          text: errorMessage\n        });\n      };\n    };\n    var snippetToData = function (editor, embedSnippet) {\n      return htmlToData(Settings.getScripts(editor), embedSnippet);\n    };\n    var isMediaElement = function (element) {\n      return element.getAttribute('data-mce-object') || element.getAttribute('data-ephox-embed-iri');\n    };\n    var getEditorData = function (editor) {\n      var element = editor.selection.getNode();\n      var snippet = isMediaElement(element) ? editor.serializer.serialize(element, { selection: true }) : '';\n      return merge({ embed: snippet }, htmlToData(Settings.getScripts(editor), snippet));\n    };\n    var addEmbedHtml = function (api, editor) {\n      return function (response) {\n        if (isString(response.url) && response.url.trim().length > 0) {\n          var html = response.html;\n          var snippetData = snippetToData(editor, html);\n          var nuData = __assign(__assign({}, snippetData), {\n            source1: response.url,\n            embed: html\n          });\n          api.setData(wrap(nuData));\n        }\n      };\n    };\n    var selectPlaceholder = function (editor, beforeObjects) {\n      var afterObjects = editor.dom.select('img[data-mce-object]');\n      for (var i = 0; i < beforeObjects.length; i++) {\n        for (var y = afterObjects.length - 1; y >= 0; y--) {\n          if (beforeObjects[i] === afterObjects[y]) {\n            afterObjects.splice(y, 1);\n          }\n        }\n      }\n      editor.selection.select(afterObjects[0]);\n    };\n    var handleInsert = function (editor, html) {\n      var beforeObjects = editor.dom.select('img[data-mce-object]');\n      editor.insertContent(html);\n      selectPlaceholder(editor, beforeObjects);\n      editor.nodeChanged();\n    };\n    var submitForm = function (prevData, newData, editor) {\n      newData.embed = UpdateHtml.updateHtml(newData.embed, newData);\n      if (newData.embed && (prevData.source1 === newData.source1 || Service.isCached(newData.source1))) {\n        handleInsert(editor, newData.embed);\n      } else {\n        Service.getEmbedHtml(editor, newData).then(function (response) {\n          handleInsert(editor, response.html);\n        }).catch(handleError(editor));\n      }\n    };\n    var showDialog = function (editor) {\n      var editorData = getEditorData(editor);\n      var currentData = Cell(editorData);\n      var initialData = wrap(editorData);\n      var getSourceData = function (api) {\n        return unwrap(api.getData());\n      };\n      var handleSource1 = function (prevData, api) {\n        var serviceData = getSourceData(api);\n        if (prevData.source1 !== serviceData.source1) {\n          addEmbedHtml(win, editor)({\n            url: serviceData.source1,\n            html: ''\n          });\n          Service.getEmbedHtml(editor, serviceData).then(addEmbedHtml(win, editor)).catch(handleError(editor));\n        }\n      };\n      var handleEmbed = function (api) {\n        var data = unwrap(api.getData());\n        var dataFromEmbed = snippetToData(editor, data.embed);\n        api.setData(wrap(dataFromEmbed));\n      };\n      var handleUpdate = function (api) {\n        var data = getSourceData(api);\n        var embed = dataToHtml(editor, data);\n        api.setData(wrap(__assign(__assign({}, data), { embed: embed })));\n      };\n      var mediaInput = [{\n          name: 'source1',\n          type: 'urlinput',\n          filetype: 'media',\n          label: 'Source'\n        }];\n      var sizeInput = !Settings.hasDimensions(editor) ? [] : [{\n          type: 'sizeinput',\n          name: 'dimensions',\n          label: 'Constrain proportions',\n          constrain: true\n        }];\n      var generalTab = {\n        title: 'General',\n        name: 'general',\n        items: flatten([\n          mediaInput,\n          sizeInput\n        ])\n      };\n      var embedTextarea = {\n        type: 'textarea',\n        name: 'embed',\n        label: 'Paste your embed code below:'\n      };\n      var embedTab = {\n        title: 'Embed',\n        items: [embedTextarea]\n      };\n      var advancedFormItems = [];\n      if (Settings.hasAltSource(editor)) {\n        advancedFormItems.push({\n          name: 'source2',\n          type: 'urlinput',\n          filetype: 'media',\n          label: 'Alternative source URL'\n        });\n      }\n      if (Settings.hasPoster(editor)) {\n        advancedFormItems.push({\n          name: 'poster',\n          type: 'urlinput',\n          filetype: 'image',\n          label: 'Media poster (Image URL)'\n        });\n      }\n      var advancedTab = {\n        title: 'Advanced',\n        name: 'advanced',\n        items: advancedFormItems\n      };\n      var tabs = [\n        generalTab,\n        embedTab\n      ];\n      if (advancedFormItems.length > 0) {\n        tabs.push(advancedTab);\n      }\n      var body = {\n        type: 'tabpanel',\n        tabs: tabs\n      };\n      var win = editor.windowManager.open({\n        title: 'Insert/Edit Media',\n        size: 'normal',\n        body: body,\n        buttons: [\n          {\n            type: 'cancel',\n            name: 'cancel',\n            text: 'Cancel'\n          },\n          {\n            type: 'submit',\n            name: 'save',\n            text: 'Save',\n            primary: true\n          }\n        ],\n        onSubmit: function (api) {\n          var serviceData = getSourceData(api);\n          submitForm(currentData.get(), serviceData, editor);\n          api.close();\n        },\n        onChange: function (api, detail) {\n          switch (detail.name) {\n          case 'source1':\n            handleSource1(currentData.get(), api);\n            break;\n          case 'embed':\n            handleEmbed(api);\n            break;\n          case 'dimensions':\n          case 'poster':\n            handleUpdate(api);\n            break;\n          default:\n            break;\n          }\n          currentData.set(getSourceData(api));\n        },\n        initialData: initialData\n      });\n    };\n    var Dialog = { showDialog: showDialog };\n\n    var get$1 = function (editor) {\n      var showDialog = function () {\n        Dialog.showDialog(editor);\n      };\n      return { showDialog: showDialog };\n    };\n    var Api = { get: get$1 };\n\n    var register = function (editor) {\n      var showDialog = function () {\n        Dialog.showDialog(editor);\n      };\n      editor.addCommand('mceMedia', showDialog);\n    };\n    var Commands = { register: register };\n\n    var global$7 = tinymce.util.Tools.resolve('tinymce.html.Node');\n\n    var global$8 = tinymce.util.Tools.resolve('tinymce.Env');\n\n    var sanitize = function (editor, html) {\n      if (Settings.shouldFilterHtml(editor) === false) {\n        return html;\n      }\n      var writer = global$5();\n      var blocked;\n      global$2({\n        validate: false,\n        allow_conditional_comments: false,\n        comment: function (text) {\n          writer.comment(text);\n        },\n        cdata: function (text) {\n          writer.cdata(text);\n        },\n        text: function (text, raw) {\n          writer.text(text, raw);\n        },\n        start: function (name, attrs, empty) {\n          blocked = true;\n          if (name === 'script' || name === 'noscript') {\n            return;\n          }\n          for (var i = 0; i < attrs.length; i++) {\n            if (attrs[i].name.indexOf('on') === 0) {\n              return;\n            }\n            if (attrs[i].name === 'style') {\n              attrs[i].value = editor.dom.serializeStyle(editor.dom.parseStyle(attrs[i].value), name);\n            }\n          }\n          writer.start(name, attrs, empty);\n          blocked = false;\n        },\n        end: function (name) {\n          if (blocked) {\n            return;\n          }\n          writer.end(name);\n        }\n      }, global$6({})).parse(html);\n      return writer.getContent();\n    };\n    var Sanitize = { sanitize: sanitize };\n\n    var createPlaceholderNode = function (editor, node) {\n      var placeHolder;\n      var name = node.name;\n      placeHolder = new global$7('img', 1);\n      placeHolder.shortEnded = true;\n      retainAttributesAndInnerHtml(editor, node, placeHolder);\n      placeHolder.attr({\n        'width': node.attr('width') || '300',\n        'height': node.attr('height') || (name === 'audio' ? '30' : '150'),\n        'style': node.attr('style'),\n        'src': global$8.transparentSrc,\n        'data-mce-object': name,\n        'class': 'mce-object mce-object-' + name\n      });\n      return placeHolder;\n    };\n    var createPreviewIframeNode = function (editor, node) {\n      var previewWrapper;\n      var previewNode;\n      var shimNode;\n      var name = node.name;\n      previewWrapper = new global$7('span', 1);\n      previewWrapper.attr({\n        'contentEditable': 'false',\n        'style': node.attr('style'),\n        'data-mce-object': name,\n        'class': 'mce-preview-object mce-object-' + name\n      });\n      retainAttributesAndInnerHtml(editor, node, previewWrapper);\n      previewNode = new global$7(name, 1);\n      previewNode.attr({\n        src: node.attr('src'),\n        allowfullscreen: node.attr('allowfullscreen'),\n        style: node.attr('style'),\n        class: node.attr('class'),\n        width: node.attr('width'),\n        height: node.attr('height'),\n        frameborder: '0'\n      });\n      shimNode = new global$7('span', 1);\n      shimNode.attr('class', 'mce-shim');\n      previewWrapper.append(previewNode);\n      previewWrapper.append(shimNode);\n      return previewWrapper;\n    };\n    var retainAttributesAndInnerHtml = function (editor, sourceNode, targetNode) {\n      var attrName;\n      var attrValue;\n      var attribs;\n      var ai;\n      var innerHtml;\n      attribs = sourceNode.attributes;\n      ai = attribs.length;\n      while (ai--) {\n        attrName = attribs[ai].name;\n        attrValue = attribs[ai].value;\n        if (attrName !== 'width' && attrName !== 'height' && attrName !== 'style') {\n          if (attrName === 'data' || attrName === 'src') {\n            attrValue = editor.convertURL(attrValue, attrName);\n          }\n          targetNode.attr('data-mce-p-' + attrName, attrValue);\n        }\n      }\n      innerHtml = sourceNode.firstChild && sourceNode.firstChild.value;\n      if (innerHtml) {\n        targetNode.attr('data-mce-html', escape(Sanitize.sanitize(editor, innerHtml)));\n        targetNode.firstChild = null;\n      }\n    };\n    var isPageEmbedWrapper = function (node) {\n      var nodeClass = node.attr('class');\n      return nodeClass && /\\btiny-pageembed\\b/.test(nodeClass);\n    };\n    var isWithinEmbedWrapper = function (node) {\n      while (node = node.parent) {\n        if (node.attr('data-ephox-embed-iri') || isPageEmbedWrapper(node)) {\n          return true;\n        }\n      }\n      return false;\n    };\n    var placeHolderConverter = function (editor) {\n      return function (nodes) {\n        var i = nodes.length;\n        var node;\n        var videoScript;\n        while (i--) {\n          node = nodes[i];\n          if (!node.parent) {\n            continue;\n          }\n          if (node.parent.attr('data-mce-object')) {\n            continue;\n          }\n          if (node.name === 'script') {\n            videoScript = getVideoScriptMatch(Settings.getScripts(editor), node.attr('src'));\n            if (!videoScript) {\n              continue;\n            }\n          }\n          if (videoScript) {\n            if (videoScript.width) {\n              node.attr('width', videoScript.width.toString());\n            }\n            if (videoScript.height) {\n              node.attr('height', videoScript.height.toString());\n            }\n          }\n          if (node.name === 'iframe' && Settings.hasLiveEmbeds(editor) && global$8.ceFalse) {\n            if (!isWithinEmbedWrapper(node)) {\n              node.replace(createPreviewIframeNode(editor, node));\n            }\n          } else {\n            if (!isWithinEmbedWrapper(node)) {\n              node.replace(createPlaceholderNode(editor, node));\n            }\n          }\n        }\n      };\n    };\n    var Nodes = {\n      createPreviewIframeNode: createPreviewIframeNode,\n      createPlaceholderNode: createPlaceholderNode,\n      placeHolderConverter: placeHolderConverter\n    };\n\n    var setup = function (editor) {\n      editor.on('preInit', function () {\n        var specialElements = editor.schema.getSpecialElements();\n        global$1.each('video audio iframe object'.split(' '), function (name) {\n          specialElements[name] = new RegExp('</' + name + '[^>]*>', 'gi');\n        });\n        var boolAttrs = editor.schema.getBoolAttrs();\n        global$1.each('webkitallowfullscreen mozallowfullscreen allowfullscreen'.split(' '), function (name) {\n          boolAttrs[name] = {};\n        });\n        editor.parser.addNodeFilter('iframe,video,audio,object,embed,script', Nodes.placeHolderConverter(editor));\n        editor.serializer.addAttributeFilter('data-mce-object', function (nodes, name) {\n          var i = nodes.length;\n          var node;\n          var realElm;\n          var ai;\n          var attribs;\n          var innerHtml;\n          var innerNode;\n          var realElmName;\n          var className;\n          while (i--) {\n            node = nodes[i];\n            if (!node.parent) {\n              continue;\n            }\n            realElmName = node.attr(name);\n            realElm = new global$7(realElmName, 1);\n            if (realElmName !== 'audio' && realElmName !== 'script') {\n              className = node.attr('class');\n              if (className && className.indexOf('mce-preview-object') !== -1) {\n                realElm.attr({\n                  width: node.firstChild.attr('width'),\n                  height: node.firstChild.attr('height')\n                });\n              } else {\n                realElm.attr({\n                  width: node.attr('width'),\n                  height: node.attr('height')\n                });\n              }\n            }\n            realElm.attr({ style: node.attr('style') });\n            attribs = node.attributes;\n            ai = attribs.length;\n            while (ai--) {\n              var attrName = attribs[ai].name;\n              if (attrName.indexOf('data-mce-p-') === 0) {\n                realElm.attr(attrName.substr(11), attribs[ai].value);\n              }\n            }\n            if (realElmName === 'script') {\n              realElm.attr('type', 'text/javascript');\n            }\n            innerHtml = node.attr('data-mce-html');\n            if (innerHtml) {\n              innerNode = new global$7('#text', 3);\n              innerNode.raw = true;\n              innerNode.value = Sanitize.sanitize(editor, unescape(innerHtml));\n              realElm.append(innerNode);\n            }\n            node.replace(realElm);\n          }\n        });\n      });\n      editor.on('SetContent', function () {\n        editor.$('span.mce-preview-object').each(function (index, elm) {\n          var $elm = editor.$(elm);\n          if ($elm.find('span.mce-shim').length === 0) {\n            $elm.append('<span class=\"mce-shim\"></span>');\n          }\n        });\n      });\n    };\n    var FilterContent = { setup: setup };\n\n    var setup$1 = function (editor) {\n      editor.on('ResolveName', function (e) {\n        var name;\n        if (e.target.nodeType === 1 && (name = e.target.getAttribute('data-mce-object'))) {\n          e.name = name;\n        }\n      });\n    };\n    var ResolveName = { setup: setup$1 };\n\n    var setup$2 = function (editor) {\n      editor.on('click keyup touchend', function () {\n        var selectedNode = editor.selection.getNode();\n        if (selectedNode && editor.dom.hasClass(selectedNode, 'mce-preview-object')) {\n          if (editor.dom.getAttrib(selectedNode, 'data-mce-selected')) {\n            selectedNode.setAttribute('data-mce-selected', '2');\n          }\n        }\n      });\n      editor.on('ObjectSelected', function (e) {\n        var objectType = e.target.getAttribute('data-mce-object');\n        if (objectType === 'audio' || objectType === 'script') {\n          e.preventDefault();\n        }\n      });\n      editor.on('ObjectResized', function (e) {\n        var target = e.target;\n        var html;\n        if (target.getAttribute('data-mce-object')) {\n          html = target.getAttribute('data-mce-html');\n          if (html) {\n            html = unescape(html);\n            target.setAttribute('data-mce-html', escape(UpdateHtml.updateHtml(html, {\n              width: String(e.width),\n              height: String(e.height)\n            })));\n          }\n        }\n      });\n    };\n    var Selection = { setup: setup$2 };\n\n    var stateSelectorAdapter = function (editor, selector) {\n      return function (buttonApi) {\n        return editor.selection.selectorChangedWithUnbind(selector.join(','), buttonApi.setActive).unbind;\n      };\n    };\n    var register$1 = function (editor) {\n      editor.ui.registry.addToggleButton('media', {\n        tooltip: 'Insert/edit media',\n        icon: 'embed',\n        onAction: function () {\n          editor.execCommand('mceMedia');\n        },\n        onSetup: stateSelectorAdapter(editor, [\n          'img[data-mce-object]',\n          'span[data-mce-object]',\n          'div[data-ephox-embed-iri]'\n        ])\n      });\n      editor.ui.registry.addMenuItem('media', {\n        icon: 'embed',\n        text: 'Media...',\n        onAction: function () {\n          editor.execCommand('mceMedia');\n        }\n      });\n    };\n    var Buttons = { register: register$1 };\n\n    function Plugin () {\n      global.add('media', function (editor) {\n        Commands.register(editor);\n        Buttons.register(editor);\n        ResolveName.setup(editor);\n        FilterContent.setup(editor);\n        Selection.setup(editor);\n        return Api.get(editor);\n      });\n    }\n\n    Plugin();\n\n}());\n"]}