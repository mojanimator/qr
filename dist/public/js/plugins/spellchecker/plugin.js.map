{"version":3,"sources":["../../../../../public/js/plugins/spellchecker/plugin.js"],"names":["domGlobals","Cell","initial","value","get","set","v","clone","global","tinymce","util","Tools","resolve","hasProPlugin","editor","test","settings","plugins","window","console","log","DetectProPlugin","global$1","global$2","global$3","fireSpellcheckStart","fire","fireSpellcheckEnd","Events","getLanguages","defaultLanguages","getParam","getLanguage","defaultLanguage","getRpcUrl","getSpellcheckerCallback","getSpellcheckerWordcharPattern","defaultPattern","RegExp","Settings","isContentEditableFalse","node","nodeType","contentEditable","DomTextMatcher","m","matches","text","dom","blockElementsMap","hiddenTextElementsMap","shortEndedElementsMap","schema","getBlockElements","getWhiteSpaceElements","getShortEndedElements","createMatch","data","Error","start","index","end","length","getText","txt","nodeName","firstChild","nextSibling","stepThroughMatches","replaceFn","startNode","endNode","startNodeIndex","endNodeIndex","innerNodes","atIndex","curNode","matchLocation","matchIndex","slice","sort","a","b","shift","out","push","match","parentNode","genReplacer","callback","makeReplacementNode","fill","stencil","cloneNode","setAttribute","appendChild","doc","createTextNode","range","before","after","node_1","substring","insertBefore","el","removeChild","elA","i","l","innerNode","innerEl","replaceChild","elB","unwrapElement","element","hasClass","elm","className","indexOf","getWrappersByIndex","elements","getElementsByTagName","wrappers","dataIndex","getAttribute","filter","filteredMatches","each","wrap","find","regex","exec","unwrap","matchFromElement","elementFromMatch","add","substr","rangeFromMatch","rng","createRng","setStartBefore","setEndAfter","replace","deleteContents","insertNode","reset","splice","getTextMatcher","textMatcherState","textMatcher","getBody","isEmpty","obj","_","defaultSpellcheckCallback","pluginUrl","currentLanguageState","method","doneCallback","errorCallback","lang","postData","key","encodeURIComponent","send","url","toAbsolute","type","content_type","success","result","parseResult","JSON","parse","message","translate","error","sendRpcCall","name","successCallback","userSpellcheckCallback","spellCheckCallback","call","spellchecker","spellcheck","startedState","lastSuggestionsState","finish","notificationManager","open","setProgressState","markErrors","focus","checkIfFinished","select","addToDictionary","word","spans","remove","ignoreWord","all","selection","collapse","span","bookmark","getBookmark","moveToBookmark","getElmIndex","findSpansByIndex","nodes","toArray","nodeIndex","toString","hasDictionarySupport","dictionary","suggestions","words","create","Actions","getWordCharPattern","Api","register","addCommand","Commands","__assign","Object","assign","t","s","n","arguments","p","prototype","hasOwnProperty","apply","spellcheckerEvents","buildMenuItems","listName","languageValues","items","languageValue","selectable","getItems","map","split","langPair","register$1","languageMenuItems","startSpellchecking","buttonArgs","tooltip","onAction","icon","onSetup","buttonApi","setButtonState","setActive","on","off","splitButtonArgs","fetch","languageItem","onItemAction","splitButtonApi","ui","registry","addSplitButton","addToggleButton","addToggleMenuItem","menuApi","setMenuItemCheck","Buttons","ignoreAll","getSuggestions","suggestion","insertContent","encode","setup","update","target","setRng","addContextMenu","SuggestionsMenu","Plugin"],"mappings":"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","file":"plugin.js","sourcesContent":["/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.1.0 (2019-10-17)\n */\n(function (domGlobals) {\n    'use strict';\n\n    var Cell = function (initial) {\n      var value = initial;\n      var get = function () {\n        return value;\n      };\n      var set = function (v) {\n        value = v;\n      };\n      var clone = function () {\n        return Cell(get());\n      };\n      return {\n        get: get,\n        set: set,\n        clone: clone\n      };\n    };\n\n    var global = tinymce.util.Tools.resolve('tinymce.PluginManager');\n\n    var hasProPlugin = function (editor) {\n      if (/(^|[ ,])tinymcespellchecker([, ]|$)/.test(editor.settings.plugins) && global.get('tinymcespellchecker')) {\n        if (typeof domGlobals.window.console !== 'undefined' && domGlobals.window.console.log) {\n          domGlobals.window.console.log('Spell Checker Pro is incompatible with Spell Checker plugin! ' + 'Remove \\'spellchecker\\' from the \\'plugins\\' option.');\n        }\n        return true;\n      } else {\n        return false;\n      }\n    };\n    var DetectProPlugin = { hasProPlugin: hasProPlugin };\n\n    var global$1 = tinymce.util.Tools.resolve('tinymce.util.Tools');\n\n    var global$2 = tinymce.util.Tools.resolve('tinymce.util.URI');\n\n    var global$3 = tinymce.util.Tools.resolve('tinymce.util.XHR');\n\n    var fireSpellcheckStart = function (editor) {\n      return editor.fire('SpellcheckStart');\n    };\n    var fireSpellcheckEnd = function (editor) {\n      return editor.fire('SpellcheckEnd');\n    };\n    var Events = {\n      fireSpellcheckStart: fireSpellcheckStart,\n      fireSpellcheckEnd: fireSpellcheckEnd\n    };\n\n    var getLanguages = function (editor) {\n      var defaultLanguages = 'English=en,Danish=da,Dutch=nl,Finnish=fi,French=fr_FR,German=de,Italian=it,Polish=pl,Portuguese=pt_BR,Spanish=es,Swedish=sv';\n      return editor.getParam('spellchecker_languages', defaultLanguages);\n    };\n    var getLanguage = function (editor) {\n      var defaultLanguage = editor.getParam('language', 'en');\n      return editor.getParam('spellchecker_language', defaultLanguage);\n    };\n    var getRpcUrl = function (editor) {\n      return editor.getParam('spellchecker_rpc_url');\n    };\n    var getSpellcheckerCallback = function (editor) {\n      return editor.getParam('spellchecker_callback');\n    };\n    var getSpellcheckerWordcharPattern = function (editor) {\n      var defaultPattern = new RegExp('[^' + '\\\\s!\"#$%&()*+,-./:;<=>?@[\\\\]^_{|}`' + '\\xA7\\xA9\\xAB\\xAE\\xB1\\xB6\\xB7\\xB8\\xBB' + '\\xBC\\xBD\\xBE\\xBF\\xD7\\xF7\\xA4\\u201D\\u201C\\u201E\\xA0\\u2002\\u2003\\u2009' + ']+', 'g');\n      return editor.getParam('spellchecker_wordchar_pattern', defaultPattern);\n    };\n    var Settings = {\n      getLanguages: getLanguages,\n      getLanguage: getLanguage,\n      getRpcUrl: getRpcUrl,\n      getSpellcheckerCallback: getSpellcheckerCallback,\n      getSpellcheckerWordcharPattern: getSpellcheckerWordcharPattern\n    };\n\n    function isContentEditableFalse(node) {\n      return node && node.nodeType === 1 && node.contentEditable === 'false';\n    }\n    var DomTextMatcher = function (node, editor) {\n      var m, matches = [], text;\n      var dom = editor.dom;\n      var blockElementsMap, hiddenTextElementsMap, shortEndedElementsMap;\n      blockElementsMap = editor.schema.getBlockElements();\n      hiddenTextElementsMap = editor.schema.getWhiteSpaceElements();\n      shortEndedElementsMap = editor.schema.getShortEndedElements();\n      function createMatch(m, data) {\n        if (!m[0]) {\n          throw new Error('findAndReplaceDOMText cannot handle zero-length matches');\n        }\n        return {\n          start: m.index,\n          end: m.index + m[0].length,\n          text: m[0],\n          data: data\n        };\n      }\n      function getText(node) {\n        var txt;\n        if (node.nodeType === 3) {\n          return node.data;\n        }\n        if (hiddenTextElementsMap[node.nodeName] && !blockElementsMap[node.nodeName]) {\n          return '';\n        }\n        if (isContentEditableFalse(node)) {\n          return '\\n';\n        }\n        txt = '';\n        if (blockElementsMap[node.nodeName] || shortEndedElementsMap[node.nodeName]) {\n          txt += '\\n';\n        }\n        if (node = node.firstChild) {\n          do {\n            txt += getText(node);\n          } while (node = node.nextSibling);\n        }\n        return txt;\n      }\n      function stepThroughMatches(node, matches, replaceFn) {\n        var startNode, endNode, startNodeIndex, endNodeIndex, innerNodes = [], atIndex = 0, curNode = node, matchLocation, matchIndex = 0;\n        matches = matches.slice(0);\n        matches.sort(function (a, b) {\n          return a.start - b.start;\n        });\n        matchLocation = matches.shift();\n        out:\n          while (true) {\n            if (blockElementsMap[curNode.nodeName] || shortEndedElementsMap[curNode.nodeName] || isContentEditableFalse(curNode)) {\n              atIndex++;\n            }\n            if (curNode.nodeType === 3) {\n              if (!endNode && curNode.length + atIndex >= matchLocation.end) {\n                endNode = curNode;\n                endNodeIndex = matchLocation.end - atIndex;\n              } else if (startNode) {\n                innerNodes.push(curNode);\n              }\n              if (!startNode && curNode.length + atIndex > matchLocation.start) {\n                startNode = curNode;\n                startNodeIndex = matchLocation.start - atIndex;\n              }\n              atIndex += curNode.length;\n            }\n            if (startNode && endNode) {\n              curNode = replaceFn({\n                startNode: startNode,\n                startNodeIndex: startNodeIndex,\n                endNode: endNode,\n                endNodeIndex: endNodeIndex,\n                innerNodes: innerNodes,\n                match: matchLocation.text,\n                matchIndex: matchIndex\n              });\n              atIndex -= endNode.length - endNodeIndex;\n              startNode = null;\n              endNode = null;\n              innerNodes = [];\n              matchLocation = matches.shift();\n              matchIndex++;\n              if (!matchLocation) {\n                break;\n              }\n            } else if ((!hiddenTextElementsMap[curNode.nodeName] || blockElementsMap[curNode.nodeName]) && curNode.firstChild) {\n              if (!isContentEditableFalse(curNode)) {\n                curNode = curNode.firstChild;\n                continue;\n              }\n            } else if (curNode.nextSibling) {\n              curNode = curNode.nextSibling;\n              continue;\n            }\n            while (true) {\n              if (curNode.nextSibling) {\n                curNode = curNode.nextSibling;\n                break;\n              } else if (curNode.parentNode !== node) {\n                curNode = curNode.parentNode;\n              } else {\n                break out;\n              }\n            }\n          }\n      }\n      function genReplacer(callback) {\n        function makeReplacementNode(fill, matchIndex) {\n          var match = matches[matchIndex];\n          if (!match.stencil) {\n            match.stencil = callback(match);\n          }\n          var clone = match.stencil.cloneNode(false);\n          clone.setAttribute('data-mce-index', matchIndex);\n          if (fill) {\n            clone.appendChild(dom.doc.createTextNode(fill));\n          }\n          return clone;\n        }\n        return function (range) {\n          var before;\n          var after;\n          var parentNode;\n          var startNode = range.startNode;\n          var endNode = range.endNode;\n          var matchIndex = range.matchIndex;\n          var doc = dom.doc;\n          if (startNode === endNode) {\n            var node_1 = startNode;\n            parentNode = node_1.parentNode;\n            if (range.startNodeIndex > 0) {\n              before = doc.createTextNode(node_1.data.substring(0, range.startNodeIndex));\n              parentNode.insertBefore(before, node_1);\n            }\n            var el = makeReplacementNode(range.match, matchIndex);\n            parentNode.insertBefore(el, node_1);\n            if (range.endNodeIndex < node_1.length) {\n              after = doc.createTextNode(node_1.data.substring(range.endNodeIndex));\n              parentNode.insertBefore(after, node_1);\n            }\n            node_1.parentNode.removeChild(node_1);\n            return el;\n          }\n          before = doc.createTextNode(startNode.data.substring(0, range.startNodeIndex));\n          after = doc.createTextNode(endNode.data.substring(range.endNodeIndex));\n          var elA = makeReplacementNode(startNode.data.substring(range.startNodeIndex), matchIndex);\n          for (var i = 0, l = range.innerNodes.length; i < l; ++i) {\n            var innerNode = range.innerNodes[i];\n            var innerEl = makeReplacementNode(innerNode.data, matchIndex);\n            innerNode.parentNode.replaceChild(innerEl, innerNode);\n          }\n          var elB = makeReplacementNode(endNode.data.substring(0, range.endNodeIndex), matchIndex);\n          parentNode = startNode.parentNode;\n          parentNode.insertBefore(before, startNode);\n          parentNode.insertBefore(elA, startNode);\n          parentNode.removeChild(startNode);\n          parentNode = endNode.parentNode;\n          parentNode.insertBefore(elB, endNode);\n          parentNode.insertBefore(after, endNode);\n          parentNode.removeChild(endNode);\n          return elB;\n        };\n      }\n      function unwrapElement(element) {\n        var parentNode = element.parentNode;\n        parentNode.insertBefore(element.firstChild, element);\n        element.parentNode.removeChild(element);\n      }\n      function hasClass(elm) {\n        return elm.className.indexOf('mce-spellchecker-word') !== -1;\n      }\n      function getWrappersByIndex(index) {\n        var elements = node.getElementsByTagName('*'), wrappers = [];\n        index = typeof index === 'number' ? '' + index : null;\n        for (var i = 0; i < elements.length; i++) {\n          var element = elements[i], dataIndex = element.getAttribute('data-mce-index');\n          if (dataIndex !== null && dataIndex.length && hasClass(element)) {\n            if (dataIndex === index || index === null) {\n              wrappers.push(element);\n            }\n          }\n        }\n        return wrappers;\n      }\n      function indexOf(match) {\n        var i = matches.length;\n        while (i--) {\n          if (matches[i] === match) {\n            return i;\n          }\n        }\n        return -1;\n      }\n      function filter(callback) {\n        var filteredMatches = [];\n        each(function (match, i) {\n          if (callback(match, i)) {\n            filteredMatches.push(match);\n          }\n        });\n        matches = filteredMatches;\n        return this;\n      }\n      function each(callback) {\n        for (var i = 0, l = matches.length; i < l; i++) {\n          if (callback(matches[i], i) === false) {\n            break;\n          }\n        }\n        return this;\n      }\n      function wrap(callback) {\n        if (matches.length) {\n          stepThroughMatches(node, matches, genReplacer(callback));\n        }\n        return this;\n      }\n      function find(regex, data) {\n        if (text && regex.global) {\n          while (m = regex.exec(text)) {\n            matches.push(createMatch(m, data));\n          }\n        }\n        return this;\n      }\n      function unwrap(match) {\n        var i;\n        var elements = getWrappersByIndex(match ? indexOf(match) : null);\n        i = elements.length;\n        while (i--) {\n          unwrapElement(elements[i]);\n        }\n        return this;\n      }\n      function matchFromElement(element) {\n        return matches[element.getAttribute('data-mce-index')];\n      }\n      function elementFromMatch(match) {\n        return getWrappersByIndex(indexOf(match))[0];\n      }\n      function add(start, length, data) {\n        matches.push({\n          start: start,\n          end: start + length,\n          text: text.substr(start, length),\n          data: data\n        });\n        return this;\n      }\n      function rangeFromMatch(match) {\n        var wrappers = getWrappersByIndex(indexOf(match));\n        var rng = editor.dom.createRng();\n        rng.setStartBefore(wrappers[0]);\n        rng.setEndAfter(wrappers[wrappers.length - 1]);\n        return rng;\n      }\n      function replace(match, text) {\n        var rng = rangeFromMatch(match);\n        rng.deleteContents();\n        if (text.length > 0) {\n          rng.insertNode(editor.dom.doc.createTextNode(text));\n        }\n        return rng;\n      }\n      function reset() {\n        matches.splice(0, matches.length);\n        unwrap();\n        return this;\n      }\n      text = getText(node);\n      return {\n        text: text,\n        matches: matches,\n        each: each,\n        filter: filter,\n        reset: reset,\n        matchFromElement: matchFromElement,\n        elementFromMatch: elementFromMatch,\n        find: find,\n        add: add,\n        wrap: wrap,\n        unwrap: unwrap,\n        replace: replace,\n        rangeFromMatch: rangeFromMatch,\n        indexOf: indexOf\n      };\n    };\n\n    var getTextMatcher = function (editor, textMatcherState) {\n      if (!textMatcherState.get()) {\n        var textMatcher = DomTextMatcher(editor.getBody(), editor);\n        textMatcherState.set(textMatcher);\n      }\n      return textMatcherState.get();\n    };\n    var isEmpty = function (obj) {\n      for (var _ in obj) {\n        return false;\n      }\n      return true;\n    };\n    var defaultSpellcheckCallback = function (editor, pluginUrl, currentLanguageState) {\n      return function (method, text, doneCallback, errorCallback) {\n        var data = {\n          method: method,\n          lang: currentLanguageState.get()\n        };\n        var postData = '';\n        data[method === 'addToDictionary' ? 'word' : 'text'] = text;\n        global$1.each(data, function (value, key) {\n          if (postData) {\n            postData += '&';\n          }\n          postData += key + '=' + encodeURIComponent(value);\n        });\n        global$3.send({\n          url: new global$2(pluginUrl).toAbsolute(Settings.getRpcUrl(editor)),\n          type: 'post',\n          content_type: 'application/x-www-form-urlencoded',\n          data: postData,\n          success: function (result) {\n            var parseResult = JSON.parse(result);\n            if (!parseResult) {\n              var message = editor.translate('Server response wasn\\'t proper JSON.');\n              errorCallback(message);\n            } else if (parseResult.error) {\n              errorCallback(parseResult.error);\n            } else {\n              doneCallback(parseResult);\n            }\n          },\n          error: function () {\n            var message = editor.translate('The spelling service was not found: (') + Settings.getRpcUrl(editor) + editor.translate(')');\n            errorCallback(message);\n          }\n        });\n      };\n    };\n    var sendRpcCall = function (editor, pluginUrl, currentLanguageState, name, data, successCallback, errorCallback) {\n      var userSpellcheckCallback = Settings.getSpellcheckerCallback(editor);\n      var spellCheckCallback = userSpellcheckCallback ? userSpellcheckCallback : defaultSpellcheckCallback(editor, pluginUrl, currentLanguageState);\n      spellCheckCallback.call(editor.plugins.spellchecker, name, data, successCallback, errorCallback);\n    };\n    var spellcheck = function (editor, pluginUrl, startedState, textMatcherState, lastSuggestionsState, currentLanguageState) {\n      if (finish(editor, startedState, textMatcherState)) {\n        return;\n      }\n      var errorCallback = function (message) {\n        editor.notificationManager.open({\n          text: message,\n          type: 'error'\n        });\n        editor.setProgressState(false);\n        finish(editor, startedState, textMatcherState);\n      };\n      var successCallback = function (data) {\n        markErrors(editor, startedState, textMatcherState, lastSuggestionsState, data);\n      };\n      editor.setProgressState(true);\n      sendRpcCall(editor, pluginUrl, currentLanguageState, 'spellcheck', getTextMatcher(editor, textMatcherState).text, successCallback, errorCallback);\n      editor.focus();\n    };\n    var checkIfFinished = function (editor, startedState, textMatcherState) {\n      if (!editor.dom.select('span.mce-spellchecker-word').length) {\n        finish(editor, startedState, textMatcherState);\n      }\n    };\n    var addToDictionary = function (editor, pluginUrl, startedState, textMatcherState, currentLanguageState, word, spans) {\n      editor.setProgressState(true);\n      sendRpcCall(editor, pluginUrl, currentLanguageState, 'addToDictionary', word, function () {\n        editor.setProgressState(false);\n        editor.dom.remove(spans, true);\n        checkIfFinished(editor, startedState, textMatcherState);\n      }, function (message) {\n        editor.notificationManager.open({\n          text: message,\n          type: 'error'\n        });\n        editor.setProgressState(false);\n      });\n    };\n    var ignoreWord = function (editor, startedState, textMatcherState, word, spans, all) {\n      editor.selection.collapse();\n      if (all) {\n        global$1.each(editor.dom.select('span.mce-spellchecker-word'), function (span) {\n          if (span.getAttribute('data-mce-word') === word) {\n            editor.dom.remove(span, true);\n          }\n        });\n      } else {\n        editor.dom.remove(spans, true);\n      }\n      checkIfFinished(editor, startedState, textMatcherState);\n    };\n    var finish = function (editor, startedState, textMatcherState) {\n      var bookmark = editor.selection.getBookmark();\n      getTextMatcher(editor, textMatcherState).reset();\n      editor.selection.moveToBookmark(bookmark);\n      textMatcherState.set(null);\n      if (startedState.get()) {\n        startedState.set(false);\n        Events.fireSpellcheckEnd(editor);\n        return true;\n      }\n    };\n    var getElmIndex = function (elm) {\n      var value = elm.getAttribute('data-mce-index');\n      if (typeof value === 'number') {\n        return '' + value;\n      }\n      return value;\n    };\n    var findSpansByIndex = function (editor, index) {\n      var nodes;\n      var spans = [];\n      nodes = global$1.toArray(editor.getBody().getElementsByTagName('span'));\n      if (nodes.length) {\n        for (var i = 0; i < nodes.length; i++) {\n          var nodeIndex = getElmIndex(nodes[i]);\n          if (nodeIndex === null || !nodeIndex.length) {\n            continue;\n          }\n          if (nodeIndex === index.toString()) {\n            spans.push(nodes[i]);\n          }\n        }\n      }\n      return spans;\n    };\n    var markErrors = function (editor, startedState, textMatcherState, lastSuggestionsState, data) {\n      var hasDictionarySupport = !!data.dictionary;\n      var suggestions = data.words;\n      editor.setProgressState(false);\n      if (isEmpty(suggestions)) {\n        var message = editor.translate('No misspellings found.');\n        editor.notificationManager.open({\n          text: message,\n          type: 'info'\n        });\n        startedState.set(false);\n        return;\n      }\n      lastSuggestionsState.set({\n        suggestions: suggestions,\n        hasDictionarySupport: hasDictionarySupport\n      });\n      var bookmark = editor.selection.getBookmark();\n      getTextMatcher(editor, textMatcherState).find(Settings.getSpellcheckerWordcharPattern(editor)).filter(function (match) {\n        return !!suggestions[match.text];\n      }).wrap(function (match) {\n        return editor.dom.create('span', {\n          'class': 'mce-spellchecker-word',\n          'aria-invalid': 'spelling',\n          'data-mce-bogus': 1,\n          'data-mce-word': match.text\n        });\n      });\n      editor.selection.moveToBookmark(bookmark);\n      startedState.set(true);\n      Events.fireSpellcheckStart(editor);\n    };\n    var Actions = {\n      spellcheck: spellcheck,\n      checkIfFinished: checkIfFinished,\n      addToDictionary: addToDictionary,\n      ignoreWord: ignoreWord,\n      findSpansByIndex: findSpansByIndex,\n      getElmIndex: getElmIndex,\n      markErrors: markErrors\n    };\n\n    var get = function (editor, startedState, lastSuggestionsState, textMatcherState, currentLanguageState, url) {\n      var getLanguage = function () {\n        return currentLanguageState.get();\n      };\n      var getWordCharPattern = function () {\n        return Settings.getSpellcheckerWordcharPattern(editor);\n      };\n      var markErrors = function (data) {\n        Actions.markErrors(editor, startedState, textMatcherState, lastSuggestionsState, data);\n      };\n      var getTextMatcher = function () {\n        return textMatcherState.get();\n      };\n      return {\n        getTextMatcher: getTextMatcher,\n        getWordCharPattern: getWordCharPattern,\n        markErrors: markErrors,\n        getLanguage: getLanguage\n      };\n    };\n    var Api = { get: get };\n\n    var register = function (editor, pluginUrl, startedState, textMatcherState, lastSuggestionsState, currentLanguageState) {\n      editor.addCommand('mceSpellCheck', function () {\n        Actions.spellcheck(editor, pluginUrl, startedState, textMatcherState, lastSuggestionsState, currentLanguageState);\n      });\n    };\n    var Commands = { register: register };\n\n    var __assign = function () {\n      __assign = Object.assign || function __assign(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s)\n            if (Object.prototype.hasOwnProperty.call(s, p))\n              t[p] = s[p];\n        }\n        return t;\n      };\n      return __assign.apply(this, arguments);\n    };\n\n    var spellcheckerEvents = 'SpellcheckStart SpellcheckEnd';\n    var buildMenuItems = function (listName, languageValues) {\n      var items = [];\n      global$1.each(languageValues, function (languageValue) {\n        items.push({\n          selectable: true,\n          text: languageValue.name,\n          data: languageValue.value\n        });\n      });\n      return items;\n    };\n    var getItems = function (editor) {\n      return global$1.map(Settings.getLanguages(editor).split(','), function (langPair) {\n        langPair = langPair.split('=');\n        return {\n          name: langPair[0],\n          value: langPair[1]\n        };\n      });\n    };\n    var register$1 = function (editor, pluginUrl, startedState, textMatcherState, currentLanguageState, lastSuggestionsState) {\n      var languageMenuItems = buildMenuItems('Language', getItems(editor));\n      var startSpellchecking = function () {\n        Actions.spellcheck(editor, pluginUrl, startedState, textMatcherState, lastSuggestionsState, currentLanguageState);\n      };\n      var buttonArgs = {\n        tooltip: 'Spellcheck',\n        onAction: startSpellchecking,\n        icon: 'spell-check',\n        onSetup: function (buttonApi) {\n          var setButtonState = function () {\n            buttonApi.setActive(startedState.get());\n          };\n          editor.on(spellcheckerEvents, setButtonState);\n          return function () {\n            editor.off(spellcheckerEvents, setButtonState);\n          };\n        }\n      };\n      var splitButtonArgs = __assign(__assign({}, buttonArgs), {\n        type: 'splitbutton',\n        select: function (value) {\n          return value === currentLanguageState.get();\n        },\n        fetch: function (callback) {\n          var items = global$1.map(languageMenuItems, function (languageItem) {\n            return {\n              type: 'choiceitem',\n              value: languageItem.data,\n              text: languageItem.text\n            };\n          });\n          callback(items);\n        },\n        onItemAction: function (splitButtonApi, value) {\n          currentLanguageState.set(value);\n        }\n      });\n      if (languageMenuItems.length > 1) {\n        editor.ui.registry.addSplitButton('spellchecker', splitButtonArgs);\n      } else {\n        editor.ui.registry.addToggleButton('spellchecker', buttonArgs);\n      }\n      editor.ui.registry.addToggleMenuItem('spellchecker', {\n        text: 'Spellcheck',\n        onSetup: function (menuApi) {\n          menuApi.setActive(startedState.get());\n          var setMenuItemCheck = function () {\n            menuApi.setActive(startedState.get());\n          };\n          editor.on(spellcheckerEvents, setMenuItemCheck);\n          return function () {\n            editor.off(spellcheckerEvents, setMenuItemCheck);\n          };\n        },\n        onAction: startSpellchecking\n      });\n    };\n    var Buttons = { register: register$1 };\n\n    var ignoreAll = true;\n    var getSuggestions = function (editor, pluginUrl, lastSuggestionsState, startedState, textMatcherState, currentLanguageState, word, spans) {\n      var items = [];\n      var suggestions = lastSuggestionsState.get().suggestions[word];\n      global$1.each(suggestions, function (suggestion) {\n        items.push({\n          text: suggestion,\n          onAction: function () {\n            editor.insertContent(editor.dom.encode(suggestion));\n            editor.dom.remove(spans);\n            Actions.checkIfFinished(editor, startedState, textMatcherState);\n          }\n        });\n      });\n      var hasDictionarySupport = lastSuggestionsState.get().hasDictionarySupport;\n      if (hasDictionarySupport) {\n        items.push({ type: 'separator' });\n        items.push({\n          text: 'Add to dictionary',\n          onAction: function () {\n            Actions.addToDictionary(editor, pluginUrl, startedState, textMatcherState, currentLanguageState, word, spans);\n          }\n        });\n      }\n      items.push.apply(items, [\n        { type: 'separator' },\n        {\n          text: 'Ignore',\n          onAction: function () {\n            Actions.ignoreWord(editor, startedState, textMatcherState, word, spans);\n          }\n        },\n        {\n          text: 'Ignore all',\n          onAction: function () {\n            Actions.ignoreWord(editor, startedState, textMatcherState, word, spans, ignoreAll);\n          }\n        }\n      ]);\n      return items;\n    };\n    var setup = function (editor, pluginUrl, lastSuggestionsState, startedState, textMatcherState, currentLanguageState) {\n      var update = function (element) {\n        var target = element;\n        if (target.className === 'mce-spellchecker-word') {\n          var spans = Actions.findSpansByIndex(editor, Actions.getElmIndex(target));\n          if (spans.length > 0) {\n            var rng = editor.dom.createRng();\n            rng.setStartBefore(spans[0]);\n            rng.setEndAfter(spans[spans.length - 1]);\n            editor.selection.setRng(rng);\n            return getSuggestions(editor, pluginUrl, lastSuggestionsState, startedState, textMatcherState, currentLanguageState, target.getAttribute('data-mce-word'), spans);\n          }\n        } else {\n          return [];\n        }\n      };\n      editor.ui.registry.addContextMenu('spellchecker', { update: update });\n    };\n    var SuggestionsMenu = { setup: setup };\n\n    function Plugin () {\n      global.add('spellchecker', function (editor, pluginUrl) {\n        if (DetectProPlugin.hasProPlugin(editor) === false) {\n          var startedState = Cell(false);\n          var currentLanguageState = Cell(Settings.getLanguage(editor));\n          var textMatcherState = Cell(null);\n          var lastSuggestionsState = Cell(null);\n          Buttons.register(editor, pluginUrl, startedState, textMatcherState, currentLanguageState, lastSuggestionsState);\n          SuggestionsMenu.setup(editor, pluginUrl, lastSuggestionsState, startedState, textMatcherState, currentLanguageState);\n          Commands.register(editor, pluginUrl, startedState, textMatcherState, lastSuggestionsState, currentLanguageState);\n          return Api.get(editor, startedState, lastSuggestionsState, textMatcherState, currentLanguageState, pluginUrl);\n        }\n      });\n    }\n\n    Plugin();\n\n}(window));\n"]}