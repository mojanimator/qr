{"version":3,"sources":["../../../../../public/js/plugins/autolink/plugin.js"],"names":["global","tinymce","util","Tools","resolve","global$1","getAutoLinkPattern","editor","getParam","getDefaultLinkTarget","Settings","rangeEqualsDelimiterOrSpace","rangeString","delimiter","charCodeAt","handleEclipse","parseCurrentLine","handleSpacebar","handleEnter","scopeIndex","container","index","nodeType","len","data","length","setStart","rng","offset","hasChildNodes","setStartBefore","setEnd","setEndAfter","endOffset","end","start","endContainer","bookmark","text","matches","prev","rngText","autoLinkPattern","defaultLinkTarget","selection","getNode","tagName","getRng","cloneRange","startOffset","previousSibling","firstChild","nextSibling","nodeValue","toString","charAt","trim","match","test","getBookmark","setRng","execCommand","dom","setAttrib","moveToBookmark","nodeChanged","setup","autoUrlDetectState","on","e","keyCode","browser","isIE","ex","Keys","Plugin","add"],"mappings":"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","file":"plugin.js","sourcesContent":["/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.1.0 (2019-10-17)\n */\n(function () {\n    'use strict';\n\n    var global = tinymce.util.Tools.resolve('tinymce.PluginManager');\n\n    var global$1 = tinymce.util.Tools.resolve('tinymce.Env');\n\n    var getAutoLinkPattern = function (editor) {\n      return editor.getParam('autolink_pattern', /^(https?:\\/\\/|ssh:\\/\\/|ftp:\\/\\/|file:\\/|www\\.|(?:mailto:)?[A-Z0-9._%+\\-]+@)(.+)$/i);\n    };\n    var getDefaultLinkTarget = function (editor) {\n      return editor.getParam('default_link_target', false);\n    };\n    var Settings = {\n      getAutoLinkPattern: getAutoLinkPattern,\n      getDefaultLinkTarget: getDefaultLinkTarget\n    };\n\n    var rangeEqualsDelimiterOrSpace = function (rangeString, delimiter) {\n      return rangeString === delimiter || rangeString === ' ' || rangeString.charCodeAt(0) === 160;\n    };\n    var handleEclipse = function (editor) {\n      parseCurrentLine(editor, -1, '(');\n    };\n    var handleSpacebar = function (editor) {\n      parseCurrentLine(editor, 0, '');\n    };\n    var handleEnter = function (editor) {\n      parseCurrentLine(editor, -1, '');\n    };\n    var scopeIndex = function (container, index) {\n      if (index < 0) {\n        index = 0;\n      }\n      if (container.nodeType === 3) {\n        var len = container.data.length;\n        if (index > len) {\n          index = len;\n        }\n      }\n      return index;\n    };\n    var setStart = function (rng, container, offset) {\n      if (container.nodeType !== 1 || container.hasChildNodes()) {\n        rng.setStart(container, scopeIndex(container, offset));\n      } else {\n        rng.setStartBefore(container);\n      }\n    };\n    var setEnd = function (rng, container, offset) {\n      if (container.nodeType !== 1 || container.hasChildNodes()) {\n        rng.setEnd(container, scopeIndex(container, offset));\n      } else {\n        rng.setEndAfter(container);\n      }\n    };\n    var parseCurrentLine = function (editor, endOffset, delimiter) {\n      var rng, end, start, endContainer, bookmark, text, matches, prev, len, rngText;\n      var autoLinkPattern = Settings.getAutoLinkPattern(editor);\n      var defaultLinkTarget = Settings.getDefaultLinkTarget(editor);\n      if (editor.selection.getNode().tagName === 'A') {\n        return;\n      }\n      rng = editor.selection.getRng(true).cloneRange();\n      if (rng.startOffset < 5) {\n        prev = rng.endContainer.previousSibling;\n        if (!prev) {\n          if (!rng.endContainer.firstChild || !rng.endContainer.firstChild.nextSibling) {\n            return;\n          }\n          prev = rng.endContainer.firstChild.nextSibling;\n        }\n        len = prev.length;\n        setStart(rng, prev, len);\n        setEnd(rng, prev, len);\n        if (rng.endOffset < 5) {\n          return;\n        }\n        end = rng.endOffset;\n        endContainer = prev;\n      } else {\n        endContainer = rng.endContainer;\n        if (endContainer.nodeType !== 3 && endContainer.firstChild) {\n          while (endContainer.nodeType !== 3 && endContainer.firstChild) {\n            endContainer = endContainer.firstChild;\n          }\n          if (endContainer.nodeType === 3) {\n            setStart(rng, endContainer, 0);\n            setEnd(rng, endContainer, endContainer.nodeValue.length);\n          }\n        }\n        if (rng.endOffset === 1) {\n          end = 2;\n        } else {\n          end = rng.endOffset - 1 - endOffset;\n        }\n      }\n      start = end;\n      do {\n        setStart(rng, endContainer, end >= 2 ? end - 2 : 0);\n        setEnd(rng, endContainer, end >= 1 ? end - 1 : 0);\n        end -= 1;\n        rngText = rng.toString();\n      } while (rngText !== ' ' && rngText !== '' && rngText.charCodeAt(0) !== 160 && end - 2 >= 0 && rngText !== delimiter);\n      if (rangeEqualsDelimiterOrSpace(rng.toString(), delimiter)) {\n        setStart(rng, endContainer, end);\n        setEnd(rng, endContainer, start);\n        end += 1;\n      } else if (rng.startOffset === 0) {\n        setStart(rng, endContainer, 0);\n        setEnd(rng, endContainer, start);\n      } else {\n        setStart(rng, endContainer, end);\n        setEnd(rng, endContainer, start);\n      }\n      text = rng.toString();\n      if (text.charAt(text.length - 1) === '.') {\n        setEnd(rng, endContainer, start - 1);\n      }\n      text = rng.toString().trim();\n      matches = text.match(autoLinkPattern);\n      if (matches) {\n        if (matches[1] === 'www.') {\n          matches[1] = 'http://www.';\n        } else if (/@$/.test(matches[1]) && !/^mailto:/.test(matches[1])) {\n          matches[1] = 'mailto:' + matches[1];\n        }\n        bookmark = editor.selection.getBookmark();\n        editor.selection.setRng(rng);\n        editor.execCommand('createlink', false, matches[1] + matches[2]);\n        if (defaultLinkTarget !== false) {\n          editor.dom.setAttrib(editor.selection.getNode(), 'target', defaultLinkTarget);\n        }\n        editor.selection.moveToBookmark(bookmark);\n        editor.nodeChanged();\n      }\n    };\n    var setup = function (editor) {\n      var autoUrlDetectState;\n      editor.on('keydown', function (e) {\n        if (e.keyCode === 13) {\n          return handleEnter(editor);\n        }\n      });\n      if (global$1.browser.isIE()) {\n        editor.on('focus', function () {\n          if (!autoUrlDetectState) {\n            autoUrlDetectState = true;\n            try {\n              editor.execCommand('AutoUrlDetect', false, true);\n            } catch (ex) {\n            }\n          }\n        });\n        return;\n      }\n      editor.on('keypress', function (e) {\n        if (e.keyCode === 41) {\n          return handleEclipse(editor);\n        }\n      });\n      editor.on('keyup', function (e) {\n        if (e.keyCode === 32) {\n          return handleSpacebar(editor);\n        }\n      });\n    };\n    var Keys = { setup: setup };\n\n    function Plugin () {\n      global.add('autolink', function (editor) {\n        Keys.setup(editor);\n      });\n    }\n\n    Plugin();\n\n}());\n"]}