{"version":3,"sources":["../../../../../public/js/plugins/autosave/plugin.js"],"names":["domGlobals","Cell","initial","value","get","set","v","clone","global","tinymce","util","Tools","resolve","global$1","global$2","global$3","fireRestoreDraft","editor","fire","fireStoreDraft","fireRemoveDraft","parse","timeString","defaultTime","multiples","s","m","toParse","parsedTime","exec","parseInt","shouldAskBeforeUnload","getParam","getAutoSavePrefix","prefix","replace","document","location","pathname","search","hash","id","shouldRestoreWhenEmpty","getAutoSaveInterval","settings","autosave_interval","getAutoSaveRetention","autosave_retention","isEmpty","html","forcedRootBlockName","forced_root_block","trim","getBody","innerHTML","RegExp","test","hasDraft","time","getItem","Date","getTime","removeDraft","removeItem","storeDraft","isDirty","setItem","getContent","format","no_events","toString","restoreDraft","setContent","startStoreDraft","started","interval","setInterval","removed","restoreLastDraft","undoManager","transact","focus","curry","fn","initialArgs","_i","arguments","length","restArgs","all","concat","apply","global$4","setup","editorManager","on","e","msg","each","plugins","autosave","translate","preventDefault","returnValue","makeSetupHandler","api","setDisabled","editorEventCallback","off","register","ui","registry","addButton","tooltip","icon","onAction","onSetup","addMenuItem","text","Plugin","add","dom","window"],"mappings":"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","file":"plugin.js","sourcesContent":["/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.1.0 (2019-10-17)\n */\n(function (domGlobals) {\n    'use strict';\n\n    var Cell = function (initial) {\n      var value = initial;\n      var get = function () {\n        return value;\n      };\n      var set = function (v) {\n        value = v;\n      };\n      var clone = function () {\n        return Cell(get());\n      };\n      return {\n        get: get,\n        set: set,\n        clone: clone\n      };\n    };\n\n    var global = tinymce.util.Tools.resolve('tinymce.PluginManager');\n\n    var global$1 = tinymce.util.Tools.resolve('tinymce.util.Delay');\n\n    var global$2 = tinymce.util.Tools.resolve('tinymce.util.LocalStorage');\n\n    var global$3 = tinymce.util.Tools.resolve('tinymce.util.Tools');\n\n    var fireRestoreDraft = function (editor) {\n      return editor.fire('RestoreDraft');\n    };\n    var fireStoreDraft = function (editor) {\n      return editor.fire('StoreDraft');\n    };\n    var fireRemoveDraft = function (editor) {\n      return editor.fire('RemoveDraft');\n    };\n\n    var parse = function (timeString, defaultTime) {\n      var multiples = {\n        s: 1000,\n        m: 60000\n      };\n      var toParse = timeString || defaultTime;\n      var parsedTime = /^(\\d+)([ms]?)$/.exec('' + toParse);\n      return (parsedTime[2] ? multiples[parsedTime[2]] : 1) * parseInt(toParse, 10);\n    };\n\n    var shouldAskBeforeUnload = function (editor) {\n      return editor.getParam('autosave_ask_before_unload', true);\n    };\n    var getAutoSavePrefix = function (editor) {\n      var prefix = editor.getParam('autosave_prefix', 'tinymce-autosave-{path}{query}{hash}-{id}-');\n      prefix = prefix.replace(/\\{path\\}/g, domGlobals.document.location.pathname);\n      prefix = prefix.replace(/\\{query\\}/g, domGlobals.document.location.search);\n      prefix = prefix.replace(/\\{hash\\}/g, domGlobals.document.location.hash);\n      prefix = prefix.replace(/\\{id\\}/g, editor.id);\n      return prefix;\n    };\n    var shouldRestoreWhenEmpty = function (editor) {\n      return editor.getParam('autosave_restore_when_empty', false);\n    };\n    var getAutoSaveInterval = function (editor) {\n      return parse(editor.settings.autosave_interval, '30s');\n    };\n    var getAutoSaveRetention = function (editor) {\n      return parse(editor.settings.autosave_retention, '20m');\n    };\n\n    var isEmpty = function (editor, html) {\n      var forcedRootBlockName = editor.settings.forced_root_block;\n      html = global$3.trim(typeof html === 'undefined' ? editor.getBody().innerHTML : html);\n      return html === '' || new RegExp('^<' + forcedRootBlockName + '[^>]*>((\\xA0|&nbsp;|[ \\t]|<br[^>]*>)+?|)</' + forcedRootBlockName + '>|<br>$', 'i').test(html);\n    };\n    var hasDraft = function (editor) {\n      var time = parseInt(global$2.getItem(getAutoSavePrefix(editor) + 'time'), 10) || 0;\n      if (new Date().getTime() - time > getAutoSaveRetention(editor)) {\n        removeDraft(editor, false);\n        return false;\n      }\n      return true;\n    };\n    var removeDraft = function (editor, fire) {\n      var prefix = getAutoSavePrefix(editor);\n      global$2.removeItem(prefix + 'draft');\n      global$2.removeItem(prefix + 'time');\n      if (fire !== false) {\n        fireRemoveDraft(editor);\n      }\n    };\n    var storeDraft = function (editor) {\n      var prefix = getAutoSavePrefix(editor);\n      if (!isEmpty(editor) && editor.isDirty()) {\n        global$2.setItem(prefix + 'draft', editor.getContent({\n          format: 'raw',\n          no_events: true\n        }));\n        global$2.setItem(prefix + 'time', new Date().getTime().toString());\n        fireStoreDraft(editor);\n      }\n    };\n    var restoreDraft = function (editor) {\n      var prefix = getAutoSavePrefix(editor);\n      if (hasDraft(editor)) {\n        editor.setContent(global$2.getItem(prefix + 'draft'), { format: 'raw' });\n        fireRestoreDraft(editor);\n      }\n    };\n    var startStoreDraft = function (editor, started) {\n      var interval = getAutoSaveInterval(editor);\n      if (!started.get()) {\n        global$1.setInterval(function () {\n          if (!editor.removed) {\n            storeDraft(editor);\n          }\n        }, interval);\n        started.set(true);\n      }\n    };\n    var restoreLastDraft = function (editor) {\n      editor.undoManager.transact(function () {\n        restoreDraft(editor);\n        removeDraft(editor);\n      });\n      editor.focus();\n    };\n\n    function curry(fn) {\n      var initialArgs = [];\n      for (var _i = 1; _i < arguments.length; _i++) {\n        initialArgs[_i - 1] = arguments[_i];\n      }\n      return function () {\n        var restArgs = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          restArgs[_i] = arguments[_i];\n        }\n        var all = initialArgs.concat(restArgs);\n        return fn.apply(null, all);\n      };\n    }\n\n    var get = function (editor) {\n      return {\n        hasDraft: curry(hasDraft, editor),\n        storeDraft: curry(storeDraft, editor),\n        restoreDraft: curry(restoreDraft, editor),\n        removeDraft: curry(removeDraft, editor),\n        isEmpty: curry(isEmpty, editor)\n      };\n    };\n\n    var global$4 = tinymce.util.Tools.resolve('tinymce.EditorManager');\n\n    var setup = function (editor) {\n      editor.editorManager.on('BeforeUnload', function (e) {\n        var msg;\n        global$3.each(global$4.get(), function (editor) {\n          if (editor.plugins.autosave) {\n            editor.plugins.autosave.storeDraft();\n          }\n          if (!msg && editor.isDirty() && shouldAskBeforeUnload(editor)) {\n            msg = editor.translate('You have unsaved changes are you sure you want to navigate away?');\n          }\n        });\n        if (msg) {\n          e.preventDefault();\n          e.returnValue = msg;\n        }\n      });\n    };\n\n    var makeSetupHandler = function (editor, started) {\n      return function (api) {\n        api.setDisabled(!hasDraft(editor));\n        var editorEventCallback = function () {\n          return api.setDisabled(!hasDraft(editor));\n        };\n        editor.on('StoreDraft RestoreDraft RemoveDraft', editorEventCallback);\n        return function () {\n          return editor.off('StoreDraft RestoreDraft RemoveDraft', editorEventCallback);\n        };\n      };\n    };\n    var register = function (editor, started) {\n      startStoreDraft(editor, started);\n      editor.ui.registry.addButton('restoredraft', {\n        tooltip: 'Restore last draft',\n        icon: 'restore-draft',\n        onAction: function () {\n          restoreLastDraft(editor);\n        },\n        onSetup: makeSetupHandler(editor)\n      });\n      editor.ui.registry.addMenuItem('restoredraft', {\n        text: 'Restore last draft',\n        icon: 'restore-draft',\n        onAction: function () {\n          restoreLastDraft(editor);\n        },\n        onSetup: makeSetupHandler(editor)\n      });\n    };\n\n    function Plugin () {\n      global.add('autosave', function (editor) {\n        var started = Cell(false);\n        setup(editor);\n        register(editor, started);\n        editor.on('init', function () {\n          if (shouldRestoreWhenEmpty(editor) && editor.dom.isEmpty(editor.getBody())) {\n            restoreDraft(editor);\n          }\n        });\n        return get(editor);\n      });\n    }\n\n    Plugin();\n\n}(window));\n"]}