{"version":3,"sources":["../../../../../public/js/plugins/toc/plugin.js"],"names":["global","tinymce","util","Tools","resolve","global$1","global$2","global$3","getTocClass","editor","getParam","getTocHeader","tagName","test","getTocDepth","depth","parseInt","Settings","create","prefix","counter","guid","Date","getTime","toString","Guid","tocId","generateSelector","i","selector","push","join","hasHeaders","readHeaders","length","tocClass","headerTag","headers","$","filter","el","dom","hasClass","parentNode","map","h","id","level","nodeName","replace","title","text","element","getMinLevel","minLevel","generateTitle","tag","openTag","closeTag","DOM","encode","generateTocHtml","html","generateTocContentHtml","prevLevel","ii","nextLevel","translate","isEmptyOrOffscren","nodes","getParents","insertToc","$tocElm","insertContent","updateToc","undoManager","transact","Toc","register","addCommand","Commands","setup","on","e","node","removeAttr","find","attr","children","FilterContent","toggleState","api","toggleDisabledState","setDisabled","readonly","isToc","elm","is","getBody","contains","register$1","ui","registry","addButton","icon","tooltip","onAction","execCommand","onSetup","addMenuItem","addContextToolbar","items","predicate","scope","position","Buttons","Plugin","add"],"mappings":"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","file":"plugin.js","sourcesContent":["/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.1.0 (2019-10-17)\n */\n(function () {\n    'use strict';\n\n    var global = tinymce.util.Tools.resolve('tinymce.PluginManager');\n\n    var global$1 = tinymce.util.Tools.resolve('tinymce.dom.DOMUtils');\n\n    var global$2 = tinymce.util.Tools.resolve('tinymce.util.I18n');\n\n    var global$3 = tinymce.util.Tools.resolve('tinymce.util.Tools');\n\n    var getTocClass = function (editor) {\n      return editor.getParam('toc_class', 'mce-toc');\n    };\n    var getTocHeader = function (editor) {\n      var tagName = editor.getParam('toc_header', 'h2');\n      return /^h[1-6]$/.test(tagName) ? tagName : 'h2';\n    };\n    var getTocDepth = function (editor) {\n      var depth = parseInt(editor.getParam('toc_depth', '3'), 10);\n      return depth >= 1 && depth <= 9 ? depth : 3;\n    };\n    var Settings = {\n      getTocClass: getTocClass,\n      getTocHeader: getTocHeader,\n      getTocDepth: getTocDepth\n    };\n\n    var create = function (prefix) {\n      var counter = 0;\n      return function () {\n        var guid = new Date().getTime().toString(32);\n        return prefix + guid + (counter++).toString(32);\n      };\n    };\n    var Guid = { create: create };\n\n    var tocId = Guid.create('mcetoc_');\n    var generateSelector = function generateSelector(depth) {\n      var i;\n      var selector = [];\n      for (i = 1; i <= depth; i++) {\n        selector.push('h' + i);\n      }\n      return selector.join(',');\n    };\n    var hasHeaders = function (editor) {\n      return readHeaders(editor).length > 0;\n    };\n    var readHeaders = function (editor) {\n      var tocClass = Settings.getTocClass(editor);\n      var headerTag = Settings.getTocHeader(editor);\n      var selector = generateSelector(Settings.getTocDepth(editor));\n      var headers = editor.$(selector);\n      if (headers.length && /^h[1-9]$/i.test(headerTag)) {\n        headers = headers.filter(function (i, el) {\n          return !editor.dom.hasClass(el.parentNode, tocClass);\n        });\n      }\n      return global$3.map(headers, function (h) {\n        return {\n          id: h.id ? h.id : tocId(),\n          level: parseInt(h.nodeName.replace(/^H/i, ''), 10),\n          title: editor.$.text(h),\n          element: h\n        };\n      });\n    };\n    var getMinLevel = function (headers) {\n      var i, minLevel = 9;\n      for (i = 0; i < headers.length; i++) {\n        if (headers[i].level < minLevel) {\n          minLevel = headers[i].level;\n        }\n        if (minLevel === 1) {\n          return minLevel;\n        }\n      }\n      return minLevel;\n    };\n    var generateTitle = function (tag, title) {\n      var openTag = '<' + tag + ' contenteditable=\"true\">';\n      var closeTag = '</' + tag + '>';\n      return openTag + global$1.DOM.encode(title) + closeTag;\n    };\n    var generateTocHtml = function (editor) {\n      var html = generateTocContentHtml(editor);\n      return '<div class=\"' + editor.dom.encode(Settings.getTocClass(editor)) + '\" contenteditable=\"false\">' + html + '</div>';\n    };\n    var generateTocContentHtml = function (editor) {\n      var html = '';\n      var headers = readHeaders(editor);\n      var prevLevel = getMinLevel(headers) - 1;\n      var i, ii, h, nextLevel;\n      if (!headers.length) {\n        return '';\n      }\n      html += generateTitle(Settings.getTocHeader(editor), global$2.translate('Table of Contents'));\n      for (i = 0; i < headers.length; i++) {\n        h = headers[i];\n        h.element.id = h.id;\n        nextLevel = headers[i + 1] && headers[i + 1].level;\n        if (prevLevel === h.level) {\n          html += '<li>';\n        } else {\n          for (ii = prevLevel; ii < h.level; ii++) {\n            html += '<ul><li>';\n          }\n        }\n        html += '<a href=\"#' + h.id + '\">' + h.title + '</a>';\n        if (nextLevel === h.level || !nextLevel) {\n          html += '</li>';\n          if (!nextLevel) {\n            html += '</ul>';\n          }\n        } else {\n          for (ii = h.level; ii > nextLevel; ii--) {\n            html += '</li></ul><li>';\n          }\n        }\n        prevLevel = h.level;\n      }\n      return html;\n    };\n    var isEmptyOrOffscren = function (editor, nodes) {\n      return !nodes.length || editor.dom.getParents(nodes[0], '.mce-offscreen-selection').length > 0;\n    };\n    var insertToc = function (editor) {\n      var tocClass = Settings.getTocClass(editor);\n      var $tocElm = editor.$('.' + tocClass);\n      if (isEmptyOrOffscren(editor, $tocElm)) {\n        editor.insertContent(generateTocHtml(editor));\n      } else {\n        updateToc(editor);\n      }\n    };\n    var updateToc = function (editor) {\n      var tocClass = Settings.getTocClass(editor);\n      var $tocElm = editor.$('.' + tocClass);\n      if ($tocElm.length) {\n        editor.undoManager.transact(function () {\n          $tocElm.html(generateTocContentHtml(editor));\n        });\n      }\n    };\n    var Toc = {\n      hasHeaders: hasHeaders,\n      insertToc: insertToc,\n      updateToc: updateToc\n    };\n\n    var register = function (editor) {\n      editor.addCommand('mceInsertToc', function () {\n        Toc.insertToc(editor);\n      });\n      editor.addCommand('mceUpdateToc', function () {\n        Toc.updateToc(editor);\n      });\n    };\n    var Commands = { register: register };\n\n    var setup = function (editor) {\n      var $ = editor.$, tocClass = Settings.getTocClass(editor);\n      editor.on('PreProcess', function (e) {\n        var $tocElm = $('.' + tocClass, e.node);\n        if ($tocElm.length) {\n          $tocElm.removeAttr('contentEditable');\n          $tocElm.find('[contenteditable]').removeAttr('contentEditable');\n        }\n      });\n      editor.on('SetContent', function () {\n        var $tocElm = $('.' + tocClass);\n        if ($tocElm.length) {\n          $tocElm.attr('contentEditable', false);\n          $tocElm.children(':first-child').attr('contentEditable', true);\n        }\n      });\n    };\n    var FilterContent = { setup: setup };\n\n    var toggleState = function (editor) {\n      return function (api) {\n        var toggleDisabledState = function () {\n          return api.setDisabled(editor.readonly || !Toc.hasHeaders(editor));\n        };\n        toggleDisabledState();\n        editor.on('LoadContent SetContent change', toggleDisabledState);\n        return function () {\n          return editor.on('LoadContent SetContent change', toggleDisabledState);\n        };\n      };\n    };\n    var isToc = function (editor) {\n      return function (elm) {\n        return elm && editor.dom.is(elm, '.' + Settings.getTocClass(editor)) && editor.getBody().contains(elm);\n      };\n    };\n    var register$1 = function (editor) {\n      editor.ui.registry.addButton('toc', {\n        icon: 'toc',\n        tooltip: 'Table of contents',\n        onAction: function () {\n          return editor.execCommand('mceInsertToc');\n        },\n        onSetup: toggleState(editor)\n      });\n      editor.ui.registry.addButton('tocupdate', {\n        icon: 'reload',\n        tooltip: 'Update',\n        onAction: function () {\n          return editor.execCommand('mceUpdateToc');\n        }\n      });\n      editor.ui.registry.addMenuItem('toc', {\n        icon: 'toc',\n        text: 'Table of contents',\n        onAction: function () {\n          return editor.execCommand('mceInsertToc');\n        },\n        onSetup: toggleState(editor)\n      });\n      editor.ui.registry.addContextToolbar('toc', {\n        items: 'tocupdate',\n        predicate: isToc(editor),\n        scope: 'node',\n        position: 'node'\n      });\n    };\n    var Buttons = { register: register$1 };\n\n    function Plugin () {\n      global.add('toc', function (editor) {\n        Commands.register(editor);\n        Buttons.register(editor);\n        FilterContent.setup(editor);\n      });\n    }\n\n    Plugin();\n\n}());\n"]}