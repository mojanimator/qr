{"version":3,"sources":["../../../../../public/js/plugins/link/plugin.js"],"names":["domGlobals","global$1","tinymce","util","Tools","resolve","global$2","typeOf","x","t","Array","prototype","isPrototypeOf","constructor","name","String","isType","type","value","isString","isArray","isBoolean","isFunction","assumeExternalTargets","editor","externalTargets","getParam","hasContextToolbar","getLinkList","getDefaultLinkTarget","getTargetList","getRelList","getLinkClassList","shouldShowLinkTitle","allowUnsafeLinkTarget","useQuickLink","Settings","appendClickRemove","link","evt","document","body","appendChild","dispatchEvent","removeChild","open","url","createElement","target","href","rel","createEvent","initMouseEvent","window","OpenUrl","noop","constant","never","always","none","NONE","eq","o","isNone","call","thunk","id","n","me","fold","s","is","isSome","getOr","getOrThunk","getOrDie","msg","Error","getOrNull","getOrUndefined","undefined","or","orThunk","map","each","bind","exists","forall","filter","equals","equals_","toArray","toString","Object","freeze","some","a","constant_a","self","f","v","elementEq","b","from","Option","nativeSlice","slice","nativeIndexOf","indexOf","nativePush","push","rawIndexOf","ts","contains","xs","len","length","r","i","foldl","acc","flatten","apply","output","from$1","global$3","hasProtocol","test","getHref","elm","getAttribute","applyRelTargetRules","isUnsafe","rules","rels","split","trim","sort","join","addTargetRules","removeTargetRules","concat","val","inArray","newRels","trimCaretContainers","text","replace","getAnchorElement","selectedElm","selection","getNode","isImageFigure","dom","select","getParent","getAnchorText","anchorElm","innerText","textContent","getContent","format","isLink","nodeName","hasLinks","elements","grep","isOnlyTextSelected","html","className","getLinkAttrs","data","key","handleExternalTargets","updateLink","linkAttrs","hasOwnProperty","setAttribs","createLink","linkImageFigure","execCommand","insertContent","createHTML","encode","attachState","undoManager","transact","newRel","attach","focus","unlink","node","unlinkImageFigure","getBody","remove","fig","img","getParents","parentNode","insertBefore","attrs","create","Utils","cat","arr","findMap","getValue","item","sanitizeList","list","extractValue","out","title","menu","sanitizeWith","extracter","sanitize","createUi","label","items","ListOptions","Cell","initial","get","set","clone","findTextByValue","catalog","getDelta","persistentText","fieldName","hasPersistentText","meta","findCatalog","settings","catalogs","anchor","init","initialData","linkSettings","onUrlChange","urlText","onCatalogChange","change","onChange","getData","DialogChanges","__assign","assign","arguments","p","exports$1","module","exports","define","require","amd","g","global","EphoxContactWrapper","e","c","u","code","process","cachedSetTimeout","cachedClearTimeout","defaultSetTimout","defaultClearTimeout","setTimeout","clearTimeout","runTimeout","fun","runClearTimeout","marker","queue","draining","currentQueue","queueIndex","cleanUpNextTick","drainQueue","timeout","run","nextTick","args","Item","array","browser","env","argv","version","versions","on","addListener","once","off","removeListener","removeAllListeners","emit","prependListener","prependOnceListener","listeners","binding","cwd","chdir","dir","umask","setImmediate","root","setTimeoutFunc","fn","thisArg","Promise","TypeError","_state","_handled","_value","_deferreds","doResolve","handle","deferred","_immediateFn","cb","onFulfilled","onRejected","reject","promise","ret","newValue","then","finale","_unhandledRejectionFn","Handler","done","reason","ex","prom","all","remaining","res","race","values","err","console","warn","_setImmediateFn","_setUnhandledRejectionFn","clearImmediate","Function","immediateIds","nextImmediateId","Timeout","setInterval","clearInterval","close","clearFn","_id","_clearFn","unref","ref","enroll","msecs","_idleTimeoutId","_idleTimeout","unenroll","_unrefActive","active","onTimeout","_onTimeout","onNextTick","promisePolyfill","Global","boltExport","nu","baseFn","callbacks","nCallback","isReady","cbs","pure","callback","LazyValue","errorReporter","make","fab","aFutureB","toPromise","anonBind","futureB","toLazy","toCached","cache","nu$1","pure$1","Future","global$4","delayedConfirm","message","rng","getRng","setEditorTimeout","windowManager","confirm","state","setRng","tryEmailTransform","suggestMailTo","preprocess","oldData","tryProtocolTransform","suggestProtocol","transform","DialogConfirms","getAnchors","anchorNodes","anchors","AnchorListOptions","getClasses","ClassListOptions","global$5","parseJson","JSON","parse","getLinks","extractor","convertURL","linkList","send","success","error","_","optItems","LinkListOptions","getRels","initialTarget","isTargetBlank_1","enforceSafe","safeRelExtractor","sanitizer","RelOptions","fallbacks","getTargets","TargetOptions","nonEmptyAttr","elem","getAttrib","extractFromAnchor","onlyText","linkClass","collect","linkNode","links","targets","classes","optNode","flags","titleEnabled","DialogInfo","handleSubmit","info","api","getChangedValue","changedData","class","pData","collectData","anchorNode","getInitialData","defaultTarget","original","makeDialog","onSubmit","urlInput","filetype","displayText","titleText","dialogDelta","size","buttons","primary","_a","newData","setData","open$1","spec","Dialog","getLink","getSelectedLink","getStart","hasOnlyAltModifier","altKey","shiftKey","ctrlKey","metaKey","gotoLink","targetEl","$","scrollIntoView","openDialog","gotoSelectedLink","leftClickedOnAHref","sel","startContainer","nodeType","isCollapsed","startOffset","setupGotoLinks","metaKeyPressed","preventDefault","keyCode","toggleActiveState","nodeChangeHandler","setActive","readonly","element","toggleEnabledState","setDisabled","parents","Actions","register","addCommand","fire","toolbarKey","Commands","setup","addShortcut","Keyboard","setupButtons","ui","registry","addToggleButton","icon","tooltip","onAction","onSetup","addButton","setupMenuItems","addMenuItem","shortcut","setupContextMenu","inLink","noLink","addContextMenu","update","setupContextToolbars","collapseSelectionToEnd","collapse","onSetupLink","buttonApi","addContextForm","launch","predicate","initValue","commands","formApi","hide","setAttrib","Controls","Plugin","add"],"mappings":"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","file":"plugin.js","sourcesContent":["/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.1.0 (2019-10-17)\n */\n(function (domGlobals) {\n    'use strict';\n\n    var global$1 = tinymce.util.Tools.resolve('tinymce.PluginManager');\n\n    var global$2 = tinymce.util.Tools.resolve('tinymce.util.VK');\n\n    var typeOf = function (x) {\n      if (x === null) {\n        return 'null';\n      }\n      var t = typeof x;\n      if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {\n        return 'array';\n      }\n      if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {\n        return 'string';\n      }\n      return t;\n    };\n    var isType = function (type) {\n      return function (value) {\n        return typeOf(value) === type;\n      };\n    };\n    var isString = isType('string');\n    var isArray = isType('array');\n    var isBoolean = isType('boolean');\n    var isFunction = isType('function');\n\n    var assumeExternalTargets = function (editor) {\n      var externalTargets = editor.getParam('link_assume_external_targets', false);\n      if (isBoolean(externalTargets) && externalTargets) {\n        return 1;\n      } else if (isString(externalTargets) && (externalTargets === 'http' || externalTargets === 'https')) {\n        return externalTargets;\n      }\n      return 0;\n    };\n    var hasContextToolbar = function (editor) {\n      return editor.getParam('link_context_toolbar', false, 'boolean');\n    };\n    var getLinkList = function (editor) {\n      return editor.getParam('link_list');\n    };\n    var getDefaultLinkTarget = function (editor) {\n      return editor.getParam('default_link_target');\n    };\n    var getTargetList = function (editor) {\n      return editor.getParam('target_list', true);\n    };\n    var getRelList = function (editor) {\n      return editor.getParam('rel_list', [], 'array');\n    };\n    var getLinkClassList = function (editor) {\n      return editor.getParam('link_class_list', [], 'array');\n    };\n    var shouldShowLinkTitle = function (editor) {\n      return editor.getParam('link_title', true, 'boolean');\n    };\n    var allowUnsafeLinkTarget = function (editor) {\n      return editor.getParam('allow_unsafe_link_target', false, 'boolean');\n    };\n    var useQuickLink = function (editor) {\n      return editor.getParam('link_quicklink', false, 'boolean');\n    };\n    var Settings = {\n      assumeExternalTargets: assumeExternalTargets,\n      hasContextToolbar: hasContextToolbar,\n      getLinkList: getLinkList,\n      getDefaultLinkTarget: getDefaultLinkTarget,\n      getTargetList: getTargetList,\n      getRelList: getRelList,\n      getLinkClassList: getLinkClassList,\n      shouldShowLinkTitle: shouldShowLinkTitle,\n      allowUnsafeLinkTarget: allowUnsafeLinkTarget,\n      useQuickLink: useQuickLink\n    };\n\n    var appendClickRemove = function (link, evt) {\n      domGlobals.document.body.appendChild(link);\n      link.dispatchEvent(evt);\n      domGlobals.document.body.removeChild(link);\n    };\n    var open = function (url) {\n      var link = domGlobals.document.createElement('a');\n      link.target = '_blank';\n      link.href = url;\n      link.rel = 'noreferrer noopener';\n      var evt = domGlobals.document.createEvent('MouseEvents');\n      evt.initMouseEvent('click', true, true, domGlobals.window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);\n      appendClickRemove(link, evt);\n    };\n    var OpenUrl = { open: open };\n\n    var noop = function () {\n    };\n    var constant = function (value) {\n      return function () {\n        return value;\n      };\n    };\n    var never = constant(false);\n    var always = constant(true);\n\n    var none = function () {\n      return NONE;\n    };\n    var NONE = function () {\n      var eq = function (o) {\n        return o.isNone();\n      };\n      var call = function (thunk) {\n        return thunk();\n      };\n      var id = function (n) {\n        return n;\n      };\n      var me = {\n        fold: function (n, s) {\n          return n();\n        },\n        is: never,\n        isSome: never,\n        isNone: always,\n        getOr: id,\n        getOrThunk: call,\n        getOrDie: function (msg) {\n          throw new Error(msg || 'error: getOrDie called on none.');\n        },\n        getOrNull: constant(null),\n        getOrUndefined: constant(undefined),\n        or: id,\n        orThunk: call,\n        map: none,\n        each: noop,\n        bind: none,\n        exists: never,\n        forall: always,\n        filter: none,\n        equals: eq,\n        equals_: eq,\n        toArray: function () {\n          return [];\n        },\n        toString: constant('none()')\n      };\n      if (Object.freeze) {\n        Object.freeze(me);\n      }\n      return me;\n    }();\n    var some = function (a) {\n      var constant_a = constant(a);\n      var self = function () {\n        return me;\n      };\n      var bind = function (f) {\n        return f(a);\n      };\n      var me = {\n        fold: function (n, s) {\n          return s(a);\n        },\n        is: function (v) {\n          return a === v;\n        },\n        isSome: always,\n        isNone: never,\n        getOr: constant_a,\n        getOrThunk: constant_a,\n        getOrDie: constant_a,\n        getOrNull: constant_a,\n        getOrUndefined: constant_a,\n        or: self,\n        orThunk: self,\n        map: function (f) {\n          return some(f(a));\n        },\n        each: function (f) {\n          f(a);\n        },\n        bind: bind,\n        exists: bind,\n        forall: bind,\n        filter: function (f) {\n          return f(a) ? me : NONE;\n        },\n        toArray: function () {\n          return [a];\n        },\n        toString: function () {\n          return 'some(' + a + ')';\n        },\n        equals: function (o) {\n          return o.is(a);\n        },\n        equals_: function (o, elementEq) {\n          return o.fold(never, function (b) {\n            return elementEq(a, b);\n          });\n        }\n      };\n      return me;\n    };\n    var from = function (value) {\n      return value === null || value === undefined ? NONE : some(value);\n    };\n    var Option = {\n      some: some,\n      none: none,\n      from: from\n    };\n\n    var nativeSlice = Array.prototype.slice;\n    var nativeIndexOf = Array.prototype.indexOf;\n    var nativePush = Array.prototype.push;\n    var rawIndexOf = function (ts, t) {\n      return nativeIndexOf.call(ts, t);\n    };\n    var contains = function (xs, x) {\n      return rawIndexOf(xs, x) > -1;\n    };\n    var map = function (xs, f) {\n      var len = xs.length;\n      var r = new Array(len);\n      for (var i = 0; i < len; i++) {\n        var x = xs[i];\n        r[i] = f(x, i);\n      }\n      return r;\n    };\n    var each = function (xs, f) {\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        f(x, i);\n      }\n    };\n    var foldl = function (xs, f, acc) {\n      each(xs, function (x) {\n        acc = f(acc, x);\n      });\n      return acc;\n    };\n    var flatten = function (xs) {\n      var r = [];\n      for (var i = 0, len = xs.length; i < len; ++i) {\n        if (!isArray(xs[i])) {\n          throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);\n        }\n        nativePush.apply(r, xs[i]);\n      }\n      return r;\n    };\n    var bind = function (xs, f) {\n      var output = map(xs, f);\n      return flatten(output);\n    };\n    var from$1 = isFunction(Array.from) ? Array.from : function (x) {\n      return nativeSlice.call(x);\n    };\n\n    var global$3 = tinymce.util.Tools.resolve('tinymce.util.Tools');\n\n    var hasProtocol = function (url) {\n      return /^\\w+:/i.test(url);\n    };\n    var getHref = function (elm) {\n      var href = elm.getAttribute('data-mce-href');\n      return href ? href : elm.getAttribute('href');\n    };\n    var applyRelTargetRules = function (rel, isUnsafe) {\n      var rules = ['noopener'];\n      var rels = rel ? rel.split(/\\s+/) : [];\n      var toString = function (rels) {\n        return global$3.trim(rels.sort().join(' '));\n      };\n      var addTargetRules = function (rels) {\n        rels = removeTargetRules(rels);\n        return rels.length > 0 ? rels.concat(rules) : rules;\n      };\n      var removeTargetRules = function (rels) {\n        return rels.filter(function (val) {\n          return global$3.inArray(rules, val) === -1;\n        });\n      };\n      var newRels = isUnsafe ? addTargetRules(rels) : removeTargetRules(rels);\n      return newRels.length > 0 ? toString(newRels) : '';\n    };\n    var trimCaretContainers = function (text) {\n      return text.replace(/\\uFEFF/g, '');\n    };\n    var getAnchorElement = function (editor, selectedElm) {\n      selectedElm = selectedElm || editor.selection.getNode();\n      if (isImageFigure(selectedElm)) {\n        return editor.dom.select('a[href]', selectedElm)[0];\n      } else {\n        return editor.dom.getParent(selectedElm, 'a[href]');\n      }\n    };\n    var getAnchorText = function (selection, anchorElm) {\n      var text = anchorElm ? anchorElm.innerText || anchorElm.textContent : selection.getContent({ format: 'text' });\n      return trimCaretContainers(text);\n    };\n    var isLink = function (elm) {\n      return elm && elm.nodeName === 'A' && !!elm.href;\n    };\n    var hasLinks = function (elements) {\n      return global$3.grep(elements, isLink).length > 0;\n    };\n    var isOnlyTextSelected = function (html) {\n      if (/</.test(html) && (!/^<a [^>]+>[^<]+<\\/a>$/.test(html) || html.indexOf('href=') === -1)) {\n        return false;\n      }\n      return true;\n    };\n    var isImageFigure = function (elm) {\n      return elm && elm.nodeName === 'FIGURE' && /\\bimage\\b/i.test(elm.className);\n    };\n    var getLinkAttrs = function (data) {\n      return foldl([\n        'title',\n        'rel',\n        'class',\n        'target'\n      ], function (acc, key) {\n        data[key].each(function (value) {\n          acc[key] = value.length > 0 ? value : null;\n        });\n        return acc;\n      }, { href: data.href });\n    };\n    var handleExternalTargets = function (href, assumeExternalTargets) {\n      if ((assumeExternalTargets === 'http' || assumeExternalTargets === 'https') && !hasProtocol(href)) {\n        return assumeExternalTargets + '://' + href;\n      }\n      return href;\n    };\n    var updateLink = function (editor, anchorElm, text, linkAttrs) {\n      text.each(function (text) {\n        if (anchorElm.hasOwnProperty('innerText')) {\n          anchorElm.innerText = text;\n        } else {\n          anchorElm.textContent = text;\n        }\n      });\n      editor.dom.setAttribs(anchorElm, linkAttrs);\n      editor.selection.select(anchorElm);\n    };\n    var createLink = function (editor, selectedElm, text, linkAttrs) {\n      if (isImageFigure(selectedElm)) {\n        linkImageFigure(editor, selectedElm, linkAttrs);\n      } else {\n        text.fold(function () {\n          editor.execCommand('mceInsertLink', false, linkAttrs);\n        }, function (text) {\n          editor.insertContent(editor.dom.createHTML('a', linkAttrs, editor.dom.encode(text)));\n        });\n      }\n    };\n    var link = function (editor, attachState, data) {\n      editor.undoManager.transact(function () {\n        var selectedElm = editor.selection.getNode();\n        var anchorElm = getAnchorElement(editor, selectedElm);\n        var linkAttrs = getLinkAttrs(data);\n        if (!(Settings.getRelList(editor).length > 0) && Settings.allowUnsafeLinkTarget(editor) === false) {\n          var newRel = applyRelTargetRules(linkAttrs.rel, linkAttrs.target === '_blank');\n          linkAttrs.rel = newRel ? newRel : null;\n        }\n        if (Option.from(linkAttrs.target).isNone()) {\n          linkAttrs.target = Settings.getDefaultLinkTarget(editor);\n        }\n        linkAttrs.href = handleExternalTargets(linkAttrs.href, Settings.assumeExternalTargets(editor));\n        if (data.href === attachState.href) {\n          attachState.attach();\n        }\n        if (anchorElm) {\n          editor.focus();\n          updateLink(editor, anchorElm, data.text, linkAttrs);\n        } else {\n          createLink(editor, selectedElm, data.text, linkAttrs);\n        }\n      });\n    };\n    var unlink = function (editor) {\n      editor.undoManager.transact(function () {\n        var node = editor.selection.getNode();\n        if (isImageFigure(node)) {\n          unlinkImageFigure(editor, node);\n        } else {\n          var anchorElm = editor.dom.getParent(node, 'a[href]', editor.getBody());\n          if (anchorElm) {\n            editor.dom.remove(anchorElm, true);\n          }\n        }\n        editor.focus();\n      });\n    };\n    var unlinkImageFigure = function (editor, fig) {\n      var img = editor.dom.select('img', fig)[0];\n      if (img) {\n        var a = editor.dom.getParents(img, 'a[href]', fig)[0];\n        if (a) {\n          a.parentNode.insertBefore(img, a);\n          editor.dom.remove(a);\n        }\n      }\n    };\n    var linkImageFigure = function (editor, fig, attrs) {\n      var img = editor.dom.select('img', fig)[0];\n      if (img) {\n        var a = editor.dom.create('a', attrs);\n        img.parentNode.insertBefore(a, img);\n        a.appendChild(img);\n      }\n    };\n    var Utils = {\n      link: link,\n      unlink: unlink,\n      isLink: isLink,\n      hasLinks: hasLinks,\n      getHref: getHref,\n      isOnlyTextSelected: isOnlyTextSelected,\n      getAnchorElement: getAnchorElement,\n      getAnchorText: getAnchorText,\n      applyRelTargetRules: applyRelTargetRules,\n      hasProtocol: hasProtocol\n    };\n\n    var cat = function (arr) {\n      var r = [];\n      var push = function (x) {\n        r.push(x);\n      };\n      for (var i = 0; i < arr.length; i++) {\n        arr[i].each(push);\n      }\n      return r;\n    };\n    var findMap = function (arr, f) {\n      for (var i = 0; i < arr.length; i++) {\n        var r = f(arr[i], i);\n        if (r.isSome()) {\n          return r;\n        }\n      }\n      return Option.none();\n    };\n\n    var getValue = function (item) {\n      return isString(item.value) ? item.value : '';\n    };\n    var sanitizeList = function (list, extractValue) {\n      var out = [];\n      global$3.each(list, function (item) {\n        var text = isString(item.text) ? item.text : isString(item.title) ? item.title : '';\n        if (item.menu !== undefined) ; else {\n          var value = extractValue(item);\n          out.push({\n            text: text,\n            value: value\n          });\n        }\n      });\n      return out;\n    };\n    var sanitizeWith = function (extracter) {\n      if (extracter === void 0) {\n        extracter = getValue;\n      }\n      return function (list) {\n        return Option.from(list).map(function (list) {\n          return sanitizeList(list, extracter);\n        });\n      };\n    };\n    var sanitize = function (list) {\n      return sanitizeWith(getValue)(list);\n    };\n    var createUi = function (name, label) {\n      return function (items) {\n        return {\n          name: name,\n          type: 'selectbox',\n          label: label,\n          items: items\n        };\n      };\n    };\n    var ListOptions = {\n      sanitize: sanitize,\n      sanitizeWith: sanitizeWith,\n      createUi: createUi,\n      getValue: getValue\n    };\n\n    var Cell = function (initial) {\n      var value = initial;\n      var get = function () {\n        return value;\n      };\n      var set = function (v) {\n        value = v;\n      };\n      var clone = function () {\n        return Cell(get());\n      };\n      return {\n        get: get,\n        set: set,\n        clone: clone\n      };\n    };\n\n    var findTextByValue = function (value, catalog) {\n      return findMap(catalog, function (item) {\n        return Option.some(item).filter(function (i) {\n          return i.value === value;\n        });\n      });\n    };\n    var getDelta = function (persistentText, fieldName, catalog, data) {\n      var value = data[fieldName];\n      var hasPersistentText = persistentText.length > 0;\n      return value !== undefined ? findTextByValue(value, catalog).map(function (i) {\n        return {\n          url: {\n            value: i.value,\n            meta: {\n              text: hasPersistentText ? persistentText : i.text,\n              attach: noop\n            }\n          },\n          text: hasPersistentText ? persistentText : i.text\n        };\n      }) : Option.none();\n    };\n    var findCatalog = function (settings, fieldName) {\n      if (fieldName === 'link') {\n        return settings.catalogs.link;\n      } else if (fieldName === 'anchor') {\n        return settings.catalogs.anchor;\n      } else {\n        return Option.none();\n      }\n    };\n    var init = function (initialData, linkSettings) {\n      var persistentText = Cell(initialData.text);\n      var onUrlChange = function (data) {\n        if (persistentText.get().length <= 0) {\n          var urlText = data.url.meta.text !== undefined ? data.url.meta.text : data.url.value;\n          return Option.some({ text: urlText });\n        } else {\n          return Option.none();\n        }\n      };\n      var onCatalogChange = function (data, change) {\n        var catalog = findCatalog(linkSettings, change.name).getOr([]);\n        return getDelta(persistentText.get(), change.name, catalog, data);\n      };\n      var onChange = function (getData, change) {\n        if (change.name === 'url') {\n          return onUrlChange(getData());\n        } else if (contains([\n            'anchor',\n            'link'\n          ], change.name)) {\n          return onCatalogChange(getData(), change);\n        } else if (change.name === 'text') {\n          persistentText.set(getData().text);\n          return Option.none();\n        } else {\n          return Option.none();\n        }\n      };\n      return { onChange: onChange };\n    };\n    var DialogChanges = {\n      init: init,\n      getDelta: getDelta\n    };\n\n    var __assign = function () {\n      __assign = Object.assign || function __assign(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s)\n            if (Object.prototype.hasOwnProperty.call(s, p))\n              t[p] = s[p];\n        }\n        return t;\n      };\n      return __assign.apply(this, arguments);\n    };\n\n    var exports$1 = {}, module = { exports: exports$1 };\n    (function (define, exports, module, require) {\n      (function (f) {\n        if (typeof exports === 'object' && typeof module !== 'undefined') {\n          module.exports = f();\n        } else if (typeof define === 'function' && define.amd) {\n          define([], f);\n        } else {\n          var g;\n          if (typeof window !== 'undefined') {\n            g = window;\n          } else if (typeof global !== 'undefined') {\n            g = global;\n          } else if (typeof self !== 'undefined') {\n            g = self;\n          } else {\n            g = this;\n          }\n          g.EphoxContactWrapper = f();\n        }\n      }(function () {\n        return function () {\n          function r(e, n, t) {\n            function o(i, f) {\n              if (!n[i]) {\n                if (!e[i]) {\n                  var c = 'function' == typeof require && require;\n                  if (!f && c)\n                    return c(i, !0);\n                  if (u)\n                    return u(i, !0);\n                  var a = new Error('Cannot find module \\'' + i + '\\'');\n                  throw a.code = 'MODULE_NOT_FOUND', a;\n                }\n                var p = n[i] = { exports: {} };\n                e[i][0].call(p.exports, function (r) {\n                  var n = e[i][1][r];\n                  return o(n || r);\n                }, p, p.exports, r, e, n, t);\n              }\n              return n[i].exports;\n            }\n            for (var u = 'function' == typeof require && require, i = 0; i < t.length; i++)\n              o(t[i]);\n            return o;\n          }\n          return r;\n        }()({\n          1: [\n            function (require, module, exports) {\n              var process = module.exports = {};\n              var cachedSetTimeout;\n              var cachedClearTimeout;\n              function defaultSetTimout() {\n                throw new Error('setTimeout has not been defined');\n              }\n              function defaultClearTimeout() {\n                throw new Error('clearTimeout has not been defined');\n              }\n              (function () {\n                try {\n                  if (typeof setTimeout === 'function') {\n                    cachedSetTimeout = setTimeout;\n                  } else {\n                    cachedSetTimeout = defaultSetTimout;\n                  }\n                } catch (e) {\n                  cachedSetTimeout = defaultSetTimout;\n                }\n                try {\n                  if (typeof clearTimeout === 'function') {\n                    cachedClearTimeout = clearTimeout;\n                  } else {\n                    cachedClearTimeout = defaultClearTimeout;\n                  }\n                } catch (e) {\n                  cachedClearTimeout = defaultClearTimeout;\n                }\n              }());\n              function runTimeout(fun) {\n                if (cachedSetTimeout === setTimeout) {\n                  return setTimeout(fun, 0);\n                }\n                if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n                  cachedSetTimeout = setTimeout;\n                  return setTimeout(fun, 0);\n                }\n                try {\n                  return cachedSetTimeout(fun, 0);\n                } catch (e) {\n                  try {\n                    return cachedSetTimeout.call(null, fun, 0);\n                  } catch (e) {\n                    return cachedSetTimeout.call(this, fun, 0);\n                  }\n                }\n              }\n              function runClearTimeout(marker) {\n                if (cachedClearTimeout === clearTimeout) {\n                  return clearTimeout(marker);\n                }\n                if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n                  cachedClearTimeout = clearTimeout;\n                  return clearTimeout(marker);\n                }\n                try {\n                  return cachedClearTimeout(marker);\n                } catch (e) {\n                  try {\n                    return cachedClearTimeout.call(null, marker);\n                  } catch (e) {\n                    return cachedClearTimeout.call(this, marker);\n                  }\n                }\n              }\n              var queue = [];\n              var draining = false;\n              var currentQueue;\n              var queueIndex = -1;\n              function cleanUpNextTick() {\n                if (!draining || !currentQueue) {\n                  return;\n                }\n                draining = false;\n                if (currentQueue.length) {\n                  queue = currentQueue.concat(queue);\n                } else {\n                  queueIndex = -1;\n                }\n                if (queue.length) {\n                  drainQueue();\n                }\n              }\n              function drainQueue() {\n                if (draining) {\n                  return;\n                }\n                var timeout = runTimeout(cleanUpNextTick);\n                draining = true;\n                var len = queue.length;\n                while (len) {\n                  currentQueue = queue;\n                  queue = [];\n                  while (++queueIndex < len) {\n                    if (currentQueue) {\n                      currentQueue[queueIndex].run();\n                    }\n                  }\n                  queueIndex = -1;\n                  len = queue.length;\n                }\n                currentQueue = null;\n                draining = false;\n                runClearTimeout(timeout);\n              }\n              process.nextTick = function (fun) {\n                var args = new Array(arguments.length - 1);\n                if (arguments.length > 1) {\n                  for (var i = 1; i < arguments.length; i++) {\n                    args[i - 1] = arguments[i];\n                  }\n                }\n                queue.push(new Item(fun, args));\n                if (queue.length === 1 && !draining) {\n                  runTimeout(drainQueue);\n                }\n              };\n              function Item(fun, array) {\n                this.fun = fun;\n                this.array = array;\n              }\n              Item.prototype.run = function () {\n                this.fun.apply(null, this.array);\n              };\n              process.title = 'browser';\n              process.browser = true;\n              process.env = {};\n              process.argv = [];\n              process.version = '';\n              process.versions = {};\n              function noop() {\n              }\n              process.on = noop;\n              process.addListener = noop;\n              process.once = noop;\n              process.off = noop;\n              process.removeListener = noop;\n              process.removeAllListeners = noop;\n              process.emit = noop;\n              process.prependListener = noop;\n              process.prependOnceListener = noop;\n              process.listeners = function (name) {\n                return [];\n              };\n              process.binding = function (name) {\n                throw new Error('process.binding is not supported');\n              };\n              process.cwd = function () {\n                return '/';\n              };\n              process.chdir = function (dir) {\n                throw new Error('process.chdir is not supported');\n              };\n              process.umask = function () {\n                return 0;\n              };\n            },\n            {}\n          ],\n          2: [\n            function (require, module, exports) {\n              (function (setImmediate) {\n                (function (root) {\n                  var setTimeoutFunc = setTimeout;\n                  function noop() {\n                  }\n                  function bind(fn, thisArg) {\n                    return function () {\n                      fn.apply(thisArg, arguments);\n                    };\n                  }\n                  function Promise(fn) {\n                    if (typeof this !== 'object')\n                      throw new TypeError('Promises must be constructed via new');\n                    if (typeof fn !== 'function')\n                      throw new TypeError('not a function');\n                    this._state = 0;\n                    this._handled = false;\n                    this._value = undefined;\n                    this._deferreds = [];\n                    doResolve(fn, this);\n                  }\n                  function handle(self, deferred) {\n                    while (self._state === 3) {\n                      self = self._value;\n                    }\n                    if (self._state === 0) {\n                      self._deferreds.push(deferred);\n                      return;\n                    }\n                    self._handled = true;\n                    Promise._immediateFn(function () {\n                      var cb = self._state === 1 ? deferred.onFulfilled : deferred.onRejected;\n                      if (cb === null) {\n                        (self._state === 1 ? resolve : reject)(deferred.promise, self._value);\n                        return;\n                      }\n                      var ret;\n                      try {\n                        ret = cb(self._value);\n                      } catch (e) {\n                        reject(deferred.promise, e);\n                        return;\n                      }\n                      resolve(deferred.promise, ret);\n                    });\n                  }\n                  function resolve(self, newValue) {\n                    try {\n                      if (newValue === self)\n                        throw new TypeError('A promise cannot be resolved with itself.');\n                      if (newValue && (typeof newValue === 'object' || typeof newValue === 'function')) {\n                        var then = newValue.then;\n                        if (newValue instanceof Promise) {\n                          self._state = 3;\n                          self._value = newValue;\n                          finale(self);\n                          return;\n                        } else if (typeof then === 'function') {\n                          doResolve(bind(then, newValue), self);\n                          return;\n                        }\n                      }\n                      self._state = 1;\n                      self._value = newValue;\n                      finale(self);\n                    } catch (e) {\n                      reject(self, e);\n                    }\n                  }\n                  function reject(self, newValue) {\n                    self._state = 2;\n                    self._value = newValue;\n                    finale(self);\n                  }\n                  function finale(self) {\n                    if (self._state === 2 && self._deferreds.length === 0) {\n                      Promise._immediateFn(function () {\n                        if (!self._handled) {\n                          Promise._unhandledRejectionFn(self._value);\n                        }\n                      });\n                    }\n                    for (var i = 0, len = self._deferreds.length; i < len; i++) {\n                      handle(self, self._deferreds[i]);\n                    }\n                    self._deferreds = null;\n                  }\n                  function Handler(onFulfilled, onRejected, promise) {\n                    this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\n                    this.onRejected = typeof onRejected === 'function' ? onRejected : null;\n                    this.promise = promise;\n                  }\n                  function doResolve(fn, self) {\n                    var done = false;\n                    try {\n                      fn(function (value) {\n                        if (done)\n                          return;\n                        done = true;\n                        resolve(self, value);\n                      }, function (reason) {\n                        if (done)\n                          return;\n                        done = true;\n                        reject(self, reason);\n                      });\n                    } catch (ex) {\n                      if (done)\n                        return;\n                      done = true;\n                      reject(self, ex);\n                    }\n                  }\n                  Promise.prototype['catch'] = function (onRejected) {\n                    return this.then(null, onRejected);\n                  };\n                  Promise.prototype.then = function (onFulfilled, onRejected) {\n                    var prom = new this.constructor(noop);\n                    handle(this, new Handler(onFulfilled, onRejected, prom));\n                    return prom;\n                  };\n                  Promise.all = function (arr) {\n                    var args = Array.prototype.slice.call(arr);\n                    return new Promise(function (resolve, reject) {\n                      if (args.length === 0)\n                        return resolve([]);\n                      var remaining = args.length;\n                      function res(i, val) {\n                        try {\n                          if (val && (typeof val === 'object' || typeof val === 'function')) {\n                            var then = val.then;\n                            if (typeof then === 'function') {\n                              then.call(val, function (val) {\n                                res(i, val);\n                              }, reject);\n                              return;\n                            }\n                          }\n                          args[i] = val;\n                          if (--remaining === 0) {\n                            resolve(args);\n                          }\n                        } catch (ex) {\n                          reject(ex);\n                        }\n                      }\n                      for (var i = 0; i < args.length; i++) {\n                        res(i, args[i]);\n                      }\n                    });\n                  };\n                  Promise.resolve = function (value) {\n                    if (value && typeof value === 'object' && value.constructor === Promise) {\n                      return value;\n                    }\n                    return new Promise(function (resolve) {\n                      resolve(value);\n                    });\n                  };\n                  Promise.reject = function (value) {\n                    return new Promise(function (resolve, reject) {\n                      reject(value);\n                    });\n                  };\n                  Promise.race = function (values) {\n                    return new Promise(function (resolve, reject) {\n                      for (var i = 0, len = values.length; i < len; i++) {\n                        values[i].then(resolve, reject);\n                      }\n                    });\n                  };\n                  Promise._immediateFn = typeof setImmediate === 'function' ? function (fn) {\n                    setImmediate(fn);\n                  } : function (fn) {\n                    setTimeoutFunc(fn, 0);\n                  };\n                  Promise._unhandledRejectionFn = function _unhandledRejectionFn(err) {\n                    if (typeof console !== 'undefined' && console) {\n                      console.warn('Possible Unhandled Promise Rejection:', err);\n                    }\n                  };\n                  Promise._setImmediateFn = function _setImmediateFn(fn) {\n                    Promise._immediateFn = fn;\n                  };\n                  Promise._setUnhandledRejectionFn = function _setUnhandledRejectionFn(fn) {\n                    Promise._unhandledRejectionFn = fn;\n                  };\n                  if (typeof module !== 'undefined' && module.exports) {\n                    module.exports = Promise;\n                  } else if (!root.Promise) {\n                    root.Promise = Promise;\n                  }\n                }(this));\n              }.call(this, require('timers').setImmediate));\n            },\n            { 'timers': 3 }\n          ],\n          3: [\n            function (require, module, exports) {\n              (function (setImmediate, clearImmediate) {\n                var nextTick = require('process/browser.js').nextTick;\n                var apply = Function.prototype.apply;\n                var slice = Array.prototype.slice;\n                var immediateIds = {};\n                var nextImmediateId = 0;\n                exports.setTimeout = function () {\n                  return new Timeout(apply.call(setTimeout, window, arguments), clearTimeout);\n                };\n                exports.setInterval = function () {\n                  return new Timeout(apply.call(setInterval, window, arguments), clearInterval);\n                };\n                exports.clearTimeout = exports.clearInterval = function (timeout) {\n                  timeout.close();\n                };\n                function Timeout(id, clearFn) {\n                  this._id = id;\n                  this._clearFn = clearFn;\n                }\n                Timeout.prototype.unref = Timeout.prototype.ref = function () {\n                };\n                Timeout.prototype.close = function () {\n                  this._clearFn.call(window, this._id);\n                };\n                exports.enroll = function (item, msecs) {\n                  clearTimeout(item._idleTimeoutId);\n                  item._idleTimeout = msecs;\n                };\n                exports.unenroll = function (item) {\n                  clearTimeout(item._idleTimeoutId);\n                  item._idleTimeout = -1;\n                };\n                exports._unrefActive = exports.active = function (item) {\n                  clearTimeout(item._idleTimeoutId);\n                  var msecs = item._idleTimeout;\n                  if (msecs >= 0) {\n                    item._idleTimeoutId = setTimeout(function onTimeout() {\n                      if (item._onTimeout)\n                        item._onTimeout();\n                    }, msecs);\n                  }\n                };\n                exports.setImmediate = typeof setImmediate === 'function' ? setImmediate : function (fn) {\n                  var id = nextImmediateId++;\n                  var args = arguments.length < 2 ? false : slice.call(arguments, 1);\n                  immediateIds[id] = true;\n                  nextTick(function onNextTick() {\n                    if (immediateIds[id]) {\n                      if (args) {\n                        fn.apply(null, args);\n                      } else {\n                        fn.call(null);\n                      }\n                      exports.clearImmediate(id);\n                    }\n                  });\n                  return id;\n                };\n                exports.clearImmediate = typeof clearImmediate === 'function' ? clearImmediate : function (id) {\n                  delete immediateIds[id];\n                };\n              }.call(this, require('timers').setImmediate, require('timers').clearImmediate));\n            },\n            {\n              'process/browser.js': 1,\n              'timers': 3\n            }\n          ],\n          4: [\n            function (require, module, exports) {\n              var promisePolyfill = require('promise-polyfill');\n              var Global = function () {\n                if (typeof window !== 'undefined') {\n                  return window;\n                } else {\n                  return Function('return this;')();\n                }\n              }();\n              module.exports = { boltExport: Global.Promise || promisePolyfill };\n            },\n            { 'promise-polyfill': 2 }\n          ]\n        }, {}, [4])(4);\n      }));\n    }(undefined, exports$1, module, undefined));\n    var Promise = module.exports.boltExport;\n\n    var nu = function (baseFn) {\n      var data = Option.none();\n      var callbacks = [];\n      var map = function (f) {\n        return nu(function (nCallback) {\n          get(function (data) {\n            nCallback(f(data));\n          });\n        });\n      };\n      var get = function (nCallback) {\n        if (isReady()) {\n          call(nCallback);\n        } else {\n          callbacks.push(nCallback);\n        }\n      };\n      var set = function (x) {\n        data = Option.some(x);\n        run(callbacks);\n        callbacks = [];\n      };\n      var isReady = function () {\n        return data.isSome();\n      };\n      var run = function (cbs) {\n        each(cbs, call);\n      };\n      var call = function (cb) {\n        data.each(function (x) {\n          domGlobals.setTimeout(function () {\n            cb(x);\n          }, 0);\n        });\n      };\n      baseFn(set);\n      return {\n        get: get,\n        map: map,\n        isReady: isReady\n      };\n    };\n    var pure = function (a) {\n      return nu(function (callback) {\n        callback(a);\n      });\n    };\n    var LazyValue = {\n      nu: nu,\n      pure: pure\n    };\n\n    var errorReporter = function (err) {\n      domGlobals.setTimeout(function () {\n        throw err;\n      }, 0);\n    };\n    var make = function (run) {\n      var get = function (callback) {\n        run().then(callback, errorReporter);\n      };\n      var map = function (fab) {\n        return make(function () {\n          return run().then(fab);\n        });\n      };\n      var bind = function (aFutureB) {\n        return make(function () {\n          return run().then(function (v) {\n            return aFutureB(v).toPromise();\n          });\n        });\n      };\n      var anonBind = function (futureB) {\n        return make(function () {\n          return run().then(function () {\n            return futureB.toPromise();\n          });\n        });\n      };\n      var toLazy = function () {\n        return LazyValue.nu(get);\n      };\n      var toCached = function () {\n        var cache = null;\n        return make(function () {\n          if (cache === null) {\n            cache = run();\n          }\n          return cache;\n        });\n      };\n      var toPromise = run;\n      return {\n        map: map,\n        bind: bind,\n        anonBind: anonBind,\n        toLazy: toLazy,\n        toCached: toCached,\n        toPromise: toPromise,\n        get: get\n      };\n    };\n    var nu$1 = function (baseFn) {\n      return make(function () {\n        return new Promise(baseFn);\n      });\n    };\n    var pure$1 = function (a) {\n      return make(function () {\n        return Promise.resolve(a);\n      });\n    };\n    var Future = {\n      nu: nu$1,\n      pure: pure$1\n    };\n\n    var global$4 = tinymce.util.Tools.resolve('tinymce.util.Delay');\n\n    var delayedConfirm = function (editor, message, callback) {\n      var rng = editor.selection.getRng();\n      global$4.setEditorTimeout(editor, function () {\n        editor.windowManager.confirm(message, function (state) {\n          editor.selection.setRng(rng);\n          callback(state);\n        });\n      });\n    };\n    var tryEmailTransform = function (data) {\n      var url = data.href;\n      var suggestMailTo = url.indexOf('@') > 0 && url.indexOf('//') === -1 && url.indexOf('mailto:') === -1;\n      return suggestMailTo ? Option.some({\n        message: 'The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?',\n        preprocess: function (oldData) {\n          return __assign(__assign({}, oldData), { href: 'mailto:' + url });\n        }\n      }) : Option.none();\n    };\n    var tryProtocolTransform = function (assumeExternalTargets) {\n      return function (data) {\n        var url = data.href;\n        var suggestProtocol = assumeExternalTargets === 1 && !Utils.hasProtocol(url) || assumeExternalTargets === 0 && /^\\s*www[\\.|\\d\\.]/i.test(url);\n        return suggestProtocol ? Option.some({\n          message: 'The URL you entered seems to be an external link. Do you want to add the required http:// prefix?',\n          preprocess: function (oldData) {\n            return __assign(__assign({}, oldData), { href: 'http://' + url });\n          }\n        }) : Option.none();\n      };\n    };\n    var preprocess = function (editor, assumeExternalTargets, data) {\n      return findMap([\n        tryEmailTransform,\n        tryProtocolTransform(assumeExternalTargets)\n      ], function (f) {\n        return f(data);\n      }).fold(function () {\n        return Future.pure(data);\n      }, function (transform) {\n        return Future.nu(function (callback) {\n          delayedConfirm(editor, transform.message, function (state) {\n            callback(state ? transform.preprocess(data) : data);\n          });\n        });\n      });\n    };\n    var DialogConfirms = { preprocess: preprocess };\n\n    var getAnchors = function (editor) {\n      var anchorNodes = editor.dom.select('a:not([href])');\n      var anchors = bind(anchorNodes, function (anchor) {\n        var id = anchor.name || anchor.id;\n        return id ? [{\n            text: id,\n            value: '#' + id\n          }] : [];\n      });\n      return anchors.length > 0 ? Option.some([{\n          text: 'None',\n          value: ''\n        }].concat(anchors)) : Option.none();\n    };\n    var AnchorListOptions = { getAnchors: getAnchors };\n\n    var getClasses = function (editor) {\n      var list = Settings.getLinkClassList(editor);\n      if (list.length > 0) {\n        return ListOptions.sanitize(list);\n      }\n      return Option.none();\n    };\n    var ClassListOptions = { getClasses: getClasses };\n\n    var global$5 = tinymce.util.Tools.resolve('tinymce.util.XHR');\n\n    var parseJson = function (text) {\n      try {\n        return Option.some(JSON.parse(text));\n      } catch (err) {\n        return Option.none();\n      }\n    };\n    var getLinks = function (editor) {\n      var extractor = function (item) {\n        return editor.convertURL(item.value || item.url, 'href');\n      };\n      var linkList = Settings.getLinkList(editor);\n      return Future.nu(function (callback) {\n        if (isString(linkList)) {\n          global$5.send({\n            url: linkList,\n            success: function (text) {\n              return callback(parseJson(text));\n            },\n            error: function (_) {\n              return callback(Option.none());\n            }\n          });\n        } else if (isFunction(linkList)) {\n          linkList(function (output) {\n            return callback(Option.some(output));\n          });\n        } else {\n          callback(Option.from(linkList));\n        }\n      }).map(function (optItems) {\n        return optItems.bind(ListOptions.sanitizeWith(extractor)).map(function (items) {\n          if (items.length > 0) {\n            return [{\n                text: 'None',\n                value: ''\n              }].concat(items);\n          } else {\n            return items;\n          }\n        });\n      });\n    };\n    var LinkListOptions = { getLinks: getLinks };\n\n    var getRels = function (editor, initialTarget) {\n      var list = Settings.getRelList(editor);\n      if (list.length > 0) {\n        var isTargetBlank_1 = initialTarget.is('_blank');\n        var enforceSafe = Settings.allowUnsafeLinkTarget(editor) === false;\n        var safeRelExtractor = function (item) {\n          return Utils.applyRelTargetRules(ListOptions.getValue(item), isTargetBlank_1);\n        };\n        var sanitizer = enforceSafe ? ListOptions.sanitizeWith(safeRelExtractor) : ListOptions.sanitize;\n        return sanitizer(list);\n      }\n      return Option.none();\n    };\n    var RelOptions = { getRels: getRels };\n\n    var fallbacks = [\n      {\n        text: 'Current window',\n        value: ''\n      },\n      {\n        text: 'New window',\n        value: '_blank'\n      }\n    ];\n    var getTargets = function (editor) {\n      var list = Settings.getTargetList(editor);\n      if (isArray(list)) {\n        return ListOptions.sanitize(list).orThunk(function () {\n          return Option.some(fallbacks);\n        });\n      } else if (list === false) {\n        return Option.none();\n      }\n      return Option.some(fallbacks);\n    };\n    var TargetOptions = { getTargets: getTargets };\n\n    var nonEmptyAttr = function (dom, elem, name) {\n      var val = dom.getAttrib(elem, name);\n      return val !== null && val.length > 0 ? Option.some(val) : Option.none();\n    };\n    var extractFromAnchor = function (editor, anchor) {\n      var dom = editor.dom;\n      var onlyText = Utils.isOnlyTextSelected(editor.selection.getContent());\n      var text = onlyText ? Option.some(Utils.getAnchorText(editor.selection, anchor)) : Option.none();\n      var url = anchor ? Option.some(dom.getAttrib(anchor, 'href')) : Option.none();\n      var target = anchor ? Option.from(dom.getAttrib(anchor, 'target')) : Option.none();\n      var rel = nonEmptyAttr(dom, anchor, 'rel');\n      var linkClass = nonEmptyAttr(dom, anchor, 'class');\n      var title = nonEmptyAttr(dom, anchor, 'title');\n      return {\n        url: url,\n        text: text,\n        title: title,\n        target: target,\n        rel: rel,\n        linkClass: linkClass\n      };\n    };\n    var collect = function (editor, linkNode) {\n      return LinkListOptions.getLinks(editor).map(function (links) {\n        var anchor = extractFromAnchor(editor, linkNode);\n        return {\n          anchor: anchor,\n          catalogs: {\n            targets: TargetOptions.getTargets(editor),\n            rels: RelOptions.getRels(editor, anchor.target),\n            classes: ClassListOptions.getClasses(editor),\n            anchor: AnchorListOptions.getAnchors(editor),\n            link: links\n          },\n          optNode: Option.from(linkNode),\n          flags: { titleEnabled: Settings.shouldShowLinkTitle(editor) }\n        };\n      });\n    };\n    var DialogInfo = { collect: collect };\n\n    var handleSubmit = function (editor, info, assumeExternalTargets) {\n      return function (api) {\n        var data = api.getData();\n        if (!data.url.value) {\n          Utils.unlink(editor);\n          api.close();\n          return;\n        }\n        var getChangedValue = function (key) {\n          return Option.from(data[key]).filter(function (value) {\n            return !info.anchor[key].is(value);\n          });\n        };\n        var changedData = {\n          href: data.url.value,\n          text: getChangedValue('text'),\n          target: getChangedValue('target'),\n          rel: getChangedValue('rel'),\n          class: getChangedValue('linkClass'),\n          title: getChangedValue('title')\n        };\n        var attachState = {\n          href: data.url.value,\n          attach: data.url.meta !== undefined && data.url.meta.attach ? data.url.meta.attach : function () {\n          }\n        };\n        DialogConfirms.preprocess(editor, assumeExternalTargets, changedData).get(function (pData) {\n          Utils.link(editor, attachState, pData);\n        });\n        api.close();\n      };\n    };\n    var collectData = function (editor) {\n      var anchorNode = Utils.getAnchorElement(editor);\n      return DialogInfo.collect(editor, anchorNode);\n    };\n    var getInitialData = function (info, defaultTarget) {\n      return {\n        url: {\n          value: info.anchor.url.getOr(''),\n          meta: {\n            attach: function () {\n            },\n            text: info.anchor.url.fold(function () {\n              return '';\n            }, function () {\n              return info.anchor.text.getOr('');\n            }),\n            original: { value: info.anchor.url.getOr('') }\n          }\n        },\n        text: info.anchor.text.getOr(''),\n        title: info.anchor.title.getOr(''),\n        anchor: info.anchor.url.getOr(''),\n        link: info.anchor.url.getOr(''),\n        rel: info.anchor.rel.getOr(''),\n        target: info.anchor.target.or(defaultTarget).getOr(''),\n        linkClass: info.anchor.linkClass.getOr('')\n      };\n    };\n    var makeDialog = function (settings, onSubmit, editor) {\n      var urlInput = [{\n          name: 'url',\n          type: 'urlinput',\n          filetype: 'file',\n          label: 'URL'\n        }];\n      var displayText = settings.anchor.text.map(function () {\n        return {\n          name: 'text',\n          type: 'input',\n          label: 'Text to display'\n        };\n      }).toArray();\n      var titleText = settings.flags.titleEnabled ? [{\n          name: 'title',\n          type: 'input',\n          label: 'Title'\n        }] : [];\n      var defaultTarget = Option.from(Settings.getDefaultLinkTarget(editor));\n      var initialData = getInitialData(settings, defaultTarget);\n      var dialogDelta = DialogChanges.init(initialData, settings);\n      var catalogs = settings.catalogs;\n      var body = {\n        type: 'panel',\n        items: flatten([\n          urlInput,\n          displayText,\n          titleText,\n          cat([\n            catalogs.anchor.map(ListOptions.createUi('anchor', 'Anchors')),\n            catalogs.rels.map(ListOptions.createUi('rel', 'Rel')),\n            catalogs.targets.map(ListOptions.createUi('target', 'Open link in...')),\n            catalogs.link.map(ListOptions.createUi('link', 'Link list')),\n            catalogs.classes.map(ListOptions.createUi('linkClass', 'Class'))\n          ])\n        ])\n      };\n      return {\n        title: 'Insert/Edit Link',\n        size: 'normal',\n        body: body,\n        buttons: [\n          {\n            type: 'cancel',\n            name: 'cancel',\n            text: 'Cancel'\n          },\n          {\n            type: 'submit',\n            name: 'save',\n            text: 'Save',\n            primary: true\n          }\n        ],\n        initialData: initialData,\n        onChange: function (api, _a) {\n          var name = _a.name;\n          dialogDelta.onChange(api.getData, { name: name }).each(function (newData) {\n            api.setData(newData);\n          });\n        },\n        onSubmit: onSubmit\n      };\n    };\n    var open$1 = function (editor) {\n      var data = collectData(editor);\n      data.map(function (info) {\n        var onSubmit = handleSubmit(editor, info, Settings.assumeExternalTargets(editor));\n        return makeDialog(info, onSubmit, editor);\n      }).get(function (spec) {\n        editor.windowManager.open(spec);\n      });\n    };\n    var Dialog = { open: open$1 };\n\n    var getLink = function (editor, elm) {\n      return editor.dom.getParent(elm, 'a[href]');\n    };\n    var getSelectedLink = function (editor) {\n      return getLink(editor, editor.selection.getStart());\n    };\n    var hasOnlyAltModifier = function (e) {\n      return e.altKey === true && e.shiftKey === false && e.ctrlKey === false && e.metaKey === false;\n    };\n    var gotoLink = function (editor, a) {\n      if (a) {\n        var href = Utils.getHref(a);\n        if (/^#/.test(href)) {\n          var targetEl = editor.$(href);\n          if (targetEl.length) {\n            editor.selection.scrollIntoView(targetEl[0], true);\n          }\n        } else {\n          OpenUrl.open(a.href);\n        }\n      }\n    };\n    var openDialog = function (editor) {\n      return function () {\n        Dialog.open(editor);\n      };\n    };\n    var gotoSelectedLink = function (editor) {\n      return function () {\n        gotoLink(editor, getSelectedLink(editor));\n      };\n    };\n    var leftClickedOnAHref = function (editor) {\n      return function (elm) {\n        var sel, rng, node;\n        if (Settings.hasContextToolbar(editor) && Utils.isLink(elm)) {\n          sel = editor.selection;\n          rng = sel.getRng();\n          node = rng.startContainer;\n          if (node.nodeType === 3 && sel.isCollapsed() && rng.startOffset > 0 && rng.startOffset < node.data.length) {\n            return true;\n          }\n        }\n        return false;\n      };\n    };\n    var setupGotoLinks = function (editor) {\n      editor.on('click', function (e) {\n        var link = getLink(editor, e.target);\n        if (link && global$2.metaKeyPressed(e)) {\n          e.preventDefault();\n          gotoLink(editor, link);\n        }\n      });\n      editor.on('keydown', function (e) {\n        var link = getSelectedLink(editor);\n        if (link && e.keyCode === 13 && hasOnlyAltModifier(e)) {\n          e.preventDefault();\n          gotoLink(editor, link);\n        }\n      });\n    };\n    var toggleActiveState = function (editor) {\n      return function (api) {\n        var nodeChangeHandler = function (e) {\n          return api.setActive(!editor.readonly && !!Utils.getAnchorElement(editor, e.element));\n        };\n        editor.on('NodeChange', nodeChangeHandler);\n        return function () {\n          return editor.off('NodeChange', nodeChangeHandler);\n        };\n      };\n    };\n    var toggleEnabledState = function (editor) {\n      return function (api) {\n        api.setDisabled(!Utils.hasLinks(editor.dom.getParents(editor.selection.getStart())));\n        var nodeChangeHandler = function (e) {\n          return api.setDisabled(!Utils.hasLinks(e.parents));\n        };\n        editor.on('NodeChange', nodeChangeHandler);\n        return function () {\n          return editor.off('NodeChange', nodeChangeHandler);\n        };\n      };\n    };\n    var Actions = {\n      openDialog: openDialog,\n      gotoSelectedLink: gotoSelectedLink,\n      leftClickedOnAHref: leftClickedOnAHref,\n      setupGotoLinks: setupGotoLinks,\n      toggleActiveState: toggleActiveState,\n      toggleEnabledState: toggleEnabledState\n    };\n\n    var register = function (editor) {\n      editor.addCommand('mceLink', function () {\n        if (Settings.useQuickLink(editor)) {\n          editor.fire('contexttoolbar-show', { toolbarKey: 'quicklink' });\n        } else {\n          Actions.openDialog(editor)();\n        }\n      });\n    };\n    var Commands = { register: register };\n\n    var setup = function (editor) {\n      editor.addShortcut('Meta+K', '', function () {\n        editor.execCommand('mceLink');\n      });\n    };\n    var Keyboard = { setup: setup };\n\n    var setupButtons = function (editor) {\n      editor.ui.registry.addToggleButton('link', {\n        icon: 'link',\n        tooltip: 'Insert/edit link',\n        onAction: Actions.openDialog(editor),\n        onSetup: Actions.toggleActiveState(editor)\n      });\n      editor.ui.registry.addButton('openlink', {\n        icon: 'new-tab',\n        tooltip: 'Open link',\n        onAction: Actions.gotoSelectedLink(editor),\n        onSetup: Actions.toggleEnabledState(editor)\n      });\n      editor.ui.registry.addButton('unlink', {\n        icon: 'unlink',\n        tooltip: 'Remove link',\n        onAction: function () {\n          return Utils.unlink(editor);\n        },\n        onSetup: Actions.toggleEnabledState(editor)\n      });\n    };\n    var setupMenuItems = function (editor) {\n      editor.ui.registry.addMenuItem('openlink', {\n        text: 'Open link',\n        icon: 'new-tab',\n        onAction: Actions.gotoSelectedLink(editor),\n        onSetup: Actions.toggleEnabledState(editor)\n      });\n      editor.ui.registry.addMenuItem('link', {\n        icon: 'link',\n        text: 'Link...',\n        shortcut: 'Meta+K',\n        onAction: Actions.openDialog(editor)\n      });\n      editor.ui.registry.addMenuItem('unlink', {\n        icon: 'unlink',\n        text: 'Remove link',\n        onAction: function () {\n          return Utils.unlink(editor);\n        },\n        onSetup: Actions.toggleEnabledState(editor)\n      });\n    };\n    var setupContextMenu = function (editor) {\n      var inLink = 'link unlink openlink';\n      var noLink = 'link';\n      editor.ui.registry.addContextMenu('link', {\n        update: function (element) {\n          return Utils.hasLinks(editor.dom.getParents(element, 'a')) ? inLink : noLink;\n        }\n      });\n    };\n    var setupContextToolbars = function (editor) {\n      var collapseSelectionToEnd = function (editor) {\n        editor.selection.collapse(false);\n      };\n      var onSetupLink = function (buttonApi) {\n        var node = editor.selection.getNode();\n        buttonApi.setDisabled(!Utils.getAnchorElement(editor, node));\n        return function () {\n        };\n      };\n      editor.ui.registry.addContextForm('quicklink', {\n        launch: {\n          type: 'contextformtogglebutton',\n          icon: 'link',\n          tooltip: 'Link',\n          onSetup: Actions.toggleActiveState(editor)\n        },\n        label: 'Link',\n        predicate: function (node) {\n          return !!Utils.getAnchorElement(editor, node) && Settings.hasContextToolbar(editor);\n        },\n        initValue: function () {\n          var elm = Utils.getAnchorElement(editor);\n          return !!elm ? Utils.getHref(elm) : '';\n        },\n        commands: [\n          {\n            type: 'contextformtogglebutton',\n            icon: 'link',\n            tooltip: 'Link',\n            primary: true,\n            onSetup: function (buttonApi) {\n              var node = editor.selection.getNode();\n              buttonApi.setActive(!!Utils.getAnchorElement(editor, node));\n              return Actions.toggleActiveState(editor)(buttonApi);\n            },\n            onAction: function (formApi) {\n              var anchor = Utils.getAnchorElement(editor);\n              var value = formApi.getValue();\n              if (!anchor) {\n                var attachState = {\n                  href: value,\n                  attach: function () {\n                  }\n                };\n                var onlyText = Utils.isOnlyTextSelected(editor.selection.getContent());\n                var text = onlyText ? Option.some(Utils.getAnchorText(editor.selection, anchor)).filter(function (t) {\n                  return t.length > 0;\n                }).or(Option.from(value)) : Option.none();\n                Utils.link(editor, attachState, {\n                  href: value,\n                  text: text,\n                  title: Option.none(),\n                  rel: Option.none(),\n                  target: Option.none(),\n                  class: Option.none()\n                });\n                formApi.hide();\n              } else {\n                editor.dom.setAttrib(anchor, 'href', value);\n                collapseSelectionToEnd(editor);\n                formApi.hide();\n              }\n            }\n          },\n          {\n            type: 'contextformbutton',\n            icon: 'unlink',\n            tooltip: 'Remove link',\n            onSetup: onSetupLink,\n            onAction: function (formApi) {\n              Utils.unlink(editor);\n              formApi.hide();\n            }\n          },\n          {\n            type: 'contextformbutton',\n            icon: 'new-tab',\n            tooltip: 'Open link',\n            onSetup: onSetupLink,\n            onAction: function (formApi) {\n              Actions.gotoSelectedLink(editor)();\n              formApi.hide();\n            }\n          }\n        ]\n      });\n    };\n    var Controls = {\n      setupButtons: setupButtons,\n      setupMenuItems: setupMenuItems,\n      setupContextMenu: setupContextMenu,\n      setupContextToolbars: setupContextToolbars\n    };\n\n    function Plugin () {\n      global$1.add('link', function (editor) {\n        Controls.setupButtons(editor);\n        Controls.setupMenuItems(editor);\n        Controls.setupContextMenu(editor);\n        Controls.setupContextToolbars(editor);\n        Actions.setupGotoLinks(editor);\n        Commands.register(editor);\n        Keyboard.setup(editor);\n      });\n    }\n\n    Plugin();\n\n}(window));\n"]}